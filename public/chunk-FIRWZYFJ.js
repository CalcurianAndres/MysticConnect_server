import{a as ai}from"./chunk-3J6JI56C.js";import{a as ri,b as li}from"./chunk-DHG24SYD.js";import{g as z,i as J}from"./chunk-AWU2QWKU.js";import{c as K,d as X,g as Z,h as ii,i as ti,j as ni}from"./chunk-UIEJ76RJ.js";import"./chunk-RHUNMPRV.js";import{a as ei}from"./chunk-XLRU7ME7.js";import{a as oi}from"./chunk-P6E5DH65.js";import{$a as E,Ia as j,Na as p,Tb as H,Vb as G,Wa as u,X as $,Xb as Q,Ya as m,Yb as W,Za as v,Zb as Y,_a as b,ab as _,bb as a,cb as d,da as P,db as w,ea as T,eb as y,fb as r,ib as c,jb as g,kb as F,lb as D,mb as O,nb as N,ob as L,pb as B,rb as I,sb as M,tb as k,ub as A,vb as q,wb as U,za as s}from"./chunk-6AB4XWDR.js";var _i=()=>["/dashboard/planificacion"],ci=()=>["/dashboard/charts"],si=i=>["/dashboard/promotora",i],di=i=>({rotado:i}),R=(i,n)=>({oculto:i,activo:n});function pi(i,n){i&1&&d(0,"app-loadings")}function mi(i,n){if(i&1&&(_(0,"option",17),c(1),a()),i&2){let t=n.$implicit,e=n.$index;u("value",e),s(),g(t.mes)}}function Ci(i,n){if(i&1){let t=w();_(0,"div",3)(1,"div",4)(2,"label",11),c(3,"Mes"),a(),_(4,"div",12)(5,"select",16),B("ngModelChange",function(o){P(t);let l=r(2);return L(l.indexPlanificacion,o)||(l.indexPlanificacion=o),T(o)}),y("change",function(){P(t);let o=r(2);return T(o.cambiarPlanificacion())}),b(6,mi,2,2,"option",17,v),a()()(),_(8,"div",4)(9,"label",11),c(10,"Inicio"),a(),d(11,"input",18),a(),_(12,"div",4)(13,"label",11),c(14,"Cierre"),a(),d(15,"input",18),a()()}if(i&2){let t=r(2);s(5),N("ngModel",t.indexPlanificacion),s(),E(t.planificacionService.planificacion()),s(5),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].inicio)),s(4),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].cierre))}}function fi(i,n){if(i&1&&p(0,Ci,16,3,"div",3),i&2){let t=r();m(t.indexPlanificacion?0:-1)}}function ui(i,n){i&1&&d(0,"app-loadings")}function xi(i,n){i&1&&d(0,"app-loadings")(1,"br")}function gi(i,n){i&1&&d(0,"span",29)}function Fi(i,n){i&1&&c(0," No hay reportes registrados ")}function hi(i,n){i&1&&d(0,"i",30)}function vi(i,n){i&1&&d(0,"i",31)}function bi(i,n){if(i&1&&p(0,hi,1,0,"i",30)(1,vi,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.mystic.impulso?0:1)}}function Ei(i,n){i&1&&d(0,"i",30)}function Si(i,n){i&1&&d(0,"i",31)}function Pi(i,n){if(i&1&&p(0,Ei,1,0,"i",30)(1,Si,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.qerametik.impulso?0:1)}}function Ti(i,n){if(i&1&&p(0,bi,2,1)(1,Pi,2,1),i&2){let t=r(2).$implicit;m(t.marca==="Mystic"?0:1)}}function yi(i,n){i&1&&d(0,"i",30)}function $i(i,n){i&1&&d(0,"i",31)}function wi(i,n){if(i&1&&p(0,yi,1,0,"i",30)(1,$i,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.mystic.evento?0:1)}}function ki(i,n){i&1&&d(0,"i",30)}function Di(i,n){i&1&&d(0,"i",31)}function Ii(i,n){if(i&1&&p(0,ki,1,0,"i",30)(1,Di,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.qerametik.evento?0:1)}}function Mi(i,n){if(i&1&&p(0,wi,2,1)(1,Ii,2,1),i&2){let t=r(2).$implicit;m(t.marca==="Mystic"?0:1)}}function Ai(i,n){if(i&1&&p(0,Ti,2,1)(1,Mi,2,1),i&2){let t=r().$implicit;m(t.tipo==="Impulso"?0:1)}}function Ri(i,n){i&1&&d(0,"i",30)}function Vi(i,n){i&1&&d(0,"i",31)}function ji(i,n){if(i&1&&p(0,Ri,1,0,"i",30)(1,Vi,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.mystic.impulso?0:1)}}function Oi(i,n){i&1&&d(0,"i",30)}function Ni(i,n){i&1&&d(0,"i",31)}function Li(i,n){if(i&1&&p(0,Oi,1,0,"i",30)(1,Ni,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.qerametik.impulso?0:1)}}function Bi(i,n){if(i&1&&p(0,ji,2,1)(1,Li,2,1),i&2){let t=r(2).$implicit;m(t.marca==="Mystic"?0:1)}}function qi(i,n){i&1&&d(0,"i",30)}function Ui(i,n){i&1&&d(0,"i",31)}function Hi(i,n){if(i&1&&p(0,qi,1,0,"i",30)(1,Ui,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.mystic.evento?0:1)}}function Gi(i,n){i&1&&d(0,"i",30)}function Qi(i,n){i&1&&d(0,"i",31)}function Wi(i,n){if(i&1&&p(0,Gi,1,0,"i",30)(1,Qi,1,0,"i",31),i&2){let t=r(3).$implicit,e=r(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.qerametik.evento?0:1)}}function Yi(i,n){if(i&1&&p(0,Hi,2,1)(1,Wi,2,1),i&2){let t=r(2).$implicit;m(t.marca==="Mystic"?0:1)}}function zi(i,n){if(i&1&&p(0,Bi,2,1)(1,Yi,2,1),i&2){let t=r().$implicit;m(t.tipo==="Impulso"?0:1)}}function Ji(i,n){if(i&1&&(_(0,"div"),c(1),p(2,Ai,2,1)(3,zi,2,1),a(),c(4,"\xA0 ")),i&2){let t=n.$implicit,e=r(4).$implicit;s(),O(" \xA0(",t.marca,")\xA0 ",t.totalSubtotal," productos (",t.totalPuntos," Puntos) "),s(),m(e.fija?2:3)}}function Ki(i,n){if(i&1&&b(0,Ji,5,4,null,null,v),i&2){let t=r().$implicit,e=r(2).$implicit,o=r(2);E(o.getReportesPorFecha(e.nombre,e.apellido,t))}}function Xi(i,n){if(i&1&&(_(0,"tr")(1,"td"),c(2),a(),_(3,"td"),c(4),a(),_(5,"td"),c(6),a(),_(7,"td"),c(8),a(),_(9,"td"),c(10),a(),_(11,"td"),c(12),a(),_(13,"td"),c(14),a()()),i&2){let t=n.$implicit;s(2),g(t.linea),s(2),g(t.marca),s(2),g(t.producto),s(2),g(t.inicio),s(2),g(t.final),s(2),g(t.cantidad),s(2),g(t.puntosTotales)}}function Zi(i,n){if(i&1&&(_(0,"div",27)(1,"b"),c(2,"Establecimiento:"),a(),c(3),d(4,"br"),_(5,"b"),c(6,"Tipo:"),a(),c(7),d(8,"br"),_(9,"b"),c(10,"Marca:"),a(),c(11),d(12,"br"),_(13,"b"),c(14,"Observaci\xF3n:"),a(),c(15),d(16,"hr"),_(17,"table",32)(18,"thead")(19,"tr")(20,"th"),c(21,"Linea"),a(),_(22,"th"),c(23,"Marca"),a(),_(24,"th"),c(25,"Producto"),a(),_(26,"th"),c(27,"Inicio"),a(),_(28,"th"),c(29,"Final"),a(),_(30,"th"),c(31,"Cantidad (Und)"),a(),_(32,"th"),c(33,"Puntos"),a()()(),_(34,"tbody"),b(35,Xi,15,7,"tr",null,v),a()()()),i&2){let t=n.$implicit,e=r(2).$index,o=r(2).$index,l=r(2);u("ngClass",k(6,R,!l.toggleVentas[o]||!l.toggleVentas[o][e],l.toggleVentas[o]&&l.toggleVentas[o][e])),s(3),F(" ",t.cliente," "),s(4),F(" ",t.tipo," "),s(4),F(" ",t.marca," "),s(4),F(" ",t.observacion," "),s(2),u("ngClass",k(9,R,!l.toggleVentas[o]||!l.toggleVentas[o][e],l.toggleVentas[o]&&l.toggleVentas[o][e])),s(18),E(t.productos)}}function it(i,n){if(i&1&&b(0,Zi,37,12,"div",27,v),i&2){let t=r().$implicit,e=r(2).$implicit,o=r(2);E(o.getReportesPorFecha(e.nombre,e.apellido,t))}}function tt(i,n){if(i&1){let t=w();_(0,"div")(1,"div",19)(2,"header",20)(3,"p",21),c(4),p(5,Fi,1,0)(6,Ki,2,0),a(),_(7,"button",24),y("click",function(){let o=P(t).$index,l=r(2).$index,f=r(2);return T(f.toggleVentaSection(l,o))}),_(8,"span",7),d(9,"i",26),a()()(),p(10,it,2,0),a()(),d(11,"br")}if(i&2){let t=n.$implicit,e=r(2).$implicit,o=r(2);s(4),F(" ",t," - "),s(),m(o.getReportesPorFecha(e.nombre,e.apellido,t)===void 0?5:6),s(5),m(o.getReportesPorFecha(e.nombre,e.apellido,t)?10:-1)}}function nt(i,n){if(i&1){let t=w();_(0,"div",19)(1,"header",20)(2,"p",21),p(3,gi,1,0,"span",22),c(4,"\xA0 "),_(5,"a",23),c(6),a(),c(7),A(8,"number"),a(),_(9,"button",24),y("click",function(){P(t);let o=r().$index,l=r(2);return T(l.togglePromotoraSection(o))}),_(10,"span",25),d(11,"i",26),a()()(),_(12,"div",27)(13,"table",28)(14,"tr")(15,"th"),c(16,"Vendido"),a(),_(17,"th"),c(18,"Incentivo"),a()(),_(19,"tr")(20,"td"),c(21),a(),_(22,"td"),c(23),A(24,"currency"),a()()(),b(25,tt,12,3,null,null,v),a()()}if(i&2){let t=r(),e=t.$implicit,o=t.$index,l=r(2);s(3),u("ngIf",l.noHuboReporteAyer(e.nombre,e.apellido)),s(2),u("routerLink",M(15,si,e._id)),s(),D("",e.nombre," ",e.apellido,""),s(),D("\xA0",l.getPuntos(e.nombre,e.apellido)||0," puntos - ",q(8,10,l.buscarDiasTrabajados(e.nombre,e.apellido))," dia(s) trabajado(s) "),s(3),u("ngClass",M(17,di,l.isRotated[o])),s(2),u("ngClass",k(19,R,!l.togglePromotora[o],l.togglePromotora[o])),s(9),F("",l.getGastado(e.nombre,e.apellido)," productos"),s(2),F("",U(24,12,l.obtenerIncentivo(e.nombre,e.apellido).totales,"USD")," "),s(2),E(l.getFechasDelRango())}}function et(i,n){if(i&1&&p(0,xi,2,0)(1,nt,27,22,"div",19),i&2){let t=r(2);m(t.planificacionService.planificacion()[t.indexPlanificacion]?1:0)}}function ot(i,n){if(i&1&&b(0,et,2,1,null,null,v),i&2){let t=r();E(t.promotorasFiltered)}}var V=class i{ReportesServices=$(li);promotoras=$(ai);planificacionService=$(ri);active=!1;indexPlanificacion=0;promotorasFiltered=[];promotorasFilteredFunction(n){n.value==="fija"?this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!0):this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!1)}reportesAgrupados=[];togglePromotora=[];toggleVentas={};isRotated=[];isRotated_={};constructor(){setTimeout(()=>{this.planificacionService.loading()||(this.indexPlanificacion=this.planificacionService.planificacion().length-1,this.promotorasFilteredFunction({value:"fija"}),this.ReportesServices.getReportesAgrupados(!0,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:n=>{this.reportesAgrupados=n,console.log(this.reportesAgrupados)},error:n=>{console.error("Error al cargar los reportes:",n)}}))},500)}cambiarPlanificacion(){setTimeout(()=>{this.planificacionService.loading()||(this.promotorasFilteredFunction({value:"fija"}),this.ReportesServices.getReportesAgrupados(!0,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:n=>{this.reportesAgrupados=n,console.log(this.reportesAgrupados)},error:n=>{console.error("Error al cargar los reportes:",n)}}))},500)}simplificar(n){return n.split("T")[0]}togglePromotoraSection(n){this.togglePromotora[n]=!this.togglePromotora[n],this.isRotated[n]=!this.isRotated[n]}toggleVentaSection(n,t){this.toggleVentas[n]||(this.toggleVentas[n]=[]),this.toggleVentas[n][t]=!this.toggleVentas[n][t]}getPuntos(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?e.puntosAcumulados:0}buscarDiasTrabajados(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?new Set(e.reportes.map(l=>l.fecha)).size:0}sueldodiario(n,t){return Number(n)/t}getGastado(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?e.totalGastado:0}getReportes(n,t){let e=`${n} ${t}`,o=this.reportesAgrupados.find(l=>l.promotora===e);return o?o.reportes:[]}getFechasDelRango(){let n=new Date,t=new Date(n);t.setDate(n.getDate()+1);let e=t,o=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].inicio);new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre)<n&&(e=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre));let l=[];for(;o<=e;){let f=new Date(o);f.setDate(f.getDate()+1),l.push(this.formatFecha(f)),o.setDate(o.getDate()+1)}return l}formatFecha(n){let t=("0"+n.getDate()).slice(-2),e=("0"+(n.getMonth()+1)).slice(-2),o=n.getFullYear();return`${t}/${e}/${o}`}getReportesPorFecha(n,t,e){let o=`${n} ${t}`,l=this.convertirFechaAISO(e),f=this.reportesAgrupados.find(C=>C.promotora===o);if(f){let C=f.reportes.filter(S=>S.fecha===l);return C.length>0?C:void 0}else return}convertirFechaAISO(n){let[t,e,o]=n.split("/");return`${o}-${e.padStart(2,"0")}-${t.padStart(2,"0")}`}calcularDiasHabiles(n,t){let e=new Date(n),o=new Date(t),l=0;if(e>o){let C=e;e=o,o=C}let f=new Date(e);for(;f<=o;){let C=f.getDay();C!==0&&C!==6&&l++,f.setDate(f.getDate()+1)}return l}puntos(n){return n||0}obtenerIncentivo(n,t){let e=this.reportesAgrupados.find(x=>x.promotora===`${n} ${t}`),o=0,l=0;e&&(o=e.puntosMystic,l=e.puntosQerametik);let f=0,C=0,S=0;if(o<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[0].de)C=0;else for(let x=0;x<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos.length;x++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[x];o>=h.de&&o<=h.hasta&&(C=h.incentivo)}if(l<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[0].de)S=0;else for(let x=0;x<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik.length;x++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[x];l>=h.de&&l<=h.hasta&&(S=h.incentivo)}return{totales:C+S,mystic:C,qerametik:S}}noHuboReporteAyer(n,t){let e=new Date;e.setDate(e.getDate()-1);let o=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),C=`${String(e.getDate()).padStart(2,"0")}/${l}/${o}`;return!this.getReportesPorFecha(n,t,C)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=j({type:i,selectors:[["app-estadisticas"]],decls:33,vars:6,consts:[[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Estad\xEDsticas"],[1,"field","is-grouped"],[1,"control"],[1,"button","is-primary",3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-chart-pie"],[1,"header"],[1,"field"],["for","",1,"label"],[1,"select"],[3,"change"],["value","fija"],["value","por destajo"],[3,"ngModelChange","change","ngModel"],[3,"value"],["type","date","disabled","",1,"input",3,"value"],[1,"card"],[1,"card-header"],[1,"card-header-title"],["class","punto-rojo",4,"ngIf"],[3,"routerLink"],["aria-label","more options",1,"card-header-icon",3,"click"],[1,"icon",3,"ngClass"],["aria-hidden","true",1,"fas","fa-angle-down"],[1,"card-content",3,"ngClass"],[1,"table","is-fullwidth"],[1,"punto-rojo"],[1,"far","fa-thumbs-up",2,"color","rgb(129, 228, 129)"],[1,"far","fa-thumbs-down",2,"color","rgb(228, 129, 129)"],[1,"table","is-fullwidth","is-striped",3,"ngClass"]],template:function(t,e){t&1&&(_(0,"div",0)(1,"div",1),d(2,"app-title",2),a()(),d(3,"hr"),_(4,"div",3)(5,"div",4)(6,"button",5)(7,"span"),c(8,"Nueva planificaci\xF3n"),a()()(),_(9,"div",4)(10,"button",6)(11,"span",7),d(12,"i",8),a(),_(13,"span"),c(14,"Ver gr\xE1ficas"),a()()()(),d(15,"br")(16,"br"),_(17,"span",9),p(18,pi,1,0,"app-loadings")(19,fi,1,1),d(20,"br"),a(),_(21,"div",10)(22,"div",4)(23,"label",11),c(24,"Promotoras"),a(),_(25,"div",12)(26,"select",13),y("change",function(l){return e.promotorasFilteredFunction(l.target)}),_(27,"option",14),c(28,"Fijas"),a(),_(29,"option",15),c(30,"Por destajo"),a()()()()(),p(31,ui,1,0,"app-loadings")(32,ot,2,0)),t&2&&(s(6),u("routerLink",I(4,_i)),s(4),u("routerLink",I(5,ci)),s(8),m(e.planificacionService.loading()?18:19),s(13),m(e.planificacionService.loading()?31:32))},dependencies:[ei,Y,H,G,Q,W,ni,ii,ti,Z,K,X,oi,J,z],styles:['@charset "UTF-8";.oculto[_ngcontent-%COMP%]{overflow:hidden;max-height:0px;padding:0;margin:0;transition:max-height .5s ease-out,padding .3s ease-out,margin .3s ease-out}.activo[_ngcontent-%COMP%]{transition:max-height .9s ease-out,padding .3s ease-out,margin .3s ease-out}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.icon.rotado[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:rotate(180deg)}.low[_ngcontent-%COMP%]{color:#e48181;font-weight:bolder}.hight[_ngcontent-%COMP%]{color:#81e481;font-weight:bolder}.punto-rojo[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;background-color:red;border-radius:50%;animation:_ngcontent-%COMP%_parpadeo 1s infinite;margin-left:5px}@keyframes _ngcontent-%COMP%_parpadeo{0%,to{opacity:1}50%{opacity:0}}']})};export{V as default};
