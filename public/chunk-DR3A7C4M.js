import{a as q}from"./chunk-KDI34TYX.js";import{a as Rt}from"./chunk-DO5URY5W.js";import{a as Qt}from"./chunk-SAV3IXQI.js";import{a as vt,b as St}from"./chunk-PQMTX7V5.js";import{a as mt}from"./chunk-TX7DGLL3.js";import{d as ct,g as dt,i as pt}from"./chunk-LAJQBY6U.js";import{a as xt}from"./chunk-XYPWKQDW.js";import{a as Pt}from"./chunk-HCO3TYPA.js";import{c as ut,d as ft,g as ht,h as _t,i as Ct,j as bt}from"./chunk-2ENZ3PA2.js";import"./chunk-HUYOMWR4.js";import{a as gt}from"./chunk-FMOI5WBO.js";import{a as yt}from"./chunk-6FTYGNKF.js";import{$a as D,Aa as Z,Ia as tt,Na as M,Vb as rt,Wa as V,X as v,Xb as st,Ya as B,Za as L,_a as I,_b as lt,a as O,ab as a,b as $,bb as n,cb as _,da as k,db as N,e as Bt,ea as w,eb as A,fb as g,ib as s,jb as y,lb as Y,mb as et,ob as it,pb as ot,qb as at,tb as nt,vb as W,xb as j,za as l}from"./chunk-Q6JVZMQ3.js";var x=Bt(Qt());var Ft=o=>["/dashboard/cliente",o];function Vt(o,e){if(o&1&&(a(0,"option",7),s(1),n()),o&2){let t=e.$implicit,m=e.$index;V("value",m),l(),y(t.mes)}}function Lt(o,e){if(o&1){let t=N();a(0,"tr")(1,"td"),s(2),W(3,"date"),n(),a(4,"td"),s(5),n(),a(6,"td"),s(7),n(),a(8,"td")(9,"button",15),A("click",function(){let d=k(t).$implicit,f=g(3);return w(f.EditarReporte_Mystic(d._id))}),a(10,"span",16),_(11,"i",17),n()()()()}if(o&2){let t=e.$implicit;l(2),y(j(3,3,t.fecha,"dd/MM/YYYY")),l(3),y(t.puntuacionTotal),l(2),y(t.totalCantidad)}}function It(o,e){if(o&1&&(a(0,"table",14)(1,"thead")(2,"th"),s(3,"Fecha"),n(),a(4,"th"),s(5,"Puntuacion obtenida"),n(),a(6,"th"),s(7,"Productos vendidos"),n(),a(8,"th"),s(9,"Eliminar"),n()(),a(10,"tbody"),I(11,Lt,12,6,"tr",null,L),n()()),o&2){let t=g(2);l(11),D(t.ReportesFiltradosMystic)}}function Dt(o,e){o&1&&_(0,"app-loadings")}function Nt(o,e){if(o&1){let t=N();a(0,"tr")(1,"td"),s(2),W(3,"date"),n(),a(4,"td"),s(5),n(),a(6,"td"),s(7),n(),a(8,"td")(9,"button",15),A("click",function(){let d=k(t).$implicit,f=g(3);return w(f.EditarReporte_Qera(d._id))}),a(10,"span",16),_(11,"i",17),n()()()()}if(o&2){let t=e.$implicit;l(2),y(j(3,3,t.fecha,"dd/MM/YYYY")),l(3),y(t.puntuacionTotal),l(2),y(t.totalCantidad)}}function At(o,e){if(o&1&&(a(0,"table",14)(1,"thead")(2,"th"),s(3,"Fecha"),n(),a(4,"th"),s(5,"Puntuacion obtenida"),n(),a(6,"th"),s(7,"Productos vendidos"),n(),a(8,"th"),s(9,"Eliminar"),n()(),a(10,"tbody"),I(11,Nt,12,6,"tr",null,L),n()()),o&2){let t=g(2);l(11),D(t.ReportesFiltradosQerametik)}}function Yt(o,e){o&1&&_(0,"app-loadings")}function Ot(o,e){if(o&1&&(a(0,"tr")(1,"th")(2,"a",19),s(3),n()(),a(4,"td"),s(5),n()()),o&2){let t=e.$implicit;l(2),V("routerLink",nt(5,Ft,t.nombre)),l(),y(t.nombre),l(2),et("",t.totalProductosVendidos," Productos - (",t.totalMystic," Mystic) (",t.totalQerametik," Qerametik)")}}function $t(o,e){if(o&1&&(a(0,"table",14)(1,"tbody"),M(2,Ot,6,7,"tr",18),n()()),o&2){let t=g(2);l(2),V("ngForOf",t.Separado_por_clientes)}}function Wt(o,e){if(o&1){let t=N();a(0,"div",0)(1,"div",1),_(2,"app-title",2),s(3),n()(),a(4,"div",3)(5,"label",4),s(6,"Mes"),n(),a(7,"div",5)(8,"select",6),at("ngModelChange",function(d){k(t);let f=g();return ot(f.indexPlanificacion,d)||(f.indexPlanificacion=d),w(d)}),A("change",function(){k(t);let d=g();return w(d.cambiar())}),I(9,Vt,2,2,"option",7,L),n()()(),_(11,"hr"),a(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",1)(16,"span",11),s(17,"Marca mas vendedia"),n(),_(18,"canvas",12),n()()(),a(19,"div",9)(20,"div",10)(21,"div",1)(22,"span",11),s(23,"Venta por linea"),n(),_(24,"canvas",13),n()()()(),a(25,"span",11),s(26),n(),_(27,"hr"),M(28,It,13,0,"table",14)(29,Dt,1,0,"app-loadings"),a(30,"span",11),s(31),n(),_(32,"hr"),M(33,At,13,0,"table",14)(34,Yt,1,0,"app-loadings"),a(35,"span",11),s(36,` Ventas por cliente
`),n(),_(37,"hr"),M(38,$t,3,1,"table",14),_(39,"br")}if(o&2){let t=g();l(3),Y(" ",t.perfil.nombre," ",t.perfil.apellido," "),l(5),it("ngModel",t.indexPlanificacion),l(),D(t.planificacion.planificacion()),l(17),Y(" Progreso Mystic (",t.totalCantidadMystic," Productos - ",t.totalPuntosMystic,` Puntos)
`),l(2),B(t.loading?28:29),l(3),Y(" Progreso Qerametik (",t.totalCantidadQerametik," Productos - ",t.totalPuntosQerametik,` Puntos)
`),l(2),B(t.loading?33:34),l(5),B(t.loading_clientes?38:-1)}}function jt(o,e){o&1&&s(0,`
Cargando perfil...
`)}var H=class o{constructor(e){this.route=e;this.route.paramMap.subscribe(t=>{let m=t.get("id");setTimeout(()=>{this.indexPlanificacion=this.planificacion.planificacion().length-1,this.loading_perfil=!0,this.perfil=this.promotora.users().find(d=>d._id===m),this.RefreshPage()},1e3)})}login=v(mt);reportes=v(St);planificacion=v(vt);clientes=v(Pt);productoService=v(xt);promotora=v(Rt);ReportesFiltradosMystic=[];ReportesFiltradosQerametik=[];loading=!1;EditarReporte=!1;ReporteSeleccionado;MarcaSelected="Mystic";searchTerm="";filteredProductos=[];usarListaAntigua=!1;modalCliente=!1;filteredClientes=[];totalCantidadMystic=0;totalPuntosMystic=0;totalCantidadQerametik=0;totalPuntosQerametik=0;perfil;loading_perfil=!1;loading_clientes=!1;indexPlanificacion=0;Separado_por_clientes=[];marcas_chart;lineas_chart;linea;marcas;BuscarCliente(e){e.value.trim()===""?this.filteredClientes=[]:this.filteredClientes=this.clientes.clientes().filter(t=>t.cliente.toLowerCase().includes(e.value.toLowerCase())&&t.marca===this.MarcaSelected)}addCliente(e){this.ReporteSeleccionado.cliente=e,this.modalCliente=!1}RefreshPage(){this.lineas_chart&&this.lineas_chart.destroy(),setTimeout(()=>{if(!this.planificacion.loading()){let e=this.planificacion.planificacion()[this.indexPlanificacion];this.reportes.cargarReportes_(e.inicio,e.cierre).subscribe(t=>{let m=document.getElementById("marcas"),d=document.getElementById("lineas"),f=0,Q=0,S=0,G=0,F=0;this.ReportesFiltradosMystic=t.filter(r=>r.promotora._id===this.perfil._id&&r.productos[0]?.producto?.marca==="Mystic"),this.ReportesFiltradosQerametik=t.filter(r=>r.promotora._id===this.perfil._id&&r.productos[0]?.producto?.marca==="Qerametik");let U=0,z=0,J=0,K=0;this.ReportesFiltradosMystic.forEach(r=>{let i=r.productos.reduce((c,h)=>c+h.cantidad,0),u=r.productos.reduce((c,h)=>c+h.producto.puntos*h.cantidad,0);r.totalCantidad=i,r.puntuacionTotal=u,U+=i,z+=u,r.productos.forEach(c=>{f+=c.cantidad,c.producto.linea==="Tradicional"?S+=c.cantidad:c.producto.linea==="Rebranding"&&(F+=c.cantidad)})}),this.ReportesFiltradosQerametik.forEach(r=>{let i=r.productos.reduce((c,h)=>c+h.cantidad,0),u=r.productos.reduce((c,h)=>c+h.producto.puntos*h.cantidad,0);r.totalCantidad=i,r.puntuacionTotal=u,J+=i,K+=u,r.productos.forEach(c=>{Q+=c.cantidad,c.producto.linea==="Tradicional"&&(G+=c.cantidad)})});let X=S+F,Mt=S/X*100,Et=F/X*100;this.linea={labels:[`Tradicional Mystic (${Mt.toFixed(2)}%)`,"Tradicional Qerametik",`Rebranding (${Et.toFixed(2)}%)`],datasets:[{label:"Productos vendidos",data:[S,G,F],backgroundColor:["#001a72","#6bcaba","#fe5000"],borderColor:["#fe5000","#c99700","#001a72"],hoverOffset:4}]};let Tt={id:"customDoughnutLabels",afterDatasetsDraw(r){let{ctx:i,data:u}=r,c=u.datasets[0];r.getDatasetMeta(0).data.forEach((h,E)=>{let T=c.data[E],wt=u.labels[E],{x:P,y:R}=h.tooltipPosition();i.save(),i.fillStyle="rgba(255, 255, 255, 0.8)";let p=6,C=i.measureText(T).width,b=14;i.fillRect(P-C/2-p/2,R-b/2-p/2,C+p,b+p),i.strokeStyle="rgba(0, 0, 0, 0.3)",i.lineWidth=1,i.strokeRect(P-C/2-p/2,R-b/2-p/2,C+p,b+p),i.fillStyle="#000",i.font="12px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(T,P,R),i.restore()})}};this.lineas_chart=new q(d,{type:"doughnut",data:this.linea,options:{plugins:{legend:{display:!0}}},plugins:[Tt]}),this.marcas={labels:["Mystic","Qerametik"],datasets:[{label:"Productos vendidos",data:[f,Q],backgroundColor:["#001a72","#6bcaba"],borderColor:["#fe5000","#c99700"],hoverOffset:4}]};let kt={id:"customDoughnutLabels",afterDatasetsDraw(r){let{ctx:i,data:u}=r,c=u.datasets[0];r.getDatasetMeta(0).data.forEach((h,E)=>{let T=c.data[E],wt=u.labels[E],{x:P,y:R}=h.tooltipPosition();i.save(),i.fillStyle="rgba(255, 255, 255, 0.8)";let p=6,C=i.measureText(T).width,b=14;i.fillRect(P-C/2-p/2,R-b/2-p/2,C+p,b+p),i.strokeStyle="rgba(0, 0, 0, 0.3)",i.lineWidth=1,i.strokeRect(P-C/2-p/2,R-b/2-p/2,C+p,b+p),i.fillStyle="#000",i.font="12px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(T,P,R),i.restore()})}};this.marcas_chart=new q(m,{type:"doughnut",data:this.marcas,options:{plugins:{legend:{display:!0}}},plugins:[kt]}),this.totalCantidadMystic=U,this.totalPuntosMystic=z,this.totalCantidadQerametik=J,this.totalPuntosQerametik=K,this.loading=!0,this.Separado_por_clientes=this.agruparYCalcularTotales(t.filter(r=>r.promotora._id===this.perfil._id)),this.Separado_por_clientes=Object.entries(this.Separado_por_clientes).map(([r,i])=>{if(typeof i=="object"&&i!==null){let u=i;return{nombre:r,cantidadReportes:u.cantidadReportes||0,totalMystic:u.totalMystic||0,totalProductosVendidos:u.totalProductosVendidos||0,totalQerametik:u.totalQerametik||0}}return{nombre:r,id:0,cantidadReportes:0,totalMystic:0,totalProductosVendidos:0,totalQerametik:0}}).sort((r,i)=>i.totalProductosVendidos-r.totalProductosVendidos),this.loading_clientes=!0})}},1e3)}EditarReporte_Mystic(e){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosMystic.find(t=>t._id===e),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca,x.default.fire({title:"\xBFQuieres eliminar este reporte?",icon:"question",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Eliminar",denyButtonText:"No, conservar"}).then(t=>{t.isConfirmed?(this.ReporteSeleccionado.borrado=!0,this.reportes.NuevoReporte(this.ReporteSeleccionado),x.default.fire({timer:2e3,icon:"success",title:"Reporte eliminado",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0}),this.RefreshPage()):t.isDenied&&x.default.fire({timer:2e3,icon:"info",title:"No hubo cambios",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0})})},500)}EditarReporte_Qera(e){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosQerametik.find(t=>t._id===e),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca,x.default.fire({title:"\xBFQuieres eliminar este reporte?",icon:"question",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Eliminar",denyButtonText:"No, conservar"}).then(t=>{t.isConfirmed?(this.ReporteSeleccionado.borrado=!0,this.reportes.NuevoReporte(this.ReporteSeleccionado),x.default.fire({timer:2e3,icon:"success",title:"Reporte eliminado",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0}),this.RefreshPage()):t.isDenied&&x.default.fire({timer:2e3,icon:"info",title:"No hubo cambios",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0})})},500)}BorrarReporte(e){x.default.fire({title:"\xBFReportar ventas de hoy?",text:"Recuerda verificar bien las cantidades que declaras y los productos seleccionados",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Reportar!"}).then(t=>{t.isConfirmed&&x.default.fire({title:"Listo",text:"La informaci\xF3n fue enviada con exito",icon:"success",showConfirmButton:!1,timer:5e3,toast:!0,timerProgressBar:!0,position:"top-end"})})}filterProductos(){this.searchTerm.trim()===""?this.filteredProductos=[]:this.usarListaAntigua?this.filteredProductos=this.productoService.productos().filter(e=>e.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&e.marca===this.MarcaSelected&&e.linea==="Antigua"):this.filteredProductos=this.productoService.productos().filter(e=>e.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&e.marca===this.MarcaSelected&&e.linea!="Antigua")}AgregarProducto(e){this.ReporteSeleccionado.productos.find(t=>t.producto._id===e._id)||(this.ReporteSeleccionado.productos.push({producto:e,inicio:0,final:0,cantidad:0}),this.filterProductos())}EliminarProducto(e){this.ReporteSeleccionado.productos.splice(e,1)}cambiar(){this.loading=!1,this.RefreshPage()}GuardarReporte(){this.loading=!1,this.reportes.NuevoReporte(this.formatearReporte(this.ReporteSeleccionado)),this.RefreshPage(),this.EditarReporte=!1}formatearReporte(e){return $(O({},e),{cliente:e.cliente._id,promotora:e.promotora._id,productos:e.productos.map(t=>$(O({},t),{producto:t.producto._id}))})}agruparYCalcularTotales=e=>e.reduce((t,m)=>{let d=m.cliente.cliente;t[d]||(t[d]={cantidadReportes:0,totalProductosVendidos:0,totalMystic:0,totalQerametik:0}),t[d].cantidadReportes++;let f=m.productos.reduce((Q,S)=>Q+S.cantidad,0);return m.cliente.marca==="Mystic"?t[d].totalMystic+=f:m.cliente.marca==="Qerametik"&&(t[d].totalQerametik+=f),t[d].totalProductosVendidos+=f,t},{});static \u0275fac=function(t){return new(t||o)(Z(ct))};static \u0275cmp=tt({type:o,selectors:[["app-promotoras"]],decls:2,vars:1,consts:[[1,"card",2,"background","linear-gradient(to right, #001a72, #003c99, #005ebf, #4a9dc1, #6bcaba)","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Progreso"],[1,"control"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","change","ngModel"],[3,"value"],[1,"columns"],[1,"column","is-4"],[1,"card"],[1,"title"],["id","marcas"],["id","lineas"],[1,"table","is-fullwidth","is-striped"],[1,"button",2,"background-color","transparent","border","none","color","rgb(192, 102, 102)",3,"click"],[1,"icon"],[1,"fas","fa-trash-alt"],[4,"ngFor","ngForOf"],[3,"routerLink"]],template:function(t,m){t&1&&M(0,Wt,40,10)(1,jt,1,0),t&2&&B(m.loading_perfil?0:1)},dependencies:[lt,rt,st,gt,yt,bt,_t,Ct,ht,ut,ft,pt,dt],encapsulation:2})};export{H as default};
