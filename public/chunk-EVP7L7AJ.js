import{a as ai}from"./chunk-IWEUP4I2.js";import{a as _i,b as ri}from"./chunk-MQDM5MFM.js";import{g as z,i as J}from"./chunk-2LV7HNH4.js";import{c as K,d as X,g as Z,h as ii,i as ti,j as ni}from"./chunk-NNPNTJPV.js";import"./chunk-TZTC4YCF.js";import{a as ei}from"./chunk-O4672A62.js";import{a as oi}from"./chunk-UGQNDCKZ.js";import{$a as E,Ia as O,Na as p,Tb as H,Vb as G,Wa as u,X as w,Xb as Q,Ya as m,Yb as W,Za as v,Zb as Y,_a as b,ab as r,bb as _,cb as d,da as P,db as k,ea as T,eb as y,fb as a,ib as c,jb as g,kb as F,lb as D,mb as B,nb as N,ob as L,pb as q,rb as A,sb as R,tb as I,ub as $,vb as U,wb as M,za as s}from"./chunk-BH4UYFV3.js";var li=()=>["/dashboard/planificacion"],ci=()=>["/dashboard/charts"],si=i=>["/dashboard/promotora",i],di=i=>({rotado:i}),V=(i,n)=>({oculto:i,activo:n});function pi(i,n){i&1&&d(0,"app-loadings")}function mi(i,n){if(i&1&&(r(0,"option",17),c(1),_()),i&2){let t=n.$implicit,e=n.$index;u("value",e),s(),g(t.mes)}}function Ci(i,n){if(i&1){let t=k();r(0,"div",3)(1,"div",4)(2,"label",11),c(3,"Mes"),_(),r(4,"div",12)(5,"select",16),q("ngModelChange",function(o){P(t);let l=a(2);return L(l.indexPlanificacion,o)||(l.indexPlanificacion=o),T(o)}),y("change",function(){P(t);let o=a(2);return T(o.cambiarPlanificacion())}),b(6,mi,2,2,"option",17,v),_()()(),r(8,"div",4)(9,"label",11),c(10,"Inicio"),_(),d(11,"input",18),_(),r(12,"div",4)(13,"label",11),c(14,"Cierre"),_(),d(15,"input",18),_()()}if(i&2){let t=a(2);s(5),N("ngModel",t.indexPlanificacion),s(),E(t.planificacionService.planificacion()),s(5),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].inicio)),s(4),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].cierre))}}function fi(i,n){if(i&1&&p(0,Ci,16,3,"div",3),i&2){let t=a();m(t.indexPlanificacion?0:-1)}}function ui(i,n){i&1&&d(0,"app-loadings")}function xi(i,n){i&1&&d(0,"app-loadings")(1,"br")}function gi(i,n){i&1&&d(0,"span",29)}function Fi(i,n){i&1&&c(0," No hay reportes registrados ")}function hi(i,n){i&1&&d(0,"i",30)}function vi(i,n){i&1&&d(0,"i",31)}function bi(i,n){if(i&1&&p(0,hi,1,0,"i",30)(1,vi,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.mystic.impulso?0:1)}}function Ei(i,n){i&1&&d(0,"i",30)}function Si(i,n){i&1&&d(0,"i",31)}function Pi(i,n){if(i&1&&p(0,Ei,1,0,"i",30)(1,Si,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.qerametik.impulso?0:1)}}function Ti(i,n){if(i&1&&p(0,bi,2,1)(1,Pi,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function yi(i,n){i&1&&d(0,"i",30)}function $i(i,n){i&1&&d(0,"i",31)}function wi(i,n){if(i&1&&p(0,yi,1,0,"i",30)(1,$i,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.mystic.evento?0:1)}}function ki(i,n){i&1&&d(0,"i",30)}function Di(i,n){i&1&&d(0,"i",31)}function Ii(i,n){if(i&1&&p(0,ki,1,0,"i",30)(1,Di,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.qerametik.evento?0:1)}}function Mi(i,n){if(i&1&&p(0,wi,2,1)(1,Ii,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function Ai(i,n){if(i&1&&p(0,Ti,2,1)(1,Mi,2,1),i&2){let t=a(2).$implicit;m(t.tipo==="Impulso"?0:1)}}function Ri(i,n){i&1&&d(0,"i",30)}function Vi(i,n){i&1&&d(0,"i",31)}function ji(i,n){if(i&1&&p(0,Ri,1,0,"i",30)(1,Vi,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.mystic.impulso?0:1)}}function Oi(i,n){i&1&&d(0,"i",30)}function Bi(i,n){i&1&&d(0,"i",31)}function Ni(i,n){if(i&1&&p(0,Oi,1,0,"i",30)(1,Bi,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.qerametik.impulso?0:1)}}function Li(i,n){if(i&1&&p(0,ji,2,1)(1,Ni,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function qi(i,n){i&1&&d(0,"i",30)}function Ui(i,n){i&1&&d(0,"i",31)}function Hi(i,n){if(i&1&&p(0,qi,1,0,"i",30)(1,Ui,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.mystic.evento?0:1)}}function Gi(i,n){i&1&&d(0,"i",30)}function Qi(i,n){i&1&&d(0,"i",31)}function Wi(i,n){if(i&1&&p(0,Gi,1,0,"i",30)(1,Qi,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.qerametik.evento?0:1)}}function Yi(i,n){if(i&1&&p(0,Hi,2,1)(1,Wi,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function zi(i,n){if(i&1&&p(0,Li,2,1)(1,Yi,2,1),i&2){let t=a(2).$implicit;m(t.tipo==="Impulso"?0:1)}}function Ji(i,n){if(i&1&&(r(0,"div"),c(1),$(2,"number"),p(3,Ai,2,1)(4,zi,2,1),_(),c(5,"\xA0 ")),i&2){let t=a().$implicit,e=a(4).$implicit;s(),B(" \xA0(",t.productos[0].marca,")\xA0 ",t.totalSubtotal," productos (",M(2,4,t.totalPuntos,"2.2-2")," Puntos) "),s(2),m(e.fija?3:4)}}function Ki(i,n){i&1&&c(0," Falta justificada ")}function Xi(i,n){if(i&1&&p(0,Ji,6,7)(1,Ki,1,0),i&2){let t=n.$implicit;m(t.productos[0]?0:1)}}function Zi(i,n){if(i&1&&b(0,Xi,2,1,null,null,v),i&2){let t=a().$implicit,e=a(2).$implicit,o=a(2);E(o.getReportesPorFecha(e.nombre,e.apellido,t))}}function it(i,n){if(i&1&&c(0),i&2){let t=a().$implicit;F(" ",t.productos[0].marca," ")}}function tt(i,n){if(i&1&&(r(0,"tr")(1,"td"),c(2),_(),r(3,"td"),c(4),_(),r(5,"td"),c(6),_(),r(7,"td"),c(8),_(),r(9,"td"),c(10),_(),r(11,"td"),c(12),_(),r(13,"td"),c(14),_()()),i&2){let t=n.$implicit;s(2),g(t.linea),s(2),g(t.marca),s(2),D("",t.producto," (",t.puntos," Ptos.)"),s(2),g(t.inicio),s(2),g(t.final),s(2),g(t.cantidad),s(2),g(t.puntosTotales)}}function nt(i,n){if(i&1&&(r(0,"div",27)(1,"b"),c(2,"Establecimiento:"),_(),c(3),d(4,"br"),r(5,"b"),c(6,"Tipo:"),_(),c(7),d(8,"br"),r(9,"b"),c(10,"Marca:"),_(),p(11,it,1,1),d(12,"br"),r(13,"b"),c(14,"Observaci\xF3n:"),_(),c(15),d(16,"hr"),r(17,"table",32)(18,"thead")(19,"tr")(20,"th"),c(21,"Linea"),_(),r(22,"th"),c(23,"Marca"),_(),r(24,"th"),c(25,"Producto"),_(),r(26,"th"),c(27,"Inicio"),_(),r(28,"th"),c(29,"Final"),_(),r(30,"th"),c(31,"Cantidad (Und)"),_(),r(32,"th"),c(33,"Puntos"),_()()(),r(34,"tbody"),b(35,tt,15,8,"tr",null,v),_()()()),i&2){let t=n.$implicit,e=a(2).$index,o=a(2).$index,l=a(2);u("ngClass",I(6,V,!l.toggleVentas[o]||!l.toggleVentas[o][e],l.toggleVentas[o]&&l.toggleVentas[o][e])),s(3),F(" ",t.cliente," "),s(4),F(" ",t.tipo," "),s(4),m(t.productos[0]?11:-1),s(4),F(" ",t.observacion," "),s(2),u("ngClass",I(9,V,!l.toggleVentas[o]||!l.toggleVentas[o][e],l.toggleVentas[o]&&l.toggleVentas[o][e])),s(18),E(t.productos)}}function et(i,n){if(i&1&&b(0,nt,37,12,"div",27,v),i&2){let t=a().$implicit,e=a(2).$implicit,o=a(2);E(o.getReportesPorFecha(e.nombre,e.apellido,t))}}function ot(i,n){if(i&1){let t=k();r(0,"div")(1,"div",19)(2,"header",20)(3,"p",21),c(4),p(5,Fi,1,0)(6,Zi,2,0),_(),r(7,"button",24),y("click",function(){let o=P(t).$index,l=a(2).$index,f=a(2);return T(f.toggleVentaSection(l,o))}),r(8,"span",7),d(9,"i",26),_()()(),p(10,et,2,0),_()(),d(11,"br")}if(i&2){let t=n.$implicit,e=a(2).$implicit,o=a(2);s(4),F(" ",t," - "),s(),m(o.getReportesPorFecha(e.nombre,e.apellido,t)===void 0?5:6),s(5),m(o.getReportesPorFecha(e.nombre,e.apellido,t)?10:-1)}}function at(i,n){if(i&1){let t=k();r(0,"div",19)(1,"header",20)(2,"p",21),p(3,gi,1,0,"span",22),c(4,"\xA0"),r(5,"span"),c(6),_(),c(7,"\xA0-\xA0 "),r(8,"a",23),c(9),_(),c(10),$(11,"number"),$(12,"number"),_(),r(13,"button",24),y("click",function(){P(t);let o=a().$index,l=a(2);return T(l.togglePromotoraSection(o))}),r(14,"span",25),d(15,"i",26),_()()(),r(16,"div",27)(17,"table",28)(18,"tr")(19,"th"),c(20,"Vendido"),_(),r(21,"th"),c(22,"Incentivo"),_()(),r(23,"tr")(24,"td"),c(25),_(),r(26,"td"),c(27),$(28,"currency"),_()()(),b(29,ot,12,3,null,null,v),_()()}if(i&2){let t=a(),e=t.$implicit,o=t.$index,l=a(2);s(3),u("ngIf",l.noHuboReporteAyer(e.nombre,e.apellido)),s(3),g(e.marca),s(2),u("routerLink",R(19,si,e._id)),s(),D("",e.nombre," ",e.apellido,""),s(),D("\xA0",M(11,11,l.getPuntos(e.nombre,e.apellido)||0,"2.2-2")," puntos - ",U(12,14,l.buscarDiasTrabajados(e.nombre,e.apellido))," dia(s) trabajado(s) "),s(4),u("ngClass",R(21,di,l.isRotated[o])),s(2),u("ngClass",I(23,V,!l.togglePromotora[o],l.togglePromotora[o])),s(9),F("",l.getGastado(e.nombre,e.apellido)," productos"),s(2),F("",M(28,16,l.obtenerIncentivo(e.nombre,e.apellido).totales,"USD")," "),s(2),E(l.getFechasDelRango())}}function _t(i,n){if(i&1&&p(0,xi,2,0)(1,at,31,26,"div",19),i&2){let t=a(2);m(t.Cargando?0:1)}}function rt(i,n){if(i&1&&b(0,_t,2,1,null,null,v),i&2){let t=a();E(t.promotorasFiltered)}}var j=class i{ReportesServices=w(ri);promotoras=w(ai);planificacionService=w(_i);active=!1;indexPlanificacion=0;promotorasFiltered=[];promotoras__=!0;Cargando=!1;promotorasFilteredFunction(n){n.value==="fija"?(this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!0),this.promotoras__=!0):(this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!1),this.promotoras__=!1),this.cambiarPlanificacion()}reportesAgrupados=[];togglePromotora=[];toggleVentas={};isRotated=[];isRotated_={};constructor(){setTimeout(()=>{this.planificacionService.loading()||(this.indexPlanificacion=this.planificacionService.planificacion().length-1,this.promotorasFilteredFunction({value:"fija"}),this.ReportesServices.getReportesAgrupados(this.promotoras__,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:n=>{this.reportesAgrupados=n},error:n=>{console.error("Error al cargar los reportes:",n)}}))},500)}cambiarPlanificacion(){setTimeout(()=>{this.Cargando=!0,this.planificacionService.loading()||this.ReportesServices.getReportesAgrupados(this.promotoras__,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:n=>{this.reportesAgrupados=n,this.Cargando=!1},error:n=>{console.error("Error al cargar los reportes:",n)}})},500)}simplificar(n){return n.split("T")[0]}togglePromotoraSection(n){this.togglePromotora[n]=!this.togglePromotora[n],this.isRotated[n]=!this.isRotated[n]}toggleVentaSection(n,t){this.toggleVentas[n]||(this.toggleVentas[n]=[]),this.toggleVentas[n][t]=!this.toggleVentas[n][t]}getPuntos(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?e.puntosAcumulados:0}buscarDiasTrabajados(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?new Set(e.reportes.map(l=>l.fecha)).size:0}sueldodiario(n,t){return Number(n)/t}getGastado(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?e.totalGastado:0}getReportes(n,t){let e=`${n} ${t}`,o=this.reportesAgrupados.find(l=>l.promotora===e);return o?o.reportes:[]}getFechasDelRango(){let n=new Date,t=new Date(n);t.setDate(n.getDate()+1);let e=t,o=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].inicio);new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre)<n&&(e=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre));let l=[];for(;o<=e;){let f=new Date(o);f.setDate(f.getDate()+1),l.push(this.formatFecha(f)),o.setDate(o.getDate()+1)}return l}formatFecha(n){let t=("0"+n.getDate()).slice(-2),e=("0"+(n.getMonth()+1)).slice(-2),o=n.getFullYear();return`${t}/${e}/${o}`}getReportesPorFecha(n,t,e){let o=`${n} ${t}`,l=this.convertirFechaAISO(e),f=this.reportesAgrupados.find(C=>C.promotora===o);if(f){let C=f.reportes.filter(S=>S.fecha===l);return C.length>0?C:void 0}else return}convertirFechaAISO(n){let[t,e,o]=n.split("/");return`${o}-${e.padStart(2,"0")}-${t.padStart(2,"0")}`}calcularDiasHabiles(n,t){let e=new Date(n),o=new Date(t),l=0;if(e>o){let C=e;e=o,o=C}let f=new Date(e);for(;f<=o;){let C=f.getDay();C!==0&&C!==6&&l++,f.setDate(f.getDate()+1)}return l}puntos(n){return n||0}obtenerIncentivo(n,t){let e=this.reportesAgrupados.find(x=>x.promotora===`${n} ${t}`),o=0,l=0;e&&(o=e.puntosMystic,l=e.puntosQerametik);let f=0,C=0,S=0;if(o<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[0].de)C=0;else for(let x=0;x<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos.length;x++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[x];o>=h.de&&o<=h.hasta&&(C=h.incentivo)}if(l<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[0].de)S=0;else for(let x=0;x<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik.length;x++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[x];l>=h.de&&l<=h.hasta&&(S=h.incentivo)}return{totales:C+S,mystic:C,qerametik:S}}noHuboReporteAyer(n,t){let e=new Date;e.setDate(e.getDate()-1);let o=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0"),C=`${String(e.getDate()).padStart(2,"0")}/${l}/${o}`;return!this.getReportesPorFecha(n,t,C)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=O({type:i,selectors:[["app-estadisticas"]],decls:33,vars:6,consts:[[1,"card",2,"background","linear-gradient(180deg, rgba(0,26,114,1) 0%, rgba(53,164,182,1) 49%, rgba(107,202,186,1) 100%)","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Estad\xEDsticas"],[1,"field","is-grouped"],[1,"control"],[1,"button","is-primary",3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-chart-pie"],[1,"header"],[1,"field"],["for","",1,"label"],[1,"select"],[3,"change"],["value","fija"],["value","por destajo"],[3,"ngModelChange","change","ngModel"],[3,"value"],["type","date","disabled","",1,"input",3,"value"],[1,"card"],[1,"card-header"],[1,"card-header-title"],["class","punto-rojo",4,"ngIf"],[3,"routerLink"],["aria-label","more options",1,"card-header-icon",3,"click"],[1,"icon",3,"ngClass"],["aria-hidden","true",1,"fas","fa-angle-down"],[1,"card-content",3,"ngClass"],[1,"table","is-fullwidth"],[1,"punto-rojo"],[1,"far","fa-thumbs-up",2,"color","rgb(129, 228, 129)"],[1,"far","fa-thumbs-down",2,"color","rgb(228, 129, 129)"],[1,"table","is-fullwidth","is-striped",3,"ngClass"]],template:function(t,e){t&1&&(r(0,"div",0)(1,"div",1),d(2,"app-title",2),_()(),d(3,"hr"),r(4,"div",3)(5,"div",4)(6,"button",5)(7,"span"),c(8,"Nueva planificaci\xF3n"),_()()(),r(9,"div",4)(10,"button",6)(11,"span",7),d(12,"i",8),_(),r(13,"span"),c(14,"Ver gr\xE1ficas"),_()()()(),d(15,"br")(16,"br"),r(17,"span",9),p(18,pi,1,0,"app-loadings")(19,fi,1,1),d(20,"br"),_(),r(21,"div",10)(22,"div",4)(23,"label",11),c(24,"Promotoras"),_(),r(25,"div",12)(26,"select",13),y("change",function(l){return e.promotorasFilteredFunction(l.target)}),r(27,"option",14),c(28,"Fijas"),_(),r(29,"option",15),c(30,"Por destajo"),_()()()()(),p(31,ui,1,0,"app-loadings")(32,rt,2,0)),t&2&&(s(6),u("routerLink",A(4,li)),s(4),u("routerLink",A(5,ci)),s(8),m(e.planificacionService.loading()?18:19),s(13),m(e.planificacionService.loading()?31:32))},dependencies:[ei,Y,H,G,Q,W,ni,ii,ti,Z,K,X,oi,J,z],styles:['@charset "UTF-8";.oculto[_ngcontent-%COMP%]{overflow:hidden;max-height:0px;padding:0;margin:0;transition:max-height .5s ease-out,padding .3s ease-out,margin .3s ease-out}.activo[_ngcontent-%COMP%]{transition:max-height .9s ease-out,padding .3s ease-out,margin .3s ease-out}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.icon.rotado[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:rotate(180deg)}.low[_ngcontent-%COMP%]{color:#e48181;font-weight:bolder}.hight[_ngcontent-%COMP%]{color:#81e481;font-weight:bolder}.punto-rojo[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;background-color:red;border-radius:50%;animation:_ngcontent-%COMP%_parpadeo 1s infinite;margin-left:5px}@keyframes _ngcontent-%COMP%_parpadeo{0%,to{opacity:1}50%{opacity:0}}']})};export{j as default};
