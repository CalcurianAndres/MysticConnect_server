import{a as ni}from"./chunk-P7RRBNRB.js";import{a as ii}from"./chunk-FHNKFYOF.js";import{a as ti}from"./chunk-EC3ZKULI.js";import{a as oi}from"./chunk-DW5AZQJG.js";import{a as ei}from"./chunk-TA66JFPR.js";import{f as W,h as Y}from"./chunk-AQIQSVC7.js";import{c as z,d as J,g as K,h as Q,i as X,j as Z}from"./chunk-UYLEAET2.js";import"./chunk-HUNMWK37.js";import{$a as E,Ia as V,Na as p,Ub as N,Vb as L,Wa as C,X as S,Xb as G,Ya as m,Yb as q,Za as h,Zb as H,_a as v,ab as r,bb as _,cb as s,da as P,db as y,ea as T,eb as $,fb as l,ib as c,jb as x,kb as g,mb as k,nb as A,ob as j,pb as O,qb as B,sb as I,tb as w,ub as D,vb as F,wb as U,xb as b,za as d}from"./chunk-5XISTBJQ.js";var _i=()=>["/dashboard/planificacion"],li=()=>["/dashboard/charts"],ri=i=>({rotado:i}),M=(i,e)=>({oculto:i,activo:e}),ci=i=>({low:i});function di(i,e){i&1&&s(0,"app-loadings")}function si(i,e){if(i&1&&(r(0,"option",17),c(1),_()),i&2){let n=e.$implicit,t=e.$index;C("value",t),d(),x(n.mes)}}function pi(i,e){if(i&1){let n=y();r(0,"div",3)(1,"div",4)(2,"label",11),c(3,"Mes"),_(),r(4,"div",12)(5,"select",16),B("ngModelChange",function(a){P(n);let o=l(2);return O(o.indexPlanificacion,a)||(o.indexPlanificacion=a),T(a)}),v(6,si,2,2,"option",17,h),_()()(),r(8,"div",4)(9,"label",11),c(10,"Inicio"),_(),s(11,"input",18),_(),r(12,"div",4)(13,"label",11),c(14,"Cierre"),_(),s(15,"input",18),_()()}if(i&2){let n=l(2);d(5),j("ngModel",n.indexPlanificacion),d(),E(n.planificacionService.planificacion()),d(5),C("value",n.planificacionService.planificacion()[n.indexPlanificacion].inicio),d(4),C("value",n.planificacionService.planificacion()[n.indexPlanificacion].cierre)}}function mi(i,e){if(i&1&&p(0,pi,16,3,"div",3),i&2){let n=l();m(n.indexPlanificacion?0:-1)}}function Ci(i,e){i&1&&s(0,"app-loadings")}function ui(i,e){i&1&&s(0,"app-loadings")(1,"br")}function fi(i,e){i&1&&s(0,"span",29)}function xi(i,e){i&1&&c(0," No hay reportes registrados ")}function gi(i,e){i&1&&s(0,"i",30)}function Fi(i,e){i&1&&s(0,"i",31)}function bi(i,e){if(i&1&&p(0,gi,1,0,"i",30)(1,Fi,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.tradicional.mystic.impulso?0:1)}}function hi(i,e){i&1&&s(0,"i",30)}function vi(i,e){i&1&&s(0,"i",31)}function Ei(i,e){if(i&1&&p(0,hi,1,0,"i",30)(1,vi,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.tradicional.qerametik.impulso?0:1)}}function Si(i,e){if(i&1&&p(0,bi,2,1)(1,Ei,2,1),i&2){let n=l(2).$implicit;m(n.marca==="Mystic"?0:1)}}function Pi(i,e){i&1&&s(0,"i",30)}function Ti(i,e){i&1&&s(0,"i",31)}function yi(i,e){if(i&1&&p(0,Pi,1,0,"i",30)(1,Ti,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.tradicional.mystic.evento?0:1)}}function $i(i,e){i&1&&s(0,"i",30)}function Di(i,e){i&1&&s(0,"i",31)}function Ii(i,e){if(i&1&&p(0,$i,1,0,"i",30)(1,Di,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.tradicional.qerametik.evento?0:1)}}function wi(i,e){if(i&1&&p(0,yi,2,1)(1,Ii,2,1),i&2){let n=l(2).$implicit;m(n.marca==="Mystic"?0:1)}}function Mi(i,e){if(i&1&&p(0,Si,2,1)(1,wi,2,1),i&2){let n=l().$implicit;m(n.tipo==="Impulso"?0:1)}}function Ri(i,e){i&1&&s(0,"i",30)}function Vi(i,e){i&1&&s(0,"i",31)}function ki(i,e){if(i&1&&p(0,Ri,1,0,"i",30)(1,Vi,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.rebranding.mystic.impulso?0:1)}}function Ai(i,e){i&1&&s(0,"i",30)}function ji(i,e){i&1&&s(0,"i",31)}function Oi(i,e){if(i&1&&p(0,Ai,1,0,"i",30)(1,ji,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.rebranding.qerametik.impulso?0:1)}}function Bi(i,e){if(i&1&&p(0,ki,2,1)(1,Oi,2,1),i&2){let n=l(2).$implicit;m(n.marca==="Mystic"?0:1)}}function Ui(i,e){i&1&&s(0,"i",30)}function Ni(i,e){i&1&&s(0,"i",31)}function Li(i,e){if(i&1&&p(0,Ui,1,0,"i",30)(1,Ni,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.rebranding.mystic.evento?0:1)}}function Gi(i,e){i&1&&s(0,"i",30)}function qi(i,e){i&1&&s(0,"i",31)}function Hi(i,e){if(i&1&&p(0,Gi,1,0,"i",30)(1,qi,1,0,"i",31),i&2){let n=l(3).$implicit,t=l(7);m(t.puntos(n.totalPuntos)>=t.planificacionService.planificacion()[t.indexPlanificacion].metas.rebranding.qerametik.evento?0:1)}}function Wi(i,e){if(i&1&&p(0,Li,2,1)(1,Hi,2,1),i&2){let n=l(2).$implicit;m(n.marca==="Mystic"?0:1)}}function Yi(i,e){if(i&1&&p(0,Bi,2,1)(1,Wi,2,1),i&2){let n=l().$implicit;m(n.tipo==="Impulso"?0:1)}}function zi(i,e){if(i&1&&(r(0,"div"),c(1),F(2,"currency"),p(3,Mi,2,1)(4,Yi,2,1),_(),c(5,"\xA0 ")),i&2){let n=e.$implicit,t=l(5).$implicit;d(),k(" \xA0(",n.marca,")\xA0 ",b(2,4,n.totalSubtotal,"USD")," (",n.totalPuntos," Puntos) "),d(2),m(t.fija?3:4)}}function Ji(i,e){if(i&1&&v(0,zi,6,7,null,null,h),i&2){let n=l().$implicit,t=l(3).$implicit,a=l(2);E(a.getReportesPorFecha(t.nombre,t.apellido,n))}}function Ki(i,e){if(i&1&&(r(0,"tr")(1,"td"),c(2),_(),r(3,"td"),c(4),_(),r(5,"td"),c(6),_(),r(7,"td"),c(8),_(),r(9,"td"),c(10),_(),r(11,"td"),c(12),F(13,"currency"),_()()),i&2){let n=e.$implicit;d(2),x(n.linea),d(2),x(n.marca),d(2),x(n.producto),d(2),x(n.cantidad),d(2),x(n.puntosTotales),d(2),x(b(13,6,n.subtotal,"USD"))}}function Qi(i,e){if(i&1&&(r(0,"div",26)(1,"b"),c(2,"Establecimiento:"),_(),c(3),s(4,"br"),r(5,"b"),c(6,"Tipo:"),_(),c(7),s(8,"br"),r(9,"b"),c(10,"Marca:"),_(),c(11),s(12,"br"),r(13,"b"),c(14,"Observaci\xF3n:"),_(),c(15),s(16,"hr"),r(17,"table",32)(18,"thead")(19,"tr")(20,"th"),c(21,"Linea"),_(),r(22,"th"),c(23,"Marca"),_(),r(24,"th"),c(25,"Producto"),_(),r(26,"th"),c(27,"Cantidad (Und)"),_(),r(28,"th"),c(29,"Puntos"),_(),r(30,"th"),c(31,"Subtotal (USD)"),_()()(),r(32,"tbody"),v(33,Ki,14,9,"tr",null,h),_()()()),i&2){let n=e.$implicit,t=l(2).$index,a=l(3).$index,o=l(2);C("ngClass",D(6,M,!o.toggleVentas[a]||!o.toggleVentas[a][t],o.toggleVentas[a]&&o.toggleVentas[a][t])),d(3),g(" ",n.cliente," "),d(4),g(" ",n.tipo," "),d(4),g(" ",n.marca," "),d(4),g(" ",n.observacion," "),d(2),C("ngClass",D(9,M,!o.toggleVentas[a]||!o.toggleVentas[a][t],o.toggleVentas[a]&&o.toggleVentas[a][t])),d(16),E(n.productos)}}function Xi(i,e){if(i&1&&v(0,Qi,35,12,"div",26,h),i&2){let n=l().$implicit,t=l(3).$implicit,a=l(2);E(a.getReportesPorFecha(t.nombre,t.apellido,n))}}function Zi(i,e){if(i&1){let n=y();r(0,"div")(1,"div",19)(2,"header",20)(3,"p",21),c(4),p(5,xi,1,0)(6,Ji,2,0),_(),r(7,"button",23),$("click",function(){let a=P(n).$index,o=l(3).$index,f=l(2);return T(f.toggleVentaSection(o,a))}),r(8,"span",7),s(9,"i",25),_()()(),p(10,Xi,2,0),_()(),s(11,"br")}if(i&2){let n=e.$implicit,t=l(3).$implicit,a=l(2);d(4),g(" ",n," - "),d(),m(a.getReportesPorFecha(t.nombre,t.apellido,n)===void 0?5:6),d(5),m(a.getReportesPorFecha(t.nombre,t.apellido,n)?10:-1)}}function it(i,e){if(i&1&&v(0,Zi,12,3,null,null,h),i&2){let n=l(4);E(n.getFechasDelRango())}}function tt(i,e){if(i&1&&(c(0),s(1,"app-loadings")),i&2){let n=l(4);g(" ",n.indexPlanificacion," ")}}function nt(i,e){if(i&1){let n=y();r(0,"div",19)(1,"header",20)(2,"p",21),p(3,fi,1,0,"span",22),c(4),F(5,"currency"),F(6,"number"),_(),r(7,"button",23),$("click",function(){P(n);let a=l().$index,o=l(2);return T(o.togglePromotoraSection(a))}),r(8,"span",24),s(9,"i",25),_()()(),r(10,"div",26)(11,"table",27)(12,"tr")(13,"th"),c(14,"Vendido"),_(),r(15,"th"),c(16,"Sueldo"),_(),r(17,"th"),c(18,"Incentivo"),_(),r(19,"th"),c(20,"Incidencia"),_()(),r(21,"tr")(22,"td"),c(23),F(24,"currency"),_(),r(25,"td"),c(26),F(27,"currency"),_(),r(28,"td"),c(29),F(30,"currency"),_(),r(31,"td",28),c(32),F(33,"number"),_()()(),p(34,it,2,0)(35,tt,2,1),_()()}if(i&2){let n=l(),t=n.$implicit,a=n.$index,o=l(2);d(3),C("ngIf",o.noHuboReporteAyer(t.nombre,t.apellido)),d(),A("\xA0 ",t.nombre," ",t.apellido," (",o.getPuntos(t.nombre,t.apellido)||0," puntos - ",b(5,14,o.obtenerIncentivo(o.puntos(o.getPuntos(t.nombre,t.apellido)),o.planificacionService.planificacion()[o.indexPlanificacion].incentivos),"USD")," Incentivo) - ",U(6,17,o.buscarDiasTrabajados(t.nombre,t.apellido))," dia(s) trabajado(s) "),d(4),C("ngClass",w(31,ri,o.isRotated[a])),d(2),C("ngClass",D(33,M,!o.togglePromotora[a],o.togglePromotora[a])),d(13),x(b(24,19,o.getGastado(t.nombre,t.apellido)||0,"USD")),d(3),x(b(27,22,o.sueldodiario(t.sueldo,o.buscarDiasTrabajados(t.nombre,t.apellido)),"USD")),d(3),g("",b(30,25,o.obtenerIncentivo(o.puntos(o.getPuntos(t.nombre,t.apellido)),o.planificacionService.planificacion()[o.indexPlanificacion].incentivos),"USD")," "),d(2),C("ngClass",w(36,ci,((o.puntos(t.sueldo)+o.obtenerIncentivo(o.puntos(o.getPuntos(t.nombre,t.apellido)),o.planificacionService.planificacion()[o.indexPlanificacion].incentivos))*100/o.getGastado(t.nombre,t.apellido)||0)>=40)),d(),g(" ",b(33,28,(o.puntos(t.sueldo)+o.obtenerIncentivo(o.puntos(o.getPuntos(t.nombre,t.apellido)),o.planificacionService.planificacion()[o.indexPlanificacion].incentivos))*100/o.getGastado(t.nombre,t.apellido)||0,"1.0-1"),"% "),d(2),m(o.indexPlanificacion===0?34:35)}}function et(i,e){if(i&1&&p(0,ui,2,0)(1,nt,36,38,"div",19),i&2){let n=l(2);m(n.planificacionService.planificacion()[n.indexPlanificacion]?1:0)}}function ot(i,e){if(i&1&&v(0,et,2,1,null,null,h),i&2){let n=l();E(n.promotorasFiltered)}}var R=class i{ReportesServices=S(oi);promotoras=S(ni);planificacionService=S(ei);active=!1;indexPlanificacion=0;promotorasFiltered=[];promotorasFilteredFunction(e){e.value==="fija"?this.promotorasFiltered=this.promotoras.users().filter(n=>n.fija===!0):this.promotorasFiltered=this.promotoras.users().filter(n=>n.fija===!1)}reportesAgrupados=[];togglePromotora=[];toggleVentas={};isRotated=[];isRotated_={};constructor(){this.ReportesServices.getReportesAgrupados().subscribe({next:e=>{this.reportesAgrupados=e,console.log(this.reportesAgrupados)},error:e=>{console.error("Error al cargar los reportes:",e)}}),setTimeout(()=>{this.planificacionService.loading()||(this.indexPlanificacion=this.planificacionService.planificacion().length-1,this.promotorasFilteredFunction({value:"fija"}))},1e3)}togglePromotoraSection(e){this.togglePromotora[e]=!this.togglePromotora[e],this.isRotated[e]=!this.isRotated[e]}toggleVentaSection(e,n){this.toggleVentas[e]||(this.toggleVentas[e]=[]),this.toggleVentas[e][n]=!this.toggleVentas[e][n]}getPuntos(e,n){let t=this.reportesAgrupados.find(a=>a.promotora===`${e} ${n}`);return t?t.puntosAcumulados:0}buscarDiasTrabajados(e,n){let t=this.reportesAgrupados.find(a=>a.promotora===`${e} ${n}`);return t?new Set(t.reportes.map(o=>o.fecha)).size:0}sueldodiario(e,n){return Number(e)/n}getGastado(e,n){let t=this.reportesAgrupados.find(a=>a.promotora===`${e} ${n}`);return t?t.totalGastado:0}getReportes(e,n){let t=`${e} ${n}`,a=this.reportesAgrupados.find(o=>o.promotora===t);return a?a.reportes:[]}getFechasDelRango(){let e=new Date,n=new Date(e);n.setDate(e.getDate()+1);let t=n,a=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].inicio);new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre)<=e&&(t=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre));let o=[];for(;a<=t;)o.push(this.formatFecha(a)),a.setDate(a.getDate()+1);return o}formatFecha(e){let n=("0"+e.getDate()).slice(-2),t=("0"+(e.getMonth()+1)).slice(-2),a=e.getFullYear();return`${n}/${t}/${a}`}getReportesPorFecha(e,n,t){let a=`${e} ${n}`,o=this.convertirFechaAISO(t),f=this.reportesAgrupados.find(u=>u.promotora===a);if(f){let u=f.reportes.filter(ai=>ai.fecha===o);return u.length>0?u:void 0}else return}convertirFechaAISO(e){let[n,t,a]=e.split("/");return`${a}-${t.padStart(2,"0")}-${n.padStart(2,"0")}`}calcularDiasHabiles(e,n){let t=new Date(e),a=new Date(n),o=0;if(t>a){let u=t;t=a,a=u}let f=new Date(t);for(;f<=a;){let u=f.getDay();u!==0&&u!==6&&o++,f.setDate(f.getDate()+1)}return o}puntos(e){return e||0}obtenerIncentivo(e,n){if(e<n[0].de)return 0;for(let t=0;t<n.length;t++){let a=n[t];if(e>=a.de&&e<=a.hasta)return a.incentivo}return 0}noHuboReporteAyer(e,n){let t=new Date;t.setDate(t.getDate()-1);let a=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),u=`${String(t.getDate()).padStart(2,"0")}/${o}/${a}`;return!this.getReportesPorFecha(e,n,u)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=V({type:i,selectors:[["app-estadisticas"]],decls:33,vars:6,consts:[[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Estad\xEDsticas"],[1,"field","is-grouped"],[1,"control"],[1,"button","is-primary",3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-chart-pie"],[1,"header"],[1,"field"],["for","",1,"label"],[1,"select"],[3,"change"],["value","fija"],["value","por destajo"],[3,"ngModelChange","ngModel"],[3,"value"],["type","date","disabled","",1,"input",3,"value"],[1,"card"],[1,"card-header"],[1,"card-header-title"],["class","punto-rojo",4,"ngIf"],["aria-label","more options",1,"card-header-icon",3,"click"],[1,"icon",3,"ngClass"],["aria-hidden","true",1,"fas","fa-angle-down"],[1,"card-content",3,"ngClass"],[1,"table","is-fullwidth"],[3,"ngClass"],[1,"punto-rojo"],[1,"far","fa-thumbs-up",2,"color","rgb(129, 228, 129)"],[1,"far","fa-thumbs-down",2,"color","rgb(228, 129, 129)"],[1,"table","is-fullwidth","is-striped",3,"ngClass"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1),s(2,"app-title",2),_()(),s(3,"hr"),r(4,"div",3)(5,"div",4)(6,"button",5)(7,"span"),c(8,"Nueva planificaci\xF3n"),_()()(),r(9,"div",4)(10,"button",6)(11,"span",7),s(12,"i",8),_(),r(13,"span"),c(14,"Ver gr\xE1ficas"),_()()()(),s(15,"br")(16,"br"),r(17,"span",9),p(18,di,1,0,"app-loadings")(19,mi,1,1),s(20,"br"),_(),r(21,"div",10)(22,"div",4)(23,"label",11),c(24,"Promotoras"),_(),r(25,"div",12)(26,"select",13),$("change",function(o){return t.promotorasFilteredFunction(o.target)}),r(27,"option",14),c(28,"Fijas"),_(),r(29,"option",15),c(30,"Por destajo"),_()()()()(),p(31,Ci,1,0,"app-loadings")(32,ot,2,0)),n&2&&(d(6),C("routerLink",I(4,_i)),d(4),C("routerLink",I(5,li)),d(8),m(t.planificacionService.loading()?18:19),d(13),m(t.planificacionService.loading()?31:32))},dependencies:[ii,H,N,L,G,q,Z,Q,X,K,z,J,ti,Y,W],styles:['@charset "UTF-8";.oculto[_ngcontent-%COMP%]{overflow:hidden;max-height:0px;padding:0;margin:0;transition:max-height .5s ease-out,padding .3s ease-out,margin .3s ease-out}.activo[_ngcontent-%COMP%]{transition:max-height .9s ease-out,padding .3s ease-out,margin .3s ease-out}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.icon.rotado[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:rotate(180deg)}.low[_ngcontent-%COMP%]{color:#e48181;font-weight:bolder}.hight[_ngcontent-%COMP%]{color:#81e481;font-weight:bolder}.punto-rojo[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;background-color:red;border-radius:50%;animation:_ngcontent-%COMP%_parpadeo 1s infinite;margin-left:5px}@keyframes _ngcontent-%COMP%_parpadeo{0%,to{opacity:1}50%{opacity:0}}']})};export{R as default};
