import{a as h}from"./chunk-SJQBYHCF.js";import{Eb as i,Fa as g,R as l,X as m,t as d}from"./chunk-K6DX3A3E.js";var b=class c{http=m(h);#t=g({loading:!0,reportes:[]});reportes=i(()=>this.#t().reportes);loading=i(()=>this.#t().loading);ruta="https://mysticconnectserver-production.up.railway.app/api";constructor(){this.cargarReportes()}cargarReportes(){this.http.get(`${this.ruta}/reportes`).subscribe(e=>{this.#t.set({loading:!1,reportes:e})})}getReportesAgrupados(){return this.http.get(`${this.ruta}/reportes`).pipe(d(e=>{let a=e.reduce((r,t)=>{let s=t.promotora?._id;if(!s)return console.warn("Reporte sin promotora v\xE1lida:",t),r;r[s]||(r[s]={promotora:`${t.promotora.nombre} ${t.promotora.apellido}`,puntosAcumulados:0,totalGastado:0,reportes:[]});let n=t.productos.reduce((o,p)=>o+p.producto.puntos*p.cantidad,0),u=t.productos.reduce((o,p)=>o+p.producto.precio*p.cantidad,0);return r[s].puntosAcumulados+=n,r[s].totalGastado+=u,r[s].reportes.push({cliente:t.cliente.cliente,marca:t.cliente.marca,tipo:t.tipo,observacion:t.observacion,productos:t.productos.map(o=>({producto:o.producto.producto,linea:o.producto.linea,marca:o.producto.marca,cantidad:o.cantidad,subtotal:o.producto.precio*o.cantidad,puntosTotales:o.producto.puntos*o.cantidad})),fecha:t.fecha,totalPuntos:n,totalSubtotal:u}),r},{});return Object.values(a)}))}NuevoReporte(e){this.http.post(`${this.ruta}/reportes`,e).subscribe(a=>{this.cargarReportes()})}formatFecha(e){let a=("0"+e.getDate()).slice(-2),r=("0"+(e.getMonth()+1)).slice(-2),t=e.getFullYear();return`${a}/${r}/${t}`}static \u0275fac=function(a){return new(a||c)};static \u0275prov=l({token:c,factory:c.\u0275fac,providedIn:"root"})};export{b as a};
