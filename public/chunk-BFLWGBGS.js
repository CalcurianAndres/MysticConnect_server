import{a as st}from"./chunk-S3IGYESN.js";import{a as pt}from"./chunk-P2YCEQQ3.js";import{a as lt,b as ct}from"./chunk-A2RZKHZC.js";import{a as J}from"./chunk-H4O6IPU4.js";import{d as U,g as z,i as H}from"./chunk-2LV7HNH4.js";import{a as at}from"./chunk-4DQSAP2D.js";import{a as rt}from"./chunk-5A4UYOPG.js";import{c as K,d as X,g as Z,h as tt,i as et,j as it}from"./chunk-NNPNTJPV.js";import"./chunk-TZTC4YCF.js";import{a as ot}from"./chunk-ZHWJNEKA.js";import{a as nt}from"./chunk-UGQNDCKZ.js";import{$a as k,Aa as N,Ia as Y,Na as g,Ub as q,Wa as v,Wb as W,X as y,Ya as R,Za as M,Zb as G,_a as E,a as B,ab as o,b as F,bb as n,cb as m,da as b,db as T,e as dt,ea as P,eb as w,fb as _,ib as r,jb as h,lb as Q,mb as A,nb as D,ob as O,pb as $,sb as j,ub as V,wb as I,za as s}from"./chunk-BH4UYFV3.js";var C=dt(pt());var mt=i=>["/dashboard/cliente",i];function ut(i,e){if(i&1&&(o(0,"option",7),r(1),n()),i&2){let t=e.$implicit,c=e.$index;v("value",c),s(),h(t.mes)}}function ft(i,e){if(i&1){let t=T();o(0,"tr")(1,"td"),r(2),V(3,"date"),n(),o(4,"td"),r(5),n(),o(6,"td"),r(7),n(),o(8,"td")(9,"button",10),w("click",function(){let l=b(t).$implicit,d=_(3);return P(d.EditarReporte_Mystic(l._id))}),o(10,"span",11),m(11,"i",12),n()()()()}if(i&2){let t=e.$implicit;s(2),h(I(3,3,t.fecha,"dd/MM/YYYY")),s(3),h(t.puntuacionTotal),s(2),h(t.totalCantidad)}}function _t(i,e){if(i&1&&(o(0,"table",9)(1,"thead")(2,"th"),r(3,"Fecha"),n(),o(4,"th"),r(5,"Puntuacion obtenida"),n(),o(6,"th"),r(7,"Productos vendidos"),n(),o(8,"th"),r(9,"Eliminar"),n()(),o(10,"tbody"),E(11,ft,12,6,"tr",null,M),n()()),i&2){let t=_(2);s(11),k(t.ReportesFiltradosMystic)}}function ht(i,e){i&1&&m(0,"app-loadings")}function Ct(i,e){if(i&1){let t=T();o(0,"tr")(1,"td"),r(2),V(3,"date"),n(),o(4,"td"),r(5),n(),o(6,"td"),r(7),n(),o(8,"td")(9,"button",10),w("click",function(){let l=b(t).$implicit,d=_(3);return P(d.EditarReporte_Qera(l._id))}),o(10,"span",11),m(11,"i",12),n()()()()}if(i&2){let t=e.$implicit;s(2),h(I(3,3,t.fecha,"dd/MM/YYYY")),s(3),h(t.puntuacionTotal),s(2),h(t.totalCantidad)}}function xt(i,e){if(i&1&&(o(0,"table",9)(1,"thead")(2,"th"),r(3,"Fecha"),n(),o(4,"th"),r(5,"Puntuacion obtenida"),n(),o(6,"th"),r(7,"Productos vendidos"),n(),o(8,"th"),r(9,"Eliminar"),n()(),o(10,"tbody"),E(11,Ct,12,6,"tr",null,M),n()()),i&2){let t=_(2);s(11),k(t.ReportesFiltradosQerametik)}}function yt(i,e){i&1&&m(0,"app-loadings")}function gt(i,e){if(i&1&&(o(0,"tr")(1,"th")(2,"a",14),r(3),n()(),o(4,"td"),r(5),n()()),i&2){let t=e.$implicit;s(2),v("routerLink",j(5,mt,t.nombre)),s(),h(t.nombre),s(2),A("",t.totalProductosVendidos," Productos - (",t.totalMystic," Mystic) (",t.totalQerametik," Qerametik)")}}function bt(i,e){if(i&1&&(o(0,"table",9)(1,"tbody"),g(2,gt,6,7,"tr",13),n()()),i&2){let t=_(2);s(2),v("ngForOf",t.Separado_por_clientes)}}function Pt(i,e){if(i&1){let t=T();o(0,"div",0)(1,"div",1),m(2,"app-title",2),r(3),n()(),o(4,"div",3)(5,"label",4),r(6,"Mes"),n(),o(7,"div",5)(8,"select",6),$("ngModelChange",function(l){b(t);let d=_();return O(d.indexPlanificacion,l)||(d.indexPlanificacion=l),P(l)}),w("change",function(){b(t);let l=_();return P(l.cambiar())}),E(9,ut,2,2,"option",7,M),n()()(),m(11,"hr"),o(12,"span",8),r(13),n(),m(14,"hr"),g(15,_t,13,0,"table",9)(16,ht,1,0,"app-loadings"),o(17,"span",8),r(18),n(),m(19,"hr"),g(20,xt,13,0,"table",9)(21,yt,1,0,"app-loadings"),o(22,"span",8),r(23,` Ventas por cliente
`),n(),m(24,"hr"),g(25,bt,3,1,"table",9),m(26,"br")}if(i&2){let t=_();s(3),Q(" ",t.perfil.nombre," ",t.perfil.apellido," "),s(5),D("ngModel",t.indexPlanificacion),s(),k(t.planificacion.planificacion()),s(4),Q(" Progreso Mystic (",t.totalCantidadMystic," Productos - ",t.totalPuntosMystic,` Puntos)
`),s(2),R(t.loading?15:16),s(3),Q(" Progreso Qerametik (",t.totalCantidadQerametik," Productos - ",t.totalPuntosQerametik,` Puntos)
`),s(2),R(t.loading?20:21),s(5),R(t.loading_clientes?25:-1)}}function Rt(i,e){i&1&&r(0,`
Cargando perfil...
`)}var L=class i{constructor(e){this.route=e;this.route.paramMap.subscribe(t=>{let c=t.get("id");setTimeout(()=>{this.indexPlanificacion=this.planificacion.planificacion().length-1,this.loading_perfil=!0,this.perfil=this.promotora.users().find(l=>l._id===c),this.RefreshPage()},1e3)})}login=y(J);reportes=y(ct);planificacion=y(lt);clientes=y(rt);productoService=y(at);promotora=y(st);ReportesFiltradosMystic=[];ReportesFiltradosQerametik=[];loading=!1;EditarReporte=!1;ReporteSeleccionado;MarcaSelected="Mystic";searchTerm="";filteredProductos=[];usarListaAntigua=!1;modalCliente=!1;filteredClientes=[];totalCantidadMystic=0;totalPuntosMystic=0;totalCantidadQerametik=0;totalPuntosQerametik=0;perfil;loading_perfil=!1;loading_clientes=!1;indexPlanificacion=0;Separado_por_clientes=[];BuscarCliente(e){e.value.trim()===""?this.filteredClientes=[]:this.filteredClientes=this.clientes.clientes().filter(t=>t.cliente.toLowerCase().includes(e.value.toLowerCase())&&t.marca===this.MarcaSelected)}addCliente(e){this.ReporteSeleccionado.cliente=e,this.modalCliente=!1}RefreshPage(){setTimeout(()=>{if(!this.planificacion.loading()){let e=this.planificacion.planificacion()[this.indexPlanificacion];this.reportes.cargarReportes_(e.inicio,e.cierre).subscribe(t=>{this.ReportesFiltradosMystic=t.filter(a=>a.promotora._id===this.perfil._id&&a.productos[0]?.producto?.marca==="Mystic"),this.ReportesFiltradosQerametik=t.filter(a=>a.promotora._id===this.perfil._id&&a.productos[0]?.producto?.marca==="Qerametik");let c=0,l=0,d=0,S=0;this.ReportesFiltradosMystic.forEach(a=>{let p=a.productos.reduce((x,f)=>x+f.cantidad,0),u=a.productos.reduce((x,f)=>x+f.producto.puntos*f.cantidad,0);a.totalCantidad=p,a.puntuacionTotal=u,c+=p,l+=u}),this.ReportesFiltradosQerametik.forEach(a=>{let p=a.productos.reduce((x,f)=>x+f.cantidad,0),u=a.productos.reduce((x,f)=>x+f.producto.puntos*f.cantidad,0);a.totalCantidad=p,a.puntuacionTotal=u,d+=p,S+=u}),this.totalCantidadMystic=c,this.totalPuntosMystic=l,this.totalCantidadQerametik=d,this.totalPuntosQerametik=S,this.loading=!0,console.log("Total Mystic:",{cantidad:this.totalCantidadMystic,puntos:this.totalPuntosMystic}),console.log("Total Qerametik:",{cantidad:this.totalCantidadQerametik,puntos:this.totalPuntosQerametik}),this.Separado_por_clientes=this.agruparYCalcularTotales(t.filter(a=>a.promotora._id===this.perfil._id)),this.Separado_por_clientes=Object.entries(this.Separado_por_clientes).map(([a,p])=>{if(typeof p=="object"&&p!==null){let u=p;return{nombre:a,cantidadReportes:u.cantidadReportes||0,totalMystic:u.totalMystic||0,totalProductosVendidos:u.totalProductosVendidos||0,totalQerametik:u.totalQerametik||0}}return{nombre:a,id:0,cantidadReportes:0,totalMystic:0,totalProductosVendidos:0,totalQerametik:0}}).sort((a,p)=>p.totalProductosVendidos-a.totalProductosVendidos),this.loading_clientes=!0})}},1e3)}EditarReporte_Mystic(e){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosMystic.find(t=>t._id===e),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca,C.default.fire({title:"\xBFQuieres eliminar este reporte?",icon:"question",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Eliminar",denyButtonText:"No, conservar"}).then(t=>{t.isConfirmed?(this.ReporteSeleccionado.borrado=!0,this.reportes.NuevoReporte(this.ReporteSeleccionado),C.default.fire({timer:2e3,icon:"success",title:"Reporte eliminado",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0}),this.RefreshPage()):t.isDenied&&C.default.fire({timer:2e3,icon:"info",title:"No hubo cambios",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0})})},500)}EditarReporte_Qera(e){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosQerametik.find(t=>t._id===e),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca,C.default.fire({title:"\xBFQuieres eliminar este reporte?",icon:"question",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Eliminar",denyButtonText:"No, conservar"}).then(t=>{t.isConfirmed?(this.ReporteSeleccionado.borrado=!0,this.reportes.NuevoReporte(this.ReporteSeleccionado),C.default.fire({timer:2e3,icon:"success",title:"Reporte eliminado",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0}),this.RefreshPage()):t.isDenied&&C.default.fire({timer:2e3,icon:"info",title:"No hubo cambios",showConfirmButton:!1,toast:!0,position:"top-end",timerProgressBar:!0})})},500)}BorrarReporte(e){C.default.fire({title:"\xBFReportar ventas de hoy?",text:"Recuerda verificar bien las cantidades que declaras y los productos seleccionados",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Reportar!"}).then(t=>{t.isConfirmed&&C.default.fire({title:"Listo",text:"La informaci\xF3n fue enviada con exito",icon:"success",showConfirmButton:!1,timer:5e3,toast:!0,timerProgressBar:!0,position:"top-end"})})}filterProductos(){this.searchTerm.trim()===""?this.filteredProductos=[]:this.usarListaAntigua?this.filteredProductos=this.productoService.productos().filter(e=>e.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&e.marca===this.MarcaSelected&&e.linea==="Antigua"):this.filteredProductos=this.productoService.productos().filter(e=>e.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&e.marca===this.MarcaSelected&&e.linea!="Antigua")}AgregarProducto(e){this.ReporteSeleccionado.productos.find(t=>t.producto._id===e._id)||(this.ReporteSeleccionado.productos.push({producto:e,inicio:0,final:0,cantidad:0}),this.filterProductos())}EliminarProducto(e){this.ReporteSeleccionado.productos.splice(e,1)}cambiar(){this.loading=!1,this.RefreshPage()}GuardarReporte(){this.loading=!1,this.reportes.NuevoReporte(this.formatearReporte(this.ReporteSeleccionado)),this.RefreshPage(),this.EditarReporte=!1}formatearReporte(e){return F(B({},e),{cliente:e.cliente._id,promotora:e.promotora._id,productos:e.productos.map(t=>F(B({},t),{producto:t.producto._id}))})}agruparYCalcularTotales=e=>e.reduce((t,c)=>{let l=c.cliente.cliente;t[l]||(t[l]={cantidadReportes:0,totalProductosVendidos:0,totalMystic:0,totalQerametik:0}),t[l].cantidadReportes++;let d=c.productos.reduce((S,a)=>S+a.cantidad,0);return c.cliente.marca==="Mystic"?t[l].totalMystic+=d:c.cliente.marca==="Qerametik"&&(t[l].totalQerametik+=d),t[l].totalProductosVendidos+=d,t},{});static \u0275fac=function(t){return new(t||i)(N(U))};static \u0275cmp=Y({type:i,selectors:[["app-promotoras"]],decls:2,vars:1,consts:[[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Progreso"],[1,"control"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","change","ngModel"],[3,"value"],[1,"title"],[1,"table","is-fullwidth","is-striped"],[1,"button",2,"background-color","transparent","border","none","color","rgb(192, 102, 102)",3,"click"],[1,"icon"],[1,"fas","fa-trash-alt"],[4,"ngFor","ngForOf"],[3,"routerLink"]],template:function(t,c){t&1&&g(0,Pt,27,10)(1,Rt,1,0),t&2&&R(c.loading_perfil?0:1)},dependencies:[G,q,W,ot,nt,it,tt,et,Z,K,X,H,z],encapsulation:2})};export{L as default};
