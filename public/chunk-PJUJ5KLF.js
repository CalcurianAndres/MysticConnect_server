import{a as ie,b as ne,c as ae}from"./chunk-2D4G5YAQ.js";import{a as ee,b as te}from"./chunk-QUFCSMYV.js";import{d as z,g as H,i as O}from"./chunk-2LV7HNH4.js";import{c as q,d as G,g as J,h as K,i as U,j as Y}from"./chunk-NNPNTJPV.js";import"./chunk-TZTC4YCF.js";import{a as Z}from"./chunk-O4672A62.js";import{$a as b,Aa as A,Ia as B,Na as v,Tb as N,Wa as h,Wb as W,X as R,Xb as j,Ya as E,Za as g,Zb as Q,_a as S,ab as t,bb as i,cb as x,da as _,db as k,e as re,ea as u,eb as C,fb as s,ib as n,jb as p,kb as V,lb as D,nb as $,ob as L,pb as X,sb as y,ub as F,wb as T,za as c}from"./chunk-BH4UYFV3.js";var oe=re(ae());var P=o=>({"is-active":o}),le=o=>["/dashboard/promotora",o],ce=o=>["/dashboard/detalle",o];function se(o,a){if(o&1&&(t(0,"tr")(1,"td"),n(2),F(3,"date"),i(),t(4,"td"),n(5),i()()),o&2){let e=a.$implicit;c(2),p(T(3,2,e.fecha,"dd/MM/yyyy")),c(3),p(e.relleno)}}function de(o,a){if(o&1&&(t(0,"option",12),n(1),i()),o&2){let e=a.$implicit,r=a.$index;h("value",r),c(),p(e.mes)}}function pe(o,a){if(o&1&&(t(0,"tr")(1,"td"),n(2),F(3,"date"),i(),t(4,"td")(5,"a",15),n(6),i()(),t(7,"td"),n(8),i(),t(9,"td"),n(10),i(),t(11,"td")(12,"button",16)(13,"span",17),x(14,"i",18),i(),t(15,"span"),n(16,"Ver"),i()()()()),o&2){let e=a.$implicit,r=s(3);c(2),p(T(3,7,e.fecha,"dd/MM/yyyy")),c(3),h("routerLink",y(10,le,e.promotora._id)),c(),D("",e.promotora.nombre," ",e.promotora.apellido,""),c(2),p(e.productos[0].producto.marca),c(2),p(r.sumarPorductos(e)),c(2),h("routerLink",y(12,ce,e._id))}}function me(o,a){if(o&1&&(t(0,"table",4)(1,"thead")(2,"tr")(3,"th"),n(4,"Fecha"),i(),t(5,"th"),n(6,"Promotora"),i(),t(7,"th"),n(8,"Marca"),i(),t(9,"th"),n(10,"Productos vendidos"),i(),t(11,"th"),n(12,"Ver"),i()()(),t(13,"tbody"),S(14,pe,17,14,"tr",null,g),i()()),o&2){let e=s(2);c(14),b(e._reportes)}}function _e(o,a){o&1&&n(0," \xA0Vez ")}function ue(o,a){o&1&&n(0," \xA0Veces ")}function xe(o,a){if(o&1){let e=k();t(0,"tr")(1,"td"),n(2),i(),t(3,"td"),n(4),F(5,"number"),i(),t(6,"td"),n(7),v(8,_e,1,0)(9,ue,1,0),i(),t(10,"td")(11,"button",21),C("click",function(){let l=_(e).$implicit,m=s(3);return u(m.verDetalles(l.producto))}),t(12,"span",17),x(13,"i",18),i()()()()}if(o&2){let e=a.$implicit,r=s(3);c(2),p(e.producto),c(2),p(T(5,4,e.promedioFinal,"1.0-0")),c(3),V("",r.getReposiciones(e.producto).length," "),c(),E(r.getReposiciones(e.producto).length===1?8:9)}}function Ce(o,a){o&1&&n(0," \xA0Vez ")}function fe(o,a){o&1&&n(0," \xA0Veces ")}function he(o,a){if(o&1){let e=k();t(0,"tr")(1,"td"),n(2),i(),t(3,"td"),n(4),F(5,"number"),i(),t(6,"td"),n(7),v(8,Ce,1,0)(9,fe,1,0),i(),t(10,"td")(11,"button",21),C("click",function(){let l=_(e).$implicit,m=s(3);return u(m.verDetalles(l.producto))}),t(12,"span",17),x(13,"i",18),i()()()()}if(o&2){let e=a.$implicit,r=s(3);c(2),p(e.producto),c(2),p(T(5,4,e.promedioFinal,"1.0-0")),c(3),V("",r.getReposiciones(e.producto).length," "),c(),E(r.getReposiciones(e.producto).length===1?8:9)}}function ge(o,a){if(o&1){let e=k();t(0,"div",19),n(1,"Mystic"),i(),t(2,"button",20),C("click",function(){_(e);let l=s(2);return u(l.exportToExcel(l.FiltrarPorMarca("Mystic"),l.cliente,"Mystic"))}),x(3,"span",17),t(4,"span"),n(5,"Exportar Excel"),i()(),t(6,"table",4)(7,"thead")(8,"tr")(9,"th"),n(10,"Producto"),i(),t(11,"th"),n(12,"Stock Promedio"),i(),t(13,"th"),n(14,"Reposici\xF3n de anaquel"),i(),t(15,"th"),n(16,"Detalles"),i()()(),t(17,"tbody"),S(18,xe,14,7,"tr",null,g),i()(),x(20,"hr"),t(21,"div",19),n(22,"Qerametik"),i(),t(23,"button",20),C("click",function(){_(e);let l=s(2);return u(l.exportToExcel(l.FiltrarPorMarca("Qerametik"),l.cliente,"Qerametik"))}),x(24,"span",17),t(25,"span"),n(26,"Exportar Excel"),i()(),t(27,"table",4)(28,"thead")(29,"tr")(30,"th"),n(31,"Producto"),i(),t(32,"th"),n(33,"Stock Promedio"),i(),t(34,"th"),n(35,"Reposici\xF3n de anaquel"),i(),t(36,"th"),n(37,"Detalles"),i()()(),t(38,"tbody"),S(39,he,14,7,"tr",null,g),i()()}if(o&2){let e=s(2);c(18),b(e.FiltrarPorMarca("Mystic")),c(21),b(e.FiltrarPorMarca("Qerametik"))}}function Se(o,a){if(o&1){let e=k();t(0,"div",0)(1,"div",1),C("click",function(){_(e);let l=s();return u(l.detalles=!1)}),i(),t(2,"div",2)(3,"div",3)(4,"table",4)(5,"thead")(6,"tr")(7,"th"),n(8,"Fecha"),i(),t(9,"th"),n(10,"Reposici\xF3n"),i()()(),t(11,"tbody"),S(12,se,6,5,"tr",null,g),i()()()()(),t(14,"div",5)(15,"div",6),x(16,"app-title",7),n(17," Resumen "),i()(),t(18,"div",8)(19,"label",9),n(20,"Mes"),i(),t(21,"div",10)(22,"select",11),X("ngModelChange",function(l){_(e);let m=s();return L(m.indexPlanificacion,l)||(m.indexPlanificacion=l),u(l)}),C("change",function(){_(e);let l=s();return u(l.cambiar())}),S(23,de,2,2,"option",12,g),i()()(),x(25,"hr"),t(26,"div",13)(27,"ul")(28,"li",14),C("click",function(){_(e);let l=s();return u(l.almacen=!1)}),t(29,"a"),n(30,"Reportes"),i()(),t(31,"li",14),C("click",function(){_(e);let l=s();return u(l.almacen=!0)}),t(32,"a"),n(33,"Inventario"),i()()()(),v(34,me,16,0,"table",4)(35,ge,41,0)}if(o&2){let e=s();h("ngClass",y(6,P,e.detalles)),c(12),b(e.Historial),c(4),h("title",e.cliente),c(6),$("ngModel",e.indexPlanificacion),c(),b(e.planificacion.planificacion()),c(5),h("ngClass",y(8,P,!e.almacen)),c(3),h("ngClass",y(10,P,e.almacen)),c(3),E(e.almacen?35:34)}}function be(o,a){o&1&&n(0,`
Cargando cliente...
`)}var M=class o{constructor(a){this.route=a;this.route.paramMap.subscribe(e=>{this.cliente=e.get("id"),setTimeout(()=>{this.indexPlanificacion=this.planificacion.planificacion().length-1,this.RefreshPage()},1e3)})}planificacion=R(ee);reportes=R(te);cliente="";_reportes=[];indexPlanificacion=0;loading=!0;promedios=[];registrosRelleno=[];almacen=!1;detalles=!1;Historial=[];exportToExcel(a,e,r){let l=a.map(f=>({Producto:f.producto,"Promedio Final":f.promedioFinal.toFixed(0),Reposiciones:`${this.getReposiciones(f.producto).length} ${this.getReposiciones(f.producto).length===1?"Vez":"Veces"}`})),d={Sheets:{Datos:ne.json_to_sheet(l)},SheetNames:["Datos"]},I=ie(d,{bookType:"xlsx",type:"array"});this.saveAsExcel(I,`Stock-${e}_${r}`)}saveAsExcel(a,e){let r=new Blob([a],{type:"application/octet-stream"});(0,oe.saveAs)(r,`${e}.xlsx`)}cambiar(){this.RefreshPage()}RefreshPage(){setTimeout(()=>{if(!this.planificacion.loading()){let a=this.planificacion.planificacion()[this.indexPlanificacion];this.reportes.cargarReportes_(a.inicio,a.cierre).subscribe(e=>{this._reportes=e.filter(l=>l.cliente.cliente===this.cliente);let r={};this._reportes.forEach((l,m)=>{l.productos.forEach(d=>{if(r[d.producto.producto]||(r[d.producto.producto]={total:0,count:0,marca:""}),r[d.producto.producto].total+=d.final,r[d.producto.producto].count++,r[d.producto.producto].marca=d.producto.marca,m>0){let f=this._reportes[m-1].productos.find(w=>w.producto.producto===d.producto.producto);if(f&&d.inicio>f.final){let w=d.inicio-f.final;this.registrosRelleno.push({producto:d.producto.producto,fecha:l.fecha,relleno:w})}}})}),this.promedios=Object.keys(r).map(l=>({producto:l,marca:r[l].marca,promedioFinal:r[l].total/r[l].count})),this.loading=!1})}},500)}sumarPorductos(a){return a.productos.reduce((e,r)=>e+r.cantidad,0)}FiltrarPorMarca(a){return this.promedios.filter(e=>e.marca===a).sort((e,r)=>r.promedioFinal-e.promedioFinal)}getReposiciones(a){return this.registrosRelleno.filter(e=>e.producto===a)}verDetalles(a){this.detalles=!0,this.Historial=this.getReposiciones(a)}static \u0275fac=function(e){return new(e||o)(A(z))};static \u0275cmp=B({type:o,selectors:[["app-clientes"]],decls:2,vars:1,consts:[[1,"modal",3,"ngClass"],[1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-body"],[1,"table","is-fullwidth","is-striped"],[1,"card",2,"background","linear-gradient(180deg, rgba(0,26,114,1) 0%, rgba(53,164,182,1) 49%, rgba(107,202,186,1) 100%)","color","rgb(212, 212, 212)"],[1,"card-content"],[3,"title"],[1,"control"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","change","ngModel"],[3,"value"],[1,"tabs"],[3,"click","ngClass"],[3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-eye"],[1,"title",2,"color","rgb(212, 212, 212)","color","#FFFFFF","text-shadow","3px 5px 2px #474747"],[1,"button","is-small","is-success",3,"click"],[1,"button","is-success",3,"click"]],template:function(e,r){e&1&&v(0,Se,36,12)(1,be,1,0),e&2&&E(r.loading?1:0)},dependencies:[Z,Y,K,U,J,q,G,Q,N,j,W,O,H],encapsulation:2})};export{M as default};
