import{a as R}from"./chunk-KDI34TYX.js";import{a as Ee,b as Se}from"./chunk-3TDTWXDN.js";import{a as fe}from"./chunk-TX7DGLL3.js";import{d as me,g as pe,i as ue}from"./chunk-LAJQBY6U.js";import{c as be,d as ve,g as ge,h as ye,i as he,j as _e}from"./chunk-2ENZ3PA2.js";import"./chunk-HUYOMWR4.js";import{a as xe}from"./chunk-FMOI5WBO.js";import{a as Ce}from"./chunk-6FTYGNKF.js";import{$a as $,Aa as ee,Ia as te,Na as ie,Wa as E,X as A,Ya as ae,Yb as ce,Za as Q,_a as O,_b as de,ab as n,bb as i,cb as u,da as V,db as ne,ea as F,eb as oe,fb as H,ib as o,jb as g,ob as re,pb as le,qb as se,tb as W,vb as S,wb as k,za as l}from"./chunk-Q6JVZMQ3.js";var $e=r=>["/dashboard/cliente",r],He=r=>["/dashboard/promotora",r];function Ve(r,d){if(r&1&&(n(0,"option",18),o(1),i()),r&2){let a=d.$implicit,v=d.$index;E("value",v),l(),g(a.mes)}}function Fe(r,d){if(r&1){let a=ne();n(0,"div",3)(1,"div",14)(2,"label",15),o(3,"Mes"),i(),n(4,"div",16)(5,"select",17),se("ngModelChange",function(_){V(a);let w=H();return le(w.indexPlanificacion,_)||(w.indexPlanificacion=_),F(_)}),oe("change",function(){V(a);let _=H();return F(_.cambiarPlanificacion())}),O(6,Ve,2,2,"option",18,Q),i()()(),n(8,"div",14)(9,"label",15),o(10,"Inicio"),i(),u(11,"input",19),i(),n(12,"div",14)(13,"label",15),o(14,"Cierre"),i(),u(15,"input",19),i()()}if(r&2){let a=H();l(5),re("ngModel",a.indexPlanificacion),l(),$(a.planificacionService.planificacion()),l(5),E("value",a.simplificar(a.planificacionService.planificacion()[a.indexPlanificacion].inicio)),l(4),E("value",a.simplificar(a.planificacionService.planificacion()[a.indexPlanificacion].cierre))}}function We(r,d){r&1&&u(0,"app-loadings")}function je(r,d){if(r&1&&(n(0,"tr")(1,"td")(2,"a",20),o(3),i()(),n(4,"td"),o(5),S(6,"number"),i(),n(7,"td"),o(8),S(9,"number"),i(),n(10,"td"),o(11),S(12,"number"),i()()),r&2){let a=d.$implicit;l(2),E("routerLink",W(11,$e,a.cliente)),l(),g(a.cliente),l(2),g(k(6,5,a.cantidad_mystic)),l(3),g(k(9,7,a.cantidad_Qerametik)),l(3),g(k(12,9,a.cantidad))}}function Ne(r,d){if(r&1&&(n(0,"tr")(1,"td")(2,"a",20),o(3),i()(),n(4,"td"),o(5),S(6,"number"),i(),n(7,"td"),o(8),S(9,"number"),i(),n(10,"td"),o(11),S(12,"number"),i()()),r&2){let a=d.$implicit;l(2),E("routerLink",W(11,He,a.id)),l(),g(a.promotora),l(2),g(k(6,5,a.cantidad)),l(3),g(k(9,7,a.cantidad_impulso)),l(3),g(k(12,9,a.cantidad_evento))}}var j=class r{constructor(d){this.route=d;this.route.paramMap.subscribe(a=>{this.id=a.get("id"),setTimeout(()=>{this.indexPlanificacion=this.planificacionService.planificacion().length-1,this.BuscarReportes()},1e3)})}login=A(fe);planificacionService=A(Ee);ReportesServices=A(Se);id="";indexPlanificacion=0;reportesAgrupados=[];promotoras__=!0;marcas_chart;lineas_chart;tipos_chart;qerametik_chart;mystic_chart;marcas=[];lineas=[];tipos=[];Qerametik=[];Mystic=[];clientesArray;productoArray;cambiarPlanificacion(){this.marcas_chart.destroy(),this.lineas_chart.destroy(),this.tipos_chart.destroy(),this.qerametik_chart.destroy(),this.mystic_chart.destroy(),this.BuscarReportes()}simplificar(d){return d.split("T")[0]}BuscarReportes(){setTimeout(()=>{this.planificacionService.loading()||this.ReportesServices.cargarReportes_(this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe(d=>{let a=document.getElementById("marcas"),v=document.getElementById("lineas"),_=document.getElementById("tipos"),w=document.getElementById("qerametik"),ke=document.getElementById("mystic"),Me=d.filter(t=>t.promotora.region===this.id),N=0,q=0,z=0,G=0,J=0,K=0,U=0,X=0,Y=0,M={},P={},L={},B={};Me.forEach(t=>{t.tipo==="Impulso"?K+=1:t.tipo==="Evento"&&(X+=1),t.productos.forEach(e=>{let m=t.cliente.cliente,p=`${t.promotora.nombre} ${t.promotora.apellido}`,c=e.producto.producto;M[m]||(M[m]={cliente:m,cantidad:0,cantidad_mystic:0,cantidad_Qerametik:0}),M[m].cantidad+=e.cantidad,P[p]||(P[p]={promotora:p,id:t.promotora._id,cantidad:0,cantidad_impulso:0,cantidad_evento:0}),P[p].cantidad+=e.cantidad,t.tipo==="Impulso"?(U+=e.cantidad,P[p].cantidad_impulso+=e.cantidad):t.tipo==="Evento"&&(Y+=e.cantidad,P[p].cantidad_evento+=e.cantidad),e.producto.marca==="Mystic"?(N+=e.cantidad,M[m].cantidad_mystic+=e.cantidad,L[c]||(L[c]={producto:c,cantidad:0}),L[c].cantidad+=e.cantidad,e.producto.linea==="Rebranding"?J+=e.cantidad:z+=e.cantidad):(G+=e.cantidad,q+=e.cantidad,M[m].cantidad_Qerametik+=e.cantidad,B[c]||(B[c]={producto:c,cantidad:0}),B[c].cantidad+=e.cantidad)})}),this.clientesArray=Object.values(M).sort((t,e)=>e.cantidad-t.cantidad),this.productoArray=Object.values(P).sort((t,e)=>e.cantidad-t.cantidad);let T=Object.values(B).map(t=>{let e=Math.floor(Math.random()*360);return{label:t.producto,data:t.cantidad,backgroundColor:`hsl(${e}, 70%, 50%)`,borderColor:`hsl(${e}, 80%, 40%)`}});T.sort((t,e)=>e.data-t.data);let Pe=T.map(t=>t.label),Re=T.map(t=>t.data),Te=T.map(t=>t.backgroundColor),De=T.map(t=>t.borderColor),D=Object.values(L).map(t=>{let e=Math.floor(Math.random()*360);return{label:t.producto,data:t.cantidad,backgroundColor:`hsl(${e}, 70%, 50%)`,borderColor:`hsl(${e}, 80%, 40%)`}});D.sort((t,e)=>e.data-t.data);let Ie=D.map(t=>t.label),we=D.map(t=>t.data),Le=D.map(t=>t.backgroundColor),Be=D.map(t=>t.borderColor);this.Qerametik={labels:Pe,datasets:[{label:"Productos vendidos",data:Re,backgroundColor:Te,borderColor:De,hoverOffset:4}]};let Ae={id:"customDataLabelsQerametik",afterDatasetsDraw(t){let{ctx:e,data:m}=t;t.data.datasets.forEach((p,c)=>{t.getDatasetMeta(c).data.forEach((f,I)=>{let b=p.data[I];e.save(),e.font="12px Arial",e.fillStyle="#000",e.textAlign="center",e.fillText(b,f.x,f.y-10),e.restore()})})}};this.qerametik_chart=new R(w,{type:"bar",data:this.Qerametik,options:{plugins:{legend:{display:!0}}},plugins:[Ae]});let Qe={id:"customDataLabels",afterDatasetsDraw(t){let{ctx:e,data:m}=t;t.data.datasets.forEach((p,c)=>{t.getDatasetMeta(c).data.forEach((f,I)=>{let b=p.data[I];e.save(),e.font="12px Arial",e.fillStyle="#000",e.textAlign="center",e.fillText(b,f.x,f.y-10),e.restore()})})}};this.Mystic={labels:Ie,datasets:[{label:"Productos vendidos",data:we,backgroundColor:Le,borderColor:Be,hoverOffset:4}]},this.mystic_chart=new R(ke,{type:"bar",data:this.Mystic,options:{plugins:{legend:{display:!0}}},plugins:[Qe]}),this.marcas={labels:["Mystic","Qerametik"],datasets:[{label:"Productos vendidos",data:[N,q],backgroundColor:["#001a72","#6bcaba"],borderColor:["#fe5000","#c99700"],hoverOffset:4}]};let Oe={id:"customDoughnutLabels",afterDatasetsDraw(t){let{ctx:e,data:m}=t,p=m.datasets[0];t.getDatasetMeta(0).data.forEach((c,x)=>{let f=p.data[x],I=m.labels[x],{x:b,y:C}=c.tooltipPosition();e.save(),e.fillStyle="rgba(255, 255, 255, 0.8)";let s=6,y=e.measureText(f).width,h=14;e.fillRect(b-y/2-s/2,C-h/2-s/2,y+s,h+s),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.lineWidth=1,e.strokeRect(b-y/2-s/2,C-h/2-s/2,y+s,h+s),e.fillStyle="#000",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(f,b,C),e.restore()})}};this.marcas_chart=new R(a,{type:"doughnut",data:this.marcas,options:{plugins:{legend:{display:!0}}},plugins:[Oe]}),this.lineas={labels:["Tradicional Mystic","Tradicional Qerametik","Rebranding"],datasets:[{label:"Productos vendidos",data:[z,G,J],backgroundColor:["#001a72","#6bcaba","#fe5000"],borderColor:["#fe5000","#c99700","#001a72"],hoverOffset:4}]};let Z={id:"customDoughnutLabels",afterDatasetsDraw(t){let{ctx:e,data:m}=t,p=m.datasets[0];t.getDatasetMeta(0).data.forEach((c,x)=>{let f=p.data[x],I=m.labels[x],{x:b,y:C}=c.tooltipPosition();e.save(),e.fillStyle="rgba(255, 255, 255, 0.8)";let s=6,y=e.measureText(f).width,h=14;e.fillRect(b-y/2-s/2,C-h/2-s/2,y+s,h+s),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.lineWidth=1,e.strokeRect(b-y/2-s/2,C-h/2-s/2,y+s,h+s),e.fillStyle="#000",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(f,b,C),e.restore()})}};this.lineas_chart=new R(v,{type:"doughnut",data:this.lineas,options:{plugins:{legend:{display:!0}}},plugins:[Z]}),this.tipos={labels:[`${K} Impulsos`,`${X} Eventos`],datasets:[{label:"Productos vendidos",data:[U,Y],backgroundColor:["#001a72","#6bcaba"],borderColor:["#fe5000","#c99700"],hoverOffset:4}]},this.tipos_chart=new R(_,{type:"doughnut",data:this.tipos,options:{plugins:{legend:{display:!0}}},plugins:[Z]})})},500)}static \u0275fac=function(a){return new(a||r)(ee(me))};static \u0275cmp=te({type:r,selectors:[["app-region"]],decls:73,vars:2,consts:[[1,"card",2,"background","linear-gradient(to right, #001a72, #003c99, #005ebf, #4a9dc1, #6bcaba)","color","rgb(212, 212, 212)"],[1,"card-content"],[3,"title"],[1,"field","is-grouped"],[1,"columns"],[1,"column"],[1,"card"],[1,"title"],["id","marcas"],["id","lineas"],["id","tipos"],["id","mystic"],["id","qerametik"],[1,"table","is-fullwidth","is-striped"],[1,"control"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","change","ngModel"],[3,"value"],["type","date","disabled","",1,"input",3,"value"],[3,"routerLink"]],template:function(a,v){a&1&&(n(0,"div",0)(1,"div",1),u(2,"app-title",2),o(3," Regi\xF3n "),i()(),u(4,"hr"),ie(5,Fe,16,3,"div",3)(6,We,1,0,"app-loadings"),n(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",1)(11,"span",7),o(12,"Marca mas vendedia"),i(),u(13,"canvas",8),i()()(),n(14,"div",5)(15,"div",6)(16,"div",1)(17,"span",7),o(18,"Venta por linea"),i(),u(19,"canvas",9),i()()(),n(20,"div",5)(21,"div",6)(22,"div",1)(23,"span",7),o(24,"Eventos-Impulsos"),i(),u(25,"canvas",10),i()()()(),u(26,"hr"),n(27,"div",6)(28,"div",1),u(29,"canvas",11),i()(),n(30,"div",6)(31,"div",1),u(32,"canvas",12),i()(),u(33,"hr"),n(34,"div",4)(35,"div",5)(36,"div",6)(37,"div",1)(38,"span",7),o(39,"Clientes vendidos"),i(),n(40,"table",13)(41,"thead")(42,"tr")(43,"th"),o(44,"Cliente"),i(),n(45,"th"),o(46,"Mystic"),i(),n(47,"th"),o(48,"Qerametik"),i(),n(49,"th"),o(50,"Total"),i()()(),n(51,"tbody"),O(52,je,13,13,"tr",null,Q),i()()()()(),n(54,"div",5)(55,"div",6)(56,"div",1)(57,"span",7),o(58,"Ventas por promotora"),i(),n(59,"table",13)(60,"thead")(61,"tr")(62,"th"),o(63,"Promotora"),i(),n(64,"th"),o(65,"Ventas"),i(),n(66,"th"),o(67,"Impulso"),i(),n(68,"th"),o(69,"Evento"),i()()(),n(70,"tbody"),O(71,Ne,13,13,"tr",null,Q),i()()()()()()),a&2&&(l(2),E("title",v.id),l(3),ae(v.planificacionService.loading()?6:5),l(47),$(v.clientesArray),l(19),$(v.productoArray))},dependencies:[xe,_e,ye,he,ge,be,ve,Ce,de,ce,ue,pe],encapsulation:2})};export{j as default};
