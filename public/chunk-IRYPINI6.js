import{a as de,b as ce}from"./chunk-MQDM5MFM.js";import{a as H}from"./chunk-ZTBTE67J.js";import"./chunk-2LV7HNH4.js";import{a as re}from"./chunk-CLK3TNDD.js";import{a as le}from"./chunk-FW3GW2EH.js";import{a as J,b as K,c as X,d as Z,e as ee,h as te,i as ie,j as ne}from"./chunk-NNPNTJPV.js";import"./chunk-TZTC4YCF.js";import{a as oe}from"./chunk-O4672A62.js";import{a as ae}from"./chunk-UGQNDCKZ.js";import{$a as V,Ia as $,Na as b,Tb as G,Vb as z,Wa as M,Wb as O,X as w,Xb as q,Ya as R,Za as T,Zb as U,_a as k,a as Q,ab as t,b as L,bb as i,cb as u,da as p,db as y,ea as m,eb as C,fb as s,ib as a,jb as g,lb as I,mb as W,nb as E,ob as P,pb as v,sb as A,ub as x,wb as S,za as d}from"./chunk-BH4UYFV3.js";var se=r=>({"is-active":r});function ue(r,o){if(r&1){let e=y();t(0,"tr")(1,"td")(2,"i",12),C("click",function(){let n=p(e).$implicit,c=s();return m(c.addCliente(n))}),i()(),t(3,"td"),a(4),i()()}if(r&2){let e=o.$implicit;d(4),I("",e.cliente," (",e.marca,")")}}function _e(r,o){if(r&1){let e=y();t(0,"div",17)(1,"label",18),a(2,"Establecimiento:"),i(),t(3,"input",33),v("ngModelChange",function(n){p(e);let c=s(2);return P(c.ReporteSeleccionado.cliente.cliente,n)||(c.ReporteSeleccionado.cliente.cliente=n),m(n)}),i()()}if(r&2){let e=s(2);d(3),E("ngModel",e.ReporteSeleccionado.cliente.cliente)}}function fe(r,o){if(r&1){let e=y();t(0,"tr")(1,"td",34)(2,"button",35),C("click",function(){let n=p(e).$implicit,c=s(2);return m(c.AgregarProducto(n))}),t(3,"span",25),u(4,"i",36),i()()(),t(5,"td"),a(6),i()()}if(r&2){let e=o.$implicit;d(6),I("",e.producto," (",e.linea,")")}}function Ce(r,o){if(r&1){let e=y();t(0,"div",31)(1,"div",37)(2,"p",38),a(3),i()(),t(4,"div",8)(5,"table",6)(6,"thead")(7,"tr")(8,"th"),a(9,"Alm. Inicial"),i(),t(10,"th"),a(11,"Alm. Final"),i(),t(12,"th"),a(13,"Total"),i()()(),t(14,"tbody")(15,"tr")(16,"td")(17,"input",39),v("ngModelChange",function(n){let c=p(e).$implicit;return P(c.inicio,n)||(c.inicio=n),m(n)}),C("input",function(){let n=p(e).$implicit;return m(n.cantidad=n.inicio-n.final)}),i()(),t(18,"td")(19,"input",39),v("ngModelChange",function(n){let c=p(e).$implicit;return P(c.final,n)||(c.final=n),m(n)}),C("input",function(){let n=p(e).$implicit;return m(n.cantidad=n.inicio-n.final)}),i()(),t(20,"td"),a(21),i()()()(),t(22,"button",40),C("click",function(){let n=p(e).$index,c=s(2);return m(c.EliminarProducto(n))}),t(23,"span",25),u(24,"i",41),i(),t(25,"span"),a(26,"Eliminar"),i()()()()}if(r&2){let e=o.$implicit;d(3),g(e.producto.producto),d(14),E("ngModel",e.inicio),d(2),E("ngModel",e.final),d(2),g(e.cantidad)}}function he(r,o){if(r&1){let e=y();t(0,"div",0),u(1,"div",1),t(2,"div",2)(3,"header",13)(4,"p",14),a(5,"Editar reporte"),i(),t(6,"button",15),C("click",function(){p(e);let n=s();return m(n.EditarReporte=!n.EditarReporte)}),i()(),t(7,"div",3)(8,"div",16)(9,"div",17)(10,"label",18),a(11,"Fecha:"),i(),t(12,"input",19),v("ngModelChange",function(n){p(e);let c=s();return P(c.ReporteSeleccionado.fecha,n)||(c.ReporteSeleccionado.fecha=n),m(n)}),i()(),t(13,"div",17)(14,"label",18),a(15,"Marca:"),i(),t(16,"div",20)(17,"select",21)(18,"option",22),a(19,"Mystic"),i(),t(20,"option",23),a(21,"Qerametic"),i()()()()(),t(22,"div",16)(23,"div",17)(24,"label",18),a(25,"\xA0"),i(),t(26,"button",24),C("click",function(){p(e);let n=s();return m(n.modalCliente=!n.modalCliente)}),t(27,"span",25),u(28,"i",26),i()()(),b(29,_e,4,1,"div",17),i(),t(30,"div",27)(31,"div",17)(32,"label",18),a(33,"Buscado de productos"),i(),t(34,"input",28),v("ngModelChange",function(n){p(e);let c=s();return P(c.searchTerm,n)||(c.searchTerm=n),m(n)}),C("input",function(){p(e);let n=s();return m(n.filterProductos())}),i()(),t(35,"div",27)(36,"div",17)(37,"label",18),a(38,"\xA0"),i(),t(39,"input",29),v("ngModelChange",function(n){p(e);let c=s();return P(c.usarListaAntigua,n)||(c.usarListaAntigua=n),m(n)}),C("click",function(){p(e);let n=s();return m(n.filterProductos())}),i(),a(40," Utilizar lista antigua "),i()()(),u(41,"hr"),t(42,"table",30)(43,"thead"),k(44,fe,7,2,"tr",null,T),i()(),u(46,"hr"),k(47,Ce,27,4,"div",31,T),t(49,"button",24),C("click",function(){p(e);let n=s();return m(n.GuardarReporte())}),t(50,"span",25),u(51,"i",32),i(),t(52,"span"),a(53,"Guardar"),i()()()()()}if(r&2){let e=s();M("ngClass",A(6,se,e.EditarReporte)),d(12),E("ngModel",e.ReporteSeleccionado.fecha),d(5),M("value",e.MarcaSelected),d(12),R(e.ReporteSeleccionado.cliente._id?29:-1),d(5),E("ngModel",e.searchTerm),d(5),E("ngModel",e.usarListaAntigua),d(5),V(e.filteredProductos),d(3),V(e.ReporteSeleccionado.productos)}}function ge(r,o){if(r&1){let e=y();t(0,"button",43),C("click",function(){p(e);let n=s().$implicit,c=s(2);return m(c.EditarReporte_Mystic(n._id))}),t(1,"span",25),u(2,"i",44),i()()}}function xe(r,o){if(r&1&&(t(0,"tr")(1,"td"),a(2),x(3,"date"),i(),t(4,"td"),a(5),i(),t(6,"td"),a(7),i(),t(8,"td"),b(9,ge,3,0,"button",42),i()()),r&2){let e=o.$implicit,l=s(2);d(2),g(S(3,4,e.fecha,"dd/MM/YYYY")),d(3),g(e.puntuacionTotal),d(2),g(e.totalCantidad),d(2),R(!l.login.usuario.restringido||l.fechaFormateada===e.fecha?9:-1)}}function Se(r,o){if(r&1&&(t(0,"table",6)(1,"thead")(2,"th"),a(3,"Fecha"),i(),t(4,"th"),a(5,"Puntuacion obtenida"),i(),t(6,"th"),a(7,"Productos vendidos"),i(),t(8,"th"),a(9,"Editar"),i()(),t(10,"tbody"),k(11,xe,10,7,"tr",null,T),i()()),r&2){let e=s();d(11),V(e.ReportesFiltradosMystic)}}function be(r,o){r&1&&u(0,"app-loadings")}function ye(r,o){r&1&&(t(0,"th"),a(1,"Editar"),i())}function Ee(r,o){if(r&1){let e=y();t(0,"td")(1,"button",43),C("click",function(){p(e);let n=s().$implicit,c=s(2);return m(c.EditarReporte_Qera(n._id))}),t(2,"span",25),u(3,"i",44),i()()()}}function Pe(r,o){if(r&1&&(t(0,"tr")(1,"td"),a(2),x(3,"date"),i(),t(4,"td"),a(5),i(),t(6,"td"),a(7),i(),b(8,Ee,4,0,"td",45),i()),r&2){let e=o.$implicit,l=s(2);d(2),g(S(3,4,e.fecha,"dd/MM/YYYY")),d(3),g(e.puntuacionTotal),d(2),g(e.totalCantidad),d(),M("ngIf",!l.login.usuario.restringido)}}function ve(r,o){if(r&1&&(t(0,"table",6)(1,"thead")(2,"th"),a(3,"Fecha"),i(),t(4,"th"),a(5,"Puntuacion obtenida"),i(),t(6,"th"),a(7,"Productos vendidos"),i(),b(8,ye,2,0,"th",45),i(),t(9,"tbody"),k(10,Pe,9,7,"tr",null,T),i()()),r&2){let e=s();d(8),M("ngIf",!e.login.usuario.restringido),d(2),V(e.ReportesFiltradosQerametik)}}function we(r,o){r&1&&u(0,"app-loadings")}var N=class r{login=w(H);reportes=w(ce);planificacion=w(de);clientes=w(le);productoService=w(re);ReportesFiltradosMystic=[];ReportesFiltradosQerametik=[];loading=!1;EditarReporte=!1;ReporteSeleccionado;MarcaSelected="Mystic";searchTerm="";filteredProductos=[];usarListaAntigua=!1;modalCliente=!1;filteredClientes=[];totalCantidadMystic=0;totalPuntosMystic=0;totalCantidadQerametik=0;totalPuntosQerametik=0;Rebrandig_porcentaje=0;capilares_porcentaja=0;NoCapilares=["67a4c7cf083a2a1da67922a3","676c251affcb9efdbafe02d6","67a4c7ea083a2a1da67922a5"];hoy=new Date;dia=String(this.hoy.getDate()).padStart(2,"0");mes=String(this.hoy.getMonth()+1).padStart(2,"0");ano=this.hoy.getFullYear();fechaFormateada=`${this.ano}-${this.mes}-${this.dia}`;constructor(){this.RefreshPage()}BuscarCliente(o){o.value.trim()===""?this.filteredClientes=[]:this.filteredClientes=this.clientes.clientes().filter(e=>e.cliente.toLowerCase().includes(o.value.toLowerCase())&&e.marca===this.MarcaSelected)}addCliente(o){this.ReporteSeleccionado.cliente=o,this.modalCliente=!1}RefreshPage(){setTimeout(()=>{if(!this.planificacion.loading()){let o=this.planificacion.planificacion()[this.planificacion.planificacion().length-1];this.reportes.cargarReportes_(o.inicio,o.cierre).subscribe(e=>{this.ReportesFiltradosMystic=e.filter(_=>_.promotora._id===this.login.usuario._id&&_.productos[0]?.producto?.marca==="Mystic"),this.ReportesFiltradosQerametik=e.filter(_=>_.promotora._id===this.login.usuario._id&&_.productos[0]?.producto?.marca==="Qerametik");let l=0,n=0,c=0,Y=0,pe=0,me=0,D=0,j=0;this.ReportesFiltradosMystic.forEach(_=>{let F=_.productos.reduce((f,h)=>f+h.cantidad,0),B=_.productos.reduce((f,h)=>f+h.producto.puntos*h.cantidad,0);_.totalCantidad=F,_.puntuacionTotal=B,l+=F,n+=B,_.productos.forEach(f=>{pe+=f.cantidad,f.producto.linea==="Tradicional"?me+=f.cantidad:f.producto.linea==="Rebranding"&&(D+=f.cantidad)})}),this.ReportesFiltradosQerametik.forEach(_=>{let F=_.productos.reduce((f,h)=>f+h.cantidad,0),B=_.productos.reduce((f,h)=>f+h.producto.puntos*h.cantidad,0);_.totalCantidad=F,_.puntuacionTotal=B,c+=F,Y+=B,_.productos.forEach(f=>{this.NoCapilares.includes(f.producto._id)||(j+=f.cantidad)})}),this.totalCantidadMystic=l,this.totalPuntosMystic=n,this.totalCantidadQerametik=c,this.totalPuntosQerametik=Y,this.Rebrandig_porcentaje=D,this.capilares_porcentaja=j,this.loading=!0,console.log("Total Mystic:",{cantidad:this.totalCantidadMystic,puntos:this.totalPuntosMystic}),console.log("Total Qerametik:",{cantidad:this.totalCantidadQerametik,puntos:this.totalPuntosQerametik})})}},1e3)}EditarReporte_Mystic(o){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosMystic.find(e=>e._id===o),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca},500)}EditarReporte_Qera(o){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosQerametik.find(e=>e._id===o),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca},500)}filterProductos(){this.searchTerm.trim()===""?this.filteredProductos=[]:this.usarListaAntigua?this.filteredProductos=this.productoService.productos().filter(o=>o.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&o.marca===this.MarcaSelected&&o.linea==="Antigua"):this.filteredProductos=this.productoService.productos().filter(o=>o.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&o.marca===this.MarcaSelected&&o.linea!="Antigua")}AgregarProducto(o){this.ReporteSeleccionado.productos.find(e=>e.producto._id===o._id)||(this.ReporteSeleccionado.productos.push({producto:o,inicio:0,final:0,cantidad:0}),this.filterProductos())}EliminarProducto(o){this.ReporteSeleccionado.productos.splice(o,1)}GuardarReporte(){this.loading=!1,this.reportes.NuevoReporte(this.formatearReporte(this.ReporteSeleccionado)),this.RefreshPage(),this.EditarReporte=!1}formatearReporte(o){return L(Q({},o),{cliente:o.cliente._id,promotora:o.promotora._id,productos:o.productos.map(e=>L(Q({},e),{producto:e.producto._id}))})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=$({type:r,selectors:[["app-perfil"]],decls:56,vars:32,consts:[[1,"modal",3,"ngClass"],[1,"modal-background"],[1,"modal-card"],[1,"modal-card-body"],[1,"title"],["type","text","name","","id","",1,"input",3,"input"],[1,"table","is-fullwidth","is-striped"],[1,"card","snow-container",2,"background","linear-gradient(180deg, rgba(0,26,114,1) 0%, rgba(53,164,182,1) 49%, rgba(107,202,186,1) 100%)","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Progreso"],[1,"snowflake"],[1,"title",2,"font-size","medium"],[1,"fas","fa-plus",2,"color","rgb(100, 180, 100)","cursor","pointer",3,"click"],[1,"modal-card-head"],[1,"modal-card-title"],["aria-label","close",1,"delete",3,"click"],[1,"field","is-grouped"],[1,"control"],["for","",1,"label"],["type","date",1,"input",3,"ngModelChange","ngModel"],[1,"select"],[3,"value"],["value","Mystic"],["value","Qerametik"],[1,"button","is-success",3,"click"],[1,"icon"],[1,"fas","fa-search"],[1,"field"],["type","text","placeholder","Buscar producto",1,"input",3,"ngModelChange","input","ngModel"],["type","checkbox",3,"ngModelChange","click","ngModel"],[1,"table","is-fullwidth","is-hoverable","is-striped"],[1,"card"],[1,"fas","fa-save"],["type","text","disabled","",1,"input",3,"ngModelChange","ngModel"],[2,"width","15px"],[1,"button","is-success","is-small","is-outlined",2,"border","none",3,"click"],[1,"fas","fa-plus-square"],[1,"card-head"],[1,"card-header-title"],["type","number",1,"input",3,"ngModelChange","input","ngModel"],[1,"button","is-danger","is-small",3,"click"],[1,"far","fa-trash-alt"],[1,"button",2,"background-color","transparent","border","none","color","rgb(113, 184, 113)"],[1,"button",2,"background-color","transparent","border","none","color","rgb(113, 184, 113)",3,"click"],[1,"fas","fa-edit"],[4,"ngIf"]],template:function(e,l){e&1&&(t(0,"div",0),u(1,"div",1),t(2,"div",2)(3,"div",3)(4,"p",4),a(5,"Buscar cliente"),i(),t(6,"input",5),C("input",function(c){return l.BuscarCliente(c.target)}),i(),u(7,"hr"),t(8,"table",6)(9,"thead")(10,"tr"),u(11,"th"),t(12,"th"),a(13,"Clientes"),i()()(),t(14,"tbody"),k(15,ue,5,2,"tr",null,T),i()()()()(),b(17,he,54,8,"div",0),t(18,"div",7)(19,"div",8),u(20,"app-title",9),a(21),i(),t(22,"div",10),a(23,"\u2746"),i(),t(24,"div",10),a(25,"\u2745"),i(),t(26,"div",10),a(27,"\u2744"),i(),t(28,"div",10),a(29,"\u2746"),i(),t(30,"div",10),a(31,"\u2745"),i(),t(32,"div",10),a(33,"\u2744"),i(),t(34,"div",10),a(35,"\u2746"),i(),t(36,"div",10),a(37,"\u2745"),i(),t(38,"div",10),a(39,"\u2744"),i()(),t(40,"span",11),a(41),x(42,"number"),x(43,"number"),x(44,"number"),i(),u(45,"hr"),b(46,Se,13,0,"table",6)(47,be,1,0,"app-loadings"),t(48,"span",11),a(49),x(50,"number"),x(51,"number"),x(52,"number"),i(),u(53,"hr"),b(54,ve,12,1,"table",6)(55,we,1,0,"app-loadings")),e&2&&(M("ngClass",A(30,se,l.modalCliente)),d(15),V(l.filteredClientes),d(2),R(l.EditarReporte&&!l.modalCliente?17:-1),d(4),I(" ",l.login.usuario.nombre," ",l.login.usuario.apellido," "),d(20),W(" Progreso Mystic (",S(42,12,l.totalCantidadMystic,"2.0-0")," Productos - ",S(43,15,l.totalPuntosMystic,"1.2-2")," Puntos) - (",S(44,18,l.Rebrandig_porcentaje,"2.0-0"),` productos de Rebrandig)
`),d(5),R(l.loading?46:47),d(3),W(" Progreso Qerametik (",S(50,21,l.totalCantidadQerametik,"2.0-0")," Productos - ",S(51,24,l.totalPuntosQerametik,"2.2-2")," Puntos) - (",S(52,27,l.capilares_porcentaja,"2.0-0"),` productos de Capilares)
`),d(5),R(l.loading?54:55))},dependencies:[oe,U,G,z,q,O,ae,ne,te,ie,K,ee,J,X,Z],encapsulation:2})};export{N as default};
