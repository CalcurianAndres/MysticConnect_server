import{a as $}from"./chunk-TA66JFPR.js";import{a as v}from"./chunk-HUNMWK37.js";import{Fa as R,Gb as h,R as b,X as f,t as g}from"./chunk-5XISTBJQ.js";var y=class u{http=f(v);#o=R({loading:!0,reportes:[]});reportes=h(()=>this.#o().reportes);loading=h(()=>this.#o().loading);planificacionService=f($);ruta="https://mysticconnectserver-production.up.railway.app/api";constructor(){this.cargarReportes()}cargarReportes(){this.http.get(`${this.ruta}/reportes`).subscribe(s=>{this.#o.set({loading:!1,reportes:s})})}cargarReportes_(s,i){return this.http.get(`${this.ruta}/reportes?inicio=${s}&fin=${i}`)}getReportesAgrupados_(s,i,r){return this.http.get(`${this.ruta}/reportes?inicio=${i}&fin=${r}`).pipe(g(n=>{let m=n.reduce((a,t)=>{let c=t.promotora?._id;if(!c)return console.warn("Reporte sin promotora v\xE1lida:",t),a;if(console.log(t.promotora.fija,s),t.promotora.fija!==s)return console.warn("reportes que no coincidan con el tipoPromotora:",t),a;a[c]||(a[c]={promotora:`${t.promotora.nombre} ${t.promotora.apellido}`,puntosAcumulados:0,totalGastado:0,productosVendidos:0,conteoMetaUnidades:0,productosMystic:0,productosQerametik:0,puntosMystic:0,puntosQerametik:0,reportes:[]});let p=t.productos.reduce((o,e)=>o+e.producto.puntos*e.cantidad,0),d=t.productos.reduce((o,e)=>o+e.producto.precio*e.cantidad,0),l=t.productos.reduce((o,e)=>o+e.cantidad,0);return t.productos.forEach(o=>{o.producto.marca==="Mystic"?(a[c].productosMystic+=o.cantidad,a[c].puntosMystic+=o.producto.puntos*o.cantidad):o.producto.marca==="Qerametik"&&(a[c].productosQerametik+=o.cantidad,a[c].puntosQerametik+=o.producto.puntos*o.cantidad)}),a[c].puntosAcumulados+=p,a[c].totalGastado+=d,a[c].productosVendidos+=l,a[c].reportes.push({cliente:t.cliente.cliente,marca:t.cliente.marca,tipo:t.tipo,observacion:t.observacion,productos:t.productos.map(o=>({producto:o.producto.producto,linea:o.producto.linea,marca:o.producto.marca,cantidad:o.cantidad,subtotal:o.producto.precio*o.cantidad,puntosTotales:o.producto.puntos*o.cantidad})),fecha:t.fecha,totalPuntos:p,totalSubtotal:d}),a},{});return Object.values(m).sort((a,t)=>t.productosVendidos-a.productosVendidos)}))}getReportesAgrupados(s,i,r){return this.http.get(`${this.ruta}/reportes?inicio=${i}&fin=${r}`).pipe(g(n=>{let m=n.reduce((a,t)=>{let c=t.promotora?._id;if(!c)return console.warn("Reporte sin promotora v\xE1lida:",t),a;if(console.log(t.promotora.fija,s),t.promotora.fija!==s)return console.warn("reportes que no coincidan con el tipoPromotora:",t),a;a[c]||(a[c]={promotora:`${t.promotora.nombre} ${t.promotora.apellido}`,puntosAcumulados:0,totalGastado:0,productosVendidos:0,conteoMetaUnidades:0,productosMystic:0,productosQerametik:0,puntosMystic:0,puntosQerametik:0,reportes:[]});let p=t.productos.reduce((o,e)=>o+e.producto.puntos*e.cantidad,0),d=t.productos.reduce((o,e)=>o+e.producto.precio*e.cantidad,0),l=t.productos.reduce((o,e)=>o+e.cantidad,0);return t.productos.forEach(o=>{o.producto.marca==="Mystic"?(a[c].productosMystic+=o.cantidad,a[c].puntosMystic+=o.producto.puntos*o.cantidad):o.producto.marca==="Qerametik"&&(a[c].productosQerametik+=o.cantidad,a[c].puntosQerametik+=o.producto.puntos*o.cantidad)}),a[c].puntosAcumulados+=p,a[c].totalGastado+=d,a[c].productosVendidos+=l,a[c].reportes.push({cliente:t.cliente.cliente,marca:t.cliente.marca,tipo:t.tipo,observacion:t.observacion,productos:t.productos.map(o=>({producto:o.producto.producto,linea:o.producto.linea,marca:o.producto.marca,cantidad:o.cantidad,subtotal:o.producto.precio*o.cantidad,puntosTotales:o.producto.puntos*o.cantidad})),fecha:t.fecha,totalPuntos:p,totalSubtotal:d}),a},{});return Object.values(m).sort((a,t)=>t.productosVendidos-a.productosVendidos)}))}NuevoReporte(s){this.http.post(`${this.ruta}/reportes`,s).subscribe(i=>{this.cargarReportes()})}formatFecha(s){let i=("0"+s.getDate()).slice(-2),r=("0"+(s.getMonth()+1)).slice(-2),n=s.getFullYear();return`${i}/${r}/${n}`}static \u0275fac=function(i){return new(i||u)};static \u0275prov=b({token:u,factory:u.\u0275fac,providedIn:"root"})};export{y as a};
