import{a as ai}from"./chunk-DO5URY5W.js";import{a as _i,b as li}from"./chunk-3TDTWXDN.js";import{g as z,i as J}from"./chunk-LAJQBY6U.js";import{c as K,d as X,g as Z,h as ii,i as ti,j as ni}from"./chunk-2ENZ3PA2.js";import"./chunk-HUYOMWR4.js";import{a as ei}from"./chunk-FMOI5WBO.js";import{a as oi}from"./chunk-6FTYGNKF.js";import{$a as E,Ia as j,Na as p,Ub as H,Wa as u,Wb as G,X as $,Ya as m,Yb as Q,Za as v,Zb as W,_a as b,_b as Y,ab as l,bb as _,cb as d,da as P,db as w,ea as T,eb as y,fb as a,ib as c,jb as g,kb as F,lb as k,mb as O,ob as N,pb as L,qb as B,sb as I,tb as M,ub as D,vb as A,wb as q,xb as U,za as s}from"./chunk-Q6JVZMQ3.js";var ri=()=>["/dashboard/planificacion"],ci=()=>["/dashboard/charts"],si=i=>["/dashboard/promotora",i],di=i=>({rotado:i}),R=(i,n)=>({oculto:i,activo:n});function pi(i,n){i&1&&d(0,"app-loadings")}function mi(i,n){if(i&1&&(l(0,"option",17),c(1),_()),i&2){let t=n.$implicit,e=n.$index;u("value",e),s(),g(t.mes)}}function Ci(i,n){if(i&1){let t=w();l(0,"div",3)(1,"div",4)(2,"label",11),c(3,"Mes"),_(),l(4,"div",12)(5,"select",16),B("ngModelChange",function(o){P(t);let r=a(2);return L(r.indexPlanificacion,o)||(r.indexPlanificacion=o),T(o)}),y("change",function(){P(t);let o=a(2);return T(o.cambiarPlanificacion())}),b(6,mi,2,2,"option",17,v),_()()(),l(8,"div",4)(9,"label",11),c(10,"Inicio"),_(),d(11,"input",18),_(),l(12,"div",4)(13,"label",11),c(14,"Cierre"),_(),d(15,"input",18),_()()}if(i&2){let t=a(2);s(5),N("ngModel",t.indexPlanificacion),s(),E(t.planificacionService.planificacion()),s(5),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].inicio)),s(4),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].cierre))}}function fi(i,n){if(i&1&&p(0,Ci,16,3,"div",3),i&2){let t=a();m(t.indexPlanificacion?0:-1)}}function ui(i,n){i&1&&d(0,"app-loadings")}function xi(i,n){i&1&&d(0,"app-loadings")(1,"br")}function gi(i,n){i&1&&d(0,"span",29)}function Fi(i,n){i&1&&c(0," No hay reportes registrados ")}function hi(i,n){i&1&&d(0,"i",30)}function vi(i,n){i&1&&d(0,"i",31)}function bi(i,n){if(i&1&&p(0,hi,1,0,"i",30)(1,vi,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.mystic.impulso?0:1)}}function Ei(i,n){i&1&&d(0,"i",30)}function Si(i,n){i&1&&d(0,"i",31)}function Pi(i,n){if(i&1&&p(0,Ei,1,0,"i",30)(1,Si,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.qerametik.impulso?0:1)}}function Ti(i,n){if(i&1&&p(0,bi,2,1)(1,Pi,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function yi(i,n){i&1&&d(0,"i",30)}function $i(i,n){i&1&&d(0,"i",31)}function wi(i,n){if(i&1&&p(0,yi,1,0,"i",30)(1,$i,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.mystic.evento?0:1)}}function ki(i,n){i&1&&d(0,"i",30)}function Di(i,n){i&1&&d(0,"i",31)}function Ii(i,n){if(i&1&&p(0,ki,1,0,"i",30)(1,Di,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.tradicional.qerametik.evento?0:1)}}function Mi(i,n){if(i&1&&p(0,wi,2,1)(1,Ii,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function Ai(i,n){if(i&1&&p(0,Ti,2,1)(1,Mi,2,1),i&2){let t=a(2).$implicit;m(t.tipo==="Impulso"?0:1)}}function Ri(i,n){i&1&&d(0,"i",30)}function Vi(i,n){i&1&&d(0,"i",31)}function ji(i,n){if(i&1&&p(0,Ri,1,0,"i",30)(1,Vi,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.mystic.impulso?0:1)}}function Oi(i,n){i&1&&d(0,"i",30)}function Ni(i,n){i&1&&d(0,"i",31)}function Li(i,n){if(i&1&&p(0,Oi,1,0,"i",30)(1,Ni,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.qerametik.impulso?0:1)}}function Bi(i,n){if(i&1&&p(0,ji,2,1)(1,Li,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function qi(i,n){i&1&&d(0,"i",30)}function Ui(i,n){i&1&&d(0,"i",31)}function Hi(i,n){if(i&1&&p(0,qi,1,0,"i",30)(1,Ui,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.mystic.evento?0:1)}}function Gi(i,n){i&1&&d(0,"i",30)}function Qi(i,n){i&1&&d(0,"i",31)}function Wi(i,n){if(i&1&&p(0,Gi,1,0,"i",30)(1,Qi,1,0,"i",31),i&2){let t=a(4).$implicit,e=a(6);m(e.puntos(t.totalPuntos)>=e.planificacionService.planificacion()[e.indexPlanificacion].metas.rebranding.qerametik.evento?0:1)}}function Yi(i,n){if(i&1&&p(0,Hi,2,1)(1,Wi,2,1),i&2){let t=a(3).$implicit;m(t.productos[0].marca==="Mystic"?0:1)}}function zi(i,n){if(i&1&&p(0,Bi,2,1)(1,Yi,2,1),i&2){let t=a(2).$implicit;m(t.tipo==="Impulso"?0:1)}}function Ji(i,n){if(i&1&&(l(0,"div"),c(1),p(2,Ai,2,1)(3,zi,2,1),_(),c(4,"\xA0 ")),i&2){let t=a().$implicit,e=a(4).$implicit;s(),O(" \xA0(",t.productos[0].marca,")\xA0 ",t.totalSubtotal," productos (",t.totalPuntos," Puntos) "),s(),m(e.fija?2:3)}}function Ki(i,n){i&1&&c(0," Falta justificada ")}function Xi(i,n){if(i&1&&p(0,Ji,5,4)(1,Ki,1,0),i&2){let t=n.$implicit;m(t.productos[0]?0:1)}}function Zi(i,n){if(i&1&&b(0,Xi,2,1,null,null,v),i&2){let t=a().$implicit,e=a(2).$implicit,o=a(2);E(o.getReportesPorFecha(e.nombre,e.apellido,t))}}function it(i,n){if(i&1&&c(0),i&2){let t=a().$implicit;F(" ",t.productos[0].marca," ")}}function tt(i,n){if(i&1&&(l(0,"tr")(1,"td"),c(2),_(),l(3,"td"),c(4),_(),l(5,"td"),c(6),_(),l(7,"td"),c(8),_(),l(9,"td"),c(10),_(),l(11,"td"),c(12),_(),l(13,"td"),c(14),_()()),i&2){let t=n.$implicit;s(2),g(t.linea),s(2),g(t.marca),s(2),k("",t.producto," (",t.puntos," Ptos.)"),s(2),g(t.inicio),s(2),g(t.final),s(2),g(t.cantidad),s(2),g(t.puntosTotales)}}function nt(i,n){if(i&1&&(l(0,"div",27)(1,"b"),c(2,"Establecimiento:"),_(),c(3),d(4,"br"),l(5,"b"),c(6,"Tipo:"),_(),c(7),d(8,"br"),l(9,"b"),c(10,"Marca:"),_(),p(11,it,1,1),d(12,"br"),l(13,"b"),c(14,"Observaci\xF3n:"),_(),c(15),d(16,"hr"),l(17,"table",32)(18,"thead")(19,"tr")(20,"th"),c(21,"Linea"),_(),l(22,"th"),c(23,"Marca"),_(),l(24,"th"),c(25,"Producto"),_(),l(26,"th"),c(27,"Inicio"),_(),l(28,"th"),c(29,"Final"),_(),l(30,"th"),c(31,"Cantidad (Und)"),_(),l(32,"th"),c(33,"Puntos"),_()()(),l(34,"tbody"),b(35,tt,15,8,"tr",null,v),_()()()),i&2){let t=n.$implicit,e=a(2).$index,o=a(2).$index,r=a(2);u("ngClass",D(6,R,!r.toggleVentas[o]||!r.toggleVentas[o][e],r.toggleVentas[o]&&r.toggleVentas[o][e])),s(3),F(" ",t.cliente," "),s(4),F(" ",t.tipo," "),s(4),m(t.productos[0]?11:-1),s(4),F(" ",t.observacion," "),s(2),u("ngClass",D(9,R,!r.toggleVentas[o]||!r.toggleVentas[o][e],r.toggleVentas[o]&&r.toggleVentas[o][e])),s(18),E(t.productos)}}function et(i,n){if(i&1&&b(0,nt,37,12,"div",27,v),i&2){let t=a().$implicit,e=a(2).$implicit,o=a(2);E(o.getReportesPorFecha(e.nombre,e.apellido,t))}}function ot(i,n){if(i&1){let t=w();l(0,"div")(1,"div",19)(2,"header",20)(3,"p",21),c(4),p(5,Fi,1,0)(6,Zi,2,0),_(),l(7,"button",24),y("click",function(){let o=P(t).$index,r=a(2).$index,f=a(2);return T(f.toggleVentaSection(r,o))}),l(8,"span",7),d(9,"i",26),_()()(),p(10,et,2,0),_()(),d(11,"br")}if(i&2){let t=n.$implicit,e=a(2).$implicit,o=a(2);s(4),F(" ",t," - "),s(),m(o.getReportesPorFecha(e.nombre,e.apellido,t)===void 0?5:6),s(5),m(o.getReportesPorFecha(e.nombre,e.apellido,t)?10:-1)}}function at(i,n){if(i&1){let t=w();l(0,"div",19)(1,"header",20)(2,"p",21),p(3,gi,1,0,"span",22),c(4,"\xA0"),l(5,"span"),c(6),_(),c(7,"\xA0-\xA0 "),l(8,"a",23),c(9),_(),c(10),A(11,"number"),_(),l(12,"button",24),y("click",function(){P(t);let o=a().$index,r=a(2);return T(r.togglePromotoraSection(o))}),l(13,"span",25),d(14,"i",26),_()()(),l(15,"div",27)(16,"table",28)(17,"tr")(18,"th"),c(19,"Vendido"),_(),l(20,"th"),c(21,"Incentivo"),_()(),l(22,"tr")(23,"td"),c(24),_(),l(25,"td"),c(26),A(27,"currency"),_()()(),b(28,ot,12,3,null,null,v),_()()}if(i&2){let t=a(),e=t.$implicit,o=t.$index,r=a(2);s(3),u("ngIf",r.noHuboReporteAyer(e.nombre,e.apellido)),s(3),g(e.marca),s(2),u("routerLink",M(16,si,e._id)),s(),k("",e.nombre," ",e.apellido,""),s(),k("\xA0",r.getPuntos(e.nombre,e.apellido)||0," puntos - ",q(11,11,r.buscarDiasTrabajados(e.nombre,e.apellido))," dia(s) trabajado(s) "),s(3),u("ngClass",M(18,di,r.isRotated[o])),s(2),u("ngClass",D(20,R,!r.togglePromotora[o],r.togglePromotora[o])),s(9),F("",r.getGastado(e.nombre,e.apellido)," productos"),s(2),F("",U(27,13,r.obtenerIncentivo(e.nombre,e.apellido).totales,"USD")," "),s(2),E(r.getFechasDelRango())}}function _t(i,n){if(i&1&&p(0,xi,2,0)(1,at,30,23,"div",19),i&2){let t=a(2);m(t.Cargando?0:1)}}function lt(i,n){if(i&1&&b(0,_t,2,1,null,null,v),i&2){let t=a();E(t.promotorasFiltered)}}var V=class i{ReportesServices=$(li);promotoras=$(ai);planificacionService=$(_i);active=!1;indexPlanificacion=0;promotorasFiltered=[];promotoras__=!0;Cargando=!1;promotorasFilteredFunction(n){n.value==="fija"?(this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!0),this.promotoras__=!0):(this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!1),this.promotoras__=!1),this.cambiarPlanificacion()}reportesAgrupados=[];togglePromotora=[];toggleVentas={};isRotated=[];isRotated_={};constructor(){setTimeout(()=>{this.planificacionService.loading()||(this.indexPlanificacion=this.planificacionService.planificacion().length-1,this.promotorasFilteredFunction({value:"fija"}),this.ReportesServices.getReportesAgrupados(this.promotoras__,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:n=>{this.reportesAgrupados=n},error:n=>{console.error("Error al cargar los reportes:",n)}}))},500)}cambiarPlanificacion(){setTimeout(()=>{this.Cargando=!0,this.planificacionService.loading()||this.ReportesServices.getReportesAgrupados(this.promotoras__,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:n=>{this.reportesAgrupados=n,this.Cargando=!1},error:n=>{console.error("Error al cargar los reportes:",n)}})},500)}simplificar(n){return n.split("T")[0]}togglePromotoraSection(n){this.togglePromotora[n]=!this.togglePromotora[n],this.isRotated[n]=!this.isRotated[n]}toggleVentaSection(n,t){this.toggleVentas[n]||(this.toggleVentas[n]=[]),this.toggleVentas[n][t]=!this.toggleVentas[n][t]}getPuntos(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?e.puntosAcumulados:0}buscarDiasTrabajados(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?new Set(e.reportes.map(r=>r.fecha)).size:0}sueldodiario(n,t){return Number(n)/t}getGastado(n,t){let e=this.reportesAgrupados.find(o=>o.promotora===`${n} ${t}`);return e?e.totalGastado:0}getReportes(n,t){let e=`${n} ${t}`,o=this.reportesAgrupados.find(r=>r.promotora===e);return o?o.reportes:[]}getFechasDelRango(){let n=new Date,t=new Date(n);t.setDate(n.getDate()+1);let e=t,o=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].inicio);new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre)<n&&(e=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre));let r=[];for(;o<=e;){let f=new Date(o);f.setDate(f.getDate()+1),r.push(this.formatFecha(f)),o.setDate(o.getDate()+1)}return r}formatFecha(n){let t=("0"+n.getDate()).slice(-2),e=("0"+(n.getMonth()+1)).slice(-2),o=n.getFullYear();return`${t}/${e}/${o}`}getReportesPorFecha(n,t,e){let o=`${n} ${t}`,r=this.convertirFechaAISO(e),f=this.reportesAgrupados.find(C=>C.promotora===o);if(f){let C=f.reportes.filter(S=>S.fecha===r);return C.length>0?C:void 0}else return}convertirFechaAISO(n){let[t,e,o]=n.split("/");return`${o}-${e.padStart(2,"0")}-${t.padStart(2,"0")}`}calcularDiasHabiles(n,t){let e=new Date(n),o=new Date(t),r=0;if(e>o){let C=e;e=o,o=C}let f=new Date(e);for(;f<=o;){let C=f.getDay();C!==0&&C!==6&&r++,f.setDate(f.getDate()+1)}return r}puntos(n){return n||0}obtenerIncentivo(n,t){let e=this.reportesAgrupados.find(x=>x.promotora===`${n} ${t}`),o=0,r=0;e&&(o=e.puntosMystic,r=e.puntosQerametik);let f=0,C=0,S=0;if(o<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[0].de)C=0;else for(let x=0;x<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos.length;x++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[x];o>=h.de&&o<=h.hasta&&(C=h.incentivo)}if(r<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[0].de)S=0;else for(let x=0;x<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik.length;x++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[x];r>=h.de&&r<=h.hasta&&(S=h.incentivo)}return{totales:C+S,mystic:C,qerametik:S}}noHuboReporteAyer(n,t){let e=new Date;e.setDate(e.getDate()-1);let o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),C=`${String(e.getDate()).padStart(2,"0")}/${r}/${o}`;return!this.getReportesPorFecha(n,t,C)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=j({type:i,selectors:[["app-estadisticas"]],decls:33,vars:6,consts:[[1,"card",2,"background","linear-gradient(to right, #001a72, #003c99, #005ebf, #4a9dc1, #6bcaba)","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Estad\xEDsticas"],[1,"field","is-grouped"],[1,"control"],[1,"button","is-primary",3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-chart-pie"],[1,"header"],[1,"field"],["for","",1,"label"],[1,"select"],[3,"change"],["value","fija"],["value","por destajo"],[3,"ngModelChange","change","ngModel"],[3,"value"],["type","date","disabled","",1,"input",3,"value"],[1,"card"],[1,"card-header"],[1,"card-header-title"],["class","punto-rojo",4,"ngIf"],[3,"routerLink"],["aria-label","more options",1,"card-header-icon",3,"click"],[1,"icon",3,"ngClass"],["aria-hidden","true",1,"fas","fa-angle-down"],[1,"card-content",3,"ngClass"],[1,"table","is-fullwidth"],[1,"punto-rojo"],[1,"far","fa-thumbs-up",2,"color","rgb(129, 228, 129)"],[1,"far","fa-thumbs-down",2,"color","rgb(228, 129, 129)"],[1,"table","is-fullwidth","is-striped",3,"ngClass"]],template:function(t,e){t&1&&(l(0,"div",0)(1,"div",1),d(2,"app-title",2),_()(),d(3,"hr"),l(4,"div",3)(5,"div",4)(6,"button",5)(7,"span"),c(8,"Nueva planificaci\xF3n"),_()()(),l(9,"div",4)(10,"button",6)(11,"span",7),d(12,"i",8),_(),l(13,"span"),c(14,"Ver gr\xE1ficas"),_()()()(),d(15,"br")(16,"br"),l(17,"span",9),p(18,pi,1,0,"app-loadings")(19,fi,1,1),d(20,"br"),_(),l(21,"div",10)(22,"div",4)(23,"label",11),c(24,"Promotoras"),_(),l(25,"div",12)(26,"select",13),y("change",function(r){return e.promotorasFilteredFunction(r.target)}),l(27,"option",14),c(28,"Fijas"),_(),l(29,"option",15),c(30,"Por destajo"),_()()()()(),p(31,ui,1,0,"app-loadings")(32,lt,2,0)),t&2&&(s(6),u("routerLink",I(4,ri)),s(4),u("routerLink",I(5,ci)),s(8),m(e.planificacionService.loading()?18:19),s(13),m(e.planificacionService.loading()?31:32))},dependencies:[ei,Y,H,G,Q,W,ni,ii,ti,Z,K,X,oi,J,z],styles:['@charset "UTF-8";.oculto[_ngcontent-%COMP%]{overflow:hidden;max-height:0px;padding:0;margin:0;transition:max-height .5s ease-out,padding .3s ease-out,margin .3s ease-out}.activo[_ngcontent-%COMP%]{transition:max-height .9s ease-out,padding .3s ease-out,margin .3s ease-out}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.icon.rotado[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:rotate(180deg)}.low[_ngcontent-%COMP%]{color:#e48181;font-weight:bolder}.hight[_ngcontent-%COMP%]{color:#81e481;font-weight:bolder}.punto-rojo[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;background-color:red;border-radius:50%;animation:_ngcontent-%COMP%_parpadeo 1s infinite;margin-left:5px}@keyframes _ngcontent-%COMP%_parpadeo{0%,to{opacity:1}50%{opacity:0}}']})};export{V as default};
