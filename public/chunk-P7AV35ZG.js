import{a as z}from"./chunk-FHNKFYOF.js";import{a as U}from"./chunk-EC3ZKULI.js";import{a as X}from"./chunk-6JZR4IPJ.js";import{a as K}from"./chunk-TA66JFPR.js";import{a as Q}from"./chunk-K2Y2NB2L.js";import"./chunk-AQIQSVC7.js";import{a as H}from"./chunk-4AFXCQIJ.js";import{a as J}from"./chunk-LHB4DLZO.js";import{a as N,b as Y,c as D,d as G,e as $,h as O,i as j,j as q}from"./chunk-UYLEAET2.js";import"./chunk-HUNMWK37.js";import{$a as b,Ia as L,Na as w,Ub as B,Wa as P,Wb as W,X as S,Ya as v,Za as y,Zb as A,_a as E,a as R,ab as t,b as M,bb as n,cb as u,da as s,db as C,ea as p,eb as _,fb as m,ib as l,jb as f,lb as T,ob as h,pb as g,qb as x,tb as V,vb as k,xb as F,za as d}from"./chunk-5XISTBJQ.js";var Z=c=>({"is-active":c});function ee(c,o){if(c&1){let e=C();t(0,"tr")(1,"td")(2,"i",10),_("click",function(){let i=s(e).$implicit,a=m();return p(a.addCliente(i))}),n()(),t(3,"td"),l(4),n()()}if(c&2){let e=o.$implicit;d(4),f(e.cliente)}}function te(c,o){if(c&1){let e=C();t(0,"div",15)(1,"label",16),l(2,"Establecimiento:"),n(),t(3,"input",31),x("ngModelChange",function(i){s(e);let a=m(2);return g(a.ReporteSeleccionado.cliente.cliente,i)||(a.ReporteSeleccionado.cliente.cliente=i),p(i)}),n()()}if(c&2){let e=m(2);d(3),h("ngModel",e.ReporteSeleccionado.cliente.cliente)}}function ie(c,o){if(c&1){let e=C();t(0,"tr")(1,"td",32)(2,"button",33),_("click",function(){let i=s(e).$implicit,a=m(2);return p(a.AgregarProducto(i))}),t(3,"span",23),u(4,"i",34),n()()(),t(5,"td"),l(6),n()()}if(c&2){let e=o.$implicit;d(6),T("",e.producto," (",e.linea,")")}}function ne(c,o){if(c&1){let e=C();t(0,"div",29)(1,"div",35)(2,"p",36),l(3),n()(),t(4,"div",8)(5,"table",6)(6,"thead")(7,"tr")(8,"th"),l(9,"Alm. Inicial"),n(),t(10,"th"),l(11,"Alm. Final"),n(),t(12,"th"),l(13,"Total"),n()()(),t(14,"tbody")(15,"tr")(16,"td")(17,"input",37),x("ngModelChange",function(i){let a=s(e).$implicit;return g(a.inicio,i)||(a.inicio=i),p(i)}),_("input",function(){let i=s(e).$implicit;return p(i.cantidad=i.inicio-i.final)}),n()(),t(18,"td")(19,"input",37),x("ngModelChange",function(i){let a=s(e).$implicit;return g(a.final,i)||(a.final=i),p(i)}),_("input",function(){let i=s(e).$implicit;return p(i.cantidad=i.inicio-i.final)}),n()(),t(20,"td"),l(21),n()()()(),t(22,"button",38),_("click",function(){let i=s(e).$index,a=m(2);return p(a.EliminarProducto(i))}),t(23,"span",23),u(24,"i",39),n(),t(25,"span"),l(26,"Eliminar"),n()()()()}if(c&2){let e=o.$implicit;d(3),f(e.producto.producto),d(14),h("ngModel",e.inicio),d(2),h("ngModel",e.final),d(2),f(e.cantidad)}}function oe(c,o){if(c&1){let e=C();t(0,"div",0),u(1,"div",1),t(2,"div",2)(3,"header",11)(4,"p",12),l(5,"Editar reporte"),n(),t(6,"button",13),_("click",function(){s(e);let i=m();return p(i.EditarReporte=!i.EditarReporte)}),n()(),t(7,"div",3)(8,"div",14)(9,"div",15)(10,"label",16),l(11,"Fecha:"),n(),t(12,"input",17),x("ngModelChange",function(i){s(e);let a=m();return g(a.ReporteSeleccionado.fecha,i)||(a.ReporteSeleccionado.fecha=i),p(i)}),n()(),t(13,"div",15)(14,"label",16),l(15,"Marca:"),n(),t(16,"div",18)(17,"select",19)(18,"option",20),l(19,"Mystic"),n(),t(20,"option",21),l(21,"Qerametic"),n()()()()(),t(22,"div",14)(23,"div",15)(24,"label",16),l(25,"\xA0"),n(),t(26,"button",22),_("click",function(){s(e);let i=m();return p(i.modalCliente=!i.modalCliente)}),t(27,"span",23),u(28,"i",24),n()()(),w(29,te,4,1,"div",15),n(),t(30,"div",25)(31,"div",15)(32,"label",16),l(33,"Buscado de productos"),n(),t(34,"input",26),x("ngModelChange",function(i){s(e);let a=m();return g(a.searchTerm,i)||(a.searchTerm=i),p(i)}),_("input",function(){s(e);let i=m();return p(i.filterProductos())}),n()(),t(35,"div",25)(36,"div",15)(37,"label",16),l(38,"\xA0"),n(),t(39,"input",27),x("ngModelChange",function(i){s(e);let a=m();return g(a.usarListaAntigua,i)||(a.usarListaAntigua=i),p(i)}),_("click",function(){s(e);let i=m();return p(i.filterProductos())}),n(),l(40," Utilizar lista antigua "),n()()(),u(41,"hr"),t(42,"table",28)(43,"thead"),E(44,ie,7,2,"tr",null,y),n()(),u(46,"hr"),E(47,ne,27,4,"div",29,y),t(49,"button",22),_("click",function(){s(e);let i=m();return p(i.GuardarReporte())}),t(50,"span",23),u(51,"i",30),n(),t(52,"span"),l(53,"Guardar"),n()()()()()}if(c&2){let e=m();P("ngClass",V(6,Z,e.EditarReporte)),d(12),h("ngModel",e.ReporteSeleccionado.fecha),d(5),P("value",e.MarcaSelected),d(12),v(e.ReporteSeleccionado.cliente._id?29:-1),d(5),h("ngModel",e.searchTerm),d(5),h("ngModel",e.usarListaAntigua),d(5),b(e.filteredProductos),d(3),b(e.ReporteSeleccionado.productos)}}function re(c,o){if(c&1){let e=C();t(0,"tr")(1,"td"),l(2),k(3,"date"),n(),t(4,"td"),l(5),n(),t(6,"td"),l(7),n(),t(8,"td")(9,"button",40),_("click",function(){let i=s(e).$implicit,a=m(2);return p(a.EditarReporte_Mystic(i._id))}),t(10,"span",23),u(11,"i",41),n()()()()}if(c&2){let e=o.$implicit;d(2),f(F(3,3,e.fecha,"dd/MM/YYYY")),d(3),f(e.puntuacionTotal),d(2),f(e.totalCantidad)}}function ae(c,o){if(c&1&&(t(0,"table",6)(1,"thead")(2,"th"),l(3,"Fecha"),n(),t(4,"th"),l(5,"Puntuacion obtenida"),n(),t(6,"th"),l(7,"Productos vendidos"),n(),t(8,"th"),l(9,"Editar"),n()(),t(10,"tbody"),E(11,re,12,6,"tr",null,y),n()()),c&2){let e=m();d(11),b(e.ReportesFiltradosMystic)}}function le(c,o){c&1&&u(0,"app-loadings")}function ce(c,o){if(c&1){let e=C();t(0,"tr")(1,"td"),l(2),k(3,"date"),n(),t(4,"td"),l(5),n(),t(6,"td"),l(7),n(),t(8,"td")(9,"button",40),_("click",function(){let i=s(e).$implicit,a=m(2);return p(a.EditarReporte_Qera(i._id))}),t(10,"span",23),u(11,"i",41),n()()()()}if(c&2){let e=o.$implicit;d(2),f(F(3,3,e.fecha,"dd/MM/YYYY")),d(3),f(e.puntuacionTotal),d(2),f(e.totalCantidad)}}function de(c,o){if(c&1&&(t(0,"table",6)(1,"thead")(2,"th"),l(3,"Fecha"),n(),t(4,"th"),l(5,"Puntuacion obtenida"),n(),t(6,"th"),l(7,"Productos vendidos"),n(),t(8,"th"),l(9,"Editar"),n()(),t(10,"tbody"),E(11,ce,12,6,"tr",null,y),n()()),c&2){let e=m();d(11),b(e.ReportesFiltradosQerametik)}}function se(c,o){c&1&&u(0,"app-loadings")}var I=class c{login=S(Q);reportes=S(X);planificacion=S(K);clientes=S(J);productoService=S(H);ReportesFiltradosMystic=[];ReportesFiltradosQerametik=[];loading=!1;EditarReporte=!1;ReporteSeleccionado;MarcaSelected="Mystic";searchTerm="";filteredProductos=[];usarListaAntigua=!1;modalCliente=!1;filteredClientes=[];constructor(){this.RefreshPage()}BuscarCliente(o){console.log(o.value),o.value.trim()===""?this.filteredClientes=[]:this.filteredClientes=this.clientes.clientes().filter(e=>e.cliente.toLowerCase().includes(o.value.toLowerCase())&&e.marca===this.MarcaSelected)}addCliente(o){this.ReporteSeleccionado.cliente=o,this.modalCliente=!1}RefreshPage(){setTimeout(()=>{if(!this.planificacion.loading()){let o=this.planificacion.planificacion()[this.planificacion.planificacion().length-1];this.reportes.cargarReportes_(o.inicio,o.cierre).subscribe(e=>{this.ReportesFiltradosMystic=e.filter(r=>r.promotora._id===this.login.usuario._id&&r.productos[0].producto.marca==="Mystic"),this.ReportesFiltradosQerametik=e.filter(r=>r.promotora._id===this.login.usuario._id&&r.productos[0].producto.marca==="Qerametik"),this.ReportesFiltradosMystic.forEach(r=>{r.totalCantidad=r.productos.reduce((i,a)=>i+a.cantidad,0)}),this.ReportesFiltradosQerametik.forEach(r=>{r.totalCantidad=r.productos.reduce((i,a)=>i+a.cantidad,0)}),this.ReportesFiltradosMystic.forEach(r=>{r.puntuacionTotal=r.productos.reduce((i,a)=>i+a.producto.puntos*a.cantidad,0)}),this.ReportesFiltradosQerametik.forEach(r=>{r.puntuacionTotal=r.productos.reduce((i,a)=>i+a.producto.puntos*a.cantidad,0)}),this.loading=!0})}},1e3)}EditarReporte_Mystic(o){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosMystic.find(e=>e._id===o),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca},500)}EditarReporte_Qera(o){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosQerametik.find(e=>e._id===o),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca},500)}filterProductos(){this.searchTerm.trim()===""?this.filteredProductos=[]:this.usarListaAntigua?this.filteredProductos=this.productoService.productos().filter(o=>o.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&o.marca===this.MarcaSelected&&o.linea==="Antigua"):this.filteredProductos=this.productoService.productos().filter(o=>o.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&o.marca===this.MarcaSelected&&o.linea!="Antigua")}AgregarProducto(o){this.ReporteSeleccionado.productos.find(e=>e.producto._id===o._id)||(this.ReporteSeleccionado.productos.push({producto:o,inicio:0,final:0,cantidad:0}),this.filterProductos())}EliminarProducto(o){this.ReporteSeleccionado.productos.splice(this.ReporteSeleccionado.productos.findIndex(e=>e.producto._id===o),1)}GuardarReporte(){this.loading=!1,this.reportes.NuevoReporte(this.formatearReporte(this.ReporteSeleccionado)),this.RefreshPage(),this.loading=!0,this.EditarReporte=!1}formatearReporte(o){return M(R({},o),{cliente:o.cliente._id,promotora:o.promotora._id,productos:o.productos.map(e=>M(R({},e),{producto:e.producto._id}))})}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=L({type:c,selectors:[["app-perfil"]],decls:32,vars:8,consts:[[1,"modal",3,"ngClass"],[1,"modal-background"],[1,"modal-card"],[1,"modal-card-body"],[1,"title"],["type","text","name","","id","",1,"input",3,"input"],[1,"table","is-fullwidth","is-striped"],[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Progreso"],[1,"fas","fa-plus",2,"color","rgb(100, 180, 100)","cursor","pointer",3,"click"],[1,"modal-card-head"],[1,"modal-card-title"],["aria-label","close",1,"delete",3,"click"],[1,"field","is-grouped"],[1,"control"],["for","",1,"label"],["type","date",1,"input",3,"ngModelChange","ngModel"],[1,"select"],[3,"value"],["value","Mystic"],["value","Qerametik"],[1,"button","is-success",3,"click"],[1,"icon"],[1,"fas","fa-search"],[1,"field"],["type","text","placeholder","Buscar producto",1,"input",3,"ngModelChange","input","ngModel"],["type","checkbox",3,"ngModelChange","click","ngModel"],[1,"table","is-fullwidth","is-hoverable","is-striped"],[1,"card"],[1,"fas","fa-save"],["type","text","disabled","",1,"input",3,"ngModelChange","ngModel"],[2,"width","15px"],[1,"button","is-success","is-small","is-outlined",2,"border","none",3,"click"],[1,"fas","fa-plus-square"],[1,"card-head"],[1,"card-header-title"],["type","number",1,"input",3,"ngModelChange","input","ngModel"],[1,"button","is-danger","is-small",3,"click"],[1,"far","fa-trash-alt"],[1,"button",2,"background-color","transparent","border","none","color","rgb(113, 184, 113)",3,"click"],[1,"fas","fa-edit"]],template:function(e,r){e&1&&(t(0,"div",0),u(1,"div",1),t(2,"div",2)(3,"div",3)(4,"p",4),l(5,"Buscar cliente"),n(),t(6,"input",5),_("input",function(a){return r.BuscarCliente(a.target)}),n(),u(7,"hr"),t(8,"table",6)(9,"thead")(10,"tr"),u(11,"th"),t(12,"th"),l(13,"Clientes"),n()()(),t(14,"tbody"),E(15,ee,5,1,"tr",null,y),n()()()()(),w(17,oe,54,8,"div",0),t(18,"div",7)(19,"div",8),u(20,"app-title",9),l(21),n()(),t(22,"span",4),l(23,` Progreso Mystic
`),n(),u(24,"hr"),w(25,ae,13,0,"table",6)(26,le,1,0,"app-loadings"),t(27,"span",4),l(28,` Progreso Qerametik
`),n(),u(29,"hr"),w(30,de,13,0,"table",6)(31,se,1,0,"app-loadings")),e&2&&(P("ngClass",V(6,Z,r.modalCliente)),d(15),b(r.filteredClientes),d(2),v(r.EditarReporte&&!r.modalCliente?17:-1),d(4),T(" ",r.login.usuario.nombre," ",r.login.usuario.apellido," "),d(4),v(r.loading?25:26),d(5),v(r.loading?30:31))},dependencies:[z,A,B,W,U,q,O,j,Y,$,N,D,G],encapsulation:2})};export{I as default};
