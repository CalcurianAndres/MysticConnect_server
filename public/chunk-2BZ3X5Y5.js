import{a as ai}from"./chunk-P7RRBNRB.js";import{a as ei}from"./chunk-FHNKFYOF.js";import{a as oi}from"./chunk-EC3ZKULI.js";import{a as li}from"./chunk-YCRGK2F3.js";import{a as ri}from"./chunk-TA66JFPR.js";import{f as z,h as J}from"./chunk-AQIQSVC7.js";import{c as K,d as X,g as Z,h as ii,i as ti,j as ni}from"./chunk-UYLEAET2.js";import"./chunk-HUNMWK37.js";import{$a as S,Ia as A,Na as p,Ub as H,Vb as G,Wa as u,X as w,Xb as Q,Ya as m,Yb as W,Za as v,Zb as Y,_a as b,ab as _,bb as r,cb as d,da as T,db as I,ea as $,eb as D,fb as l,ib as c,jb as x,kb as E,mb as j,nb as O,ob as B,pb as U,qb as N,sb as k,tb as q,ub as M,vb as F,wb as L,xb as P,za as s}from"./chunk-5XISTBJQ.js";var _i=()=>["/dashboard/planificacion"],ci=()=>["/dashboard/charts"],si=i=>({rotado:i}),R=(i,e)=>({oculto:i,activo:e});function di(i,e){i&1&&d(0,"app-loadings")}function pi(i,e){if(i&1&&(_(0,"option",17),c(1),r()),i&2){let t=e.$implicit,n=e.$index;u("value",n),s(),x(t.mes)}}function mi(i,e){if(i&1){let t=I();_(0,"div",3)(1,"div",4)(2,"label",11),c(3,"Mes"),r(),_(4,"div",12)(5,"select",16),N("ngModelChange",function(o){T(t);let a=l(2);return U(a.indexPlanificacion,o)||(a.indexPlanificacion=o),$(o)}),D("change",function(){T(t);let o=l(2);return $(o.cambiarPlanificacion())}),b(6,pi,2,2,"option",17,v),r()()(),_(8,"div",4)(9,"label",11),c(10,"Inicio"),r(),d(11,"input",18),r(),_(12,"div",4)(13,"label",11),c(14,"Cierre"),r(),d(15,"input",18),r()()}if(i&2){let t=l(2);s(5),B("ngModel",t.indexPlanificacion),s(),S(t.planificacionService.planificacion()),s(5),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].inicio)),s(4),u("value",t.simplificar(t.planificacionService.planificacion()[t.indexPlanificacion].cierre))}}function Ci(i,e){if(i&1&&p(0,mi,16,3,"div",3),i&2){let t=l();m(t.indexPlanificacion?0:-1)}}function fi(i,e){i&1&&d(0,"app-loadings")}function ui(i,e){i&1&&d(0,"app-loadings")(1,"br")}function xi(i,e){i&1&&d(0,"span",28)}function gi(i,e){i&1&&c(0," No hay reportes registrados ")}function Fi(i,e){i&1&&d(0,"i",29)}function hi(i,e){i&1&&d(0,"i",30)}function vi(i,e){if(i&1&&p(0,Fi,1,0,"i",29)(1,hi,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.mystic.impulso?0:1)}}function bi(i,e){i&1&&d(0,"i",29)}function Si(i,e){i&1&&d(0,"i",30)}function Ei(i,e){if(i&1&&p(0,bi,1,0,"i",29)(1,Si,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.qerametik.impulso?0:1)}}function Pi(i,e){if(i&1&&p(0,vi,2,1)(1,Ei,2,1),i&2){let t=l(2).$implicit;m(t.marca==="Mystic"?0:1)}}function yi(i,e){i&1&&d(0,"i",29)}function Ti(i,e){i&1&&d(0,"i",30)}function $i(i,e){if(i&1&&p(0,yi,1,0,"i",29)(1,Ti,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.mystic.evento?0:1)}}function Di(i,e){i&1&&d(0,"i",29)}function wi(i,e){i&1&&d(0,"i",30)}function Ii(i,e){if(i&1&&p(0,Di,1,0,"i",29)(1,wi,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.qerametik.evento?0:1)}}function Mi(i,e){if(i&1&&p(0,$i,2,1)(1,Ii,2,1),i&2){let t=l(2).$implicit;m(t.marca==="Mystic"?0:1)}}function ki(i,e){if(i&1&&p(0,Pi,2,1)(1,Mi,2,1),i&2){let t=l().$implicit;m(t.tipo==="Impulso"?0:1)}}function Ri(i,e){i&1&&d(0,"i",29)}function Vi(i,e){i&1&&d(0,"i",30)}function Ai(i,e){if(i&1&&p(0,Ri,1,0,"i",29)(1,Vi,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.mystic.impulso?0:1)}}function ji(i,e){i&1&&d(0,"i",29)}function Oi(i,e){i&1&&d(0,"i",30)}function Bi(i,e){if(i&1&&p(0,ji,1,0,"i",29)(1,Oi,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.qerametik.impulso?0:1)}}function Ui(i,e){if(i&1&&p(0,Ai,2,1)(1,Bi,2,1),i&2){let t=l(2).$implicit;m(t.marca==="Mystic"?0:1)}}function Ni(i,e){i&1&&d(0,"i",29)}function qi(i,e){i&1&&d(0,"i",30)}function Li(i,e){if(i&1&&p(0,Ni,1,0,"i",29)(1,qi,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.mystic.evento?0:1)}}function Hi(i,e){i&1&&d(0,"i",29)}function Gi(i,e){i&1&&d(0,"i",30)}function Qi(i,e){if(i&1&&p(0,Hi,1,0,"i",29)(1,Gi,1,0,"i",30),i&2){let t=l(3).$implicit,n=l(6);m(n.puntos(t.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.qerametik.evento?0:1)}}function Wi(i,e){if(i&1&&p(0,Li,2,1)(1,Qi,2,1),i&2){let t=l(2).$implicit;m(t.marca==="Mystic"?0:1)}}function Yi(i,e){if(i&1&&p(0,Ui,2,1)(1,Wi,2,1),i&2){let t=l().$implicit;m(t.tipo==="Impulso"?0:1)}}function zi(i,e){if(i&1&&(_(0,"div"),c(1),F(2,"currency"),p(3,ki,2,1)(4,Yi,2,1),r(),c(5,"\xA0 ")),i&2){let t=e.$implicit,n=l(4).$implicit;s(),j(" \xA0(",t.marca,")\xA0 ",P(2,4,t.totalSubtotal,"USD")," (",t.totalPuntos," Puntos) "),s(2),m(n.fija?3:4)}}function Ji(i,e){if(i&1&&b(0,zi,6,7,null,null,v),i&2){let t=l().$implicit,n=l(2).$implicit,o=l(2);S(o.getReportesPorFecha(n.nombre,n.apellido,t))}}function Ki(i,e){if(i&1&&(_(0,"tr")(1,"td"),c(2),r(),_(3,"td"),c(4),r(),_(5,"td"),c(6),r(),_(7,"td"),c(8),r(),_(9,"td"),c(10),r(),_(11,"td"),c(12),F(13,"currency"),r()()),i&2){let t=e.$implicit;s(2),x(t.linea),s(2),x(t.marca),s(2),x(t.producto),s(2),x(t.cantidad),s(2),x(t.puntosTotales),s(2),x(P(13,6,t.subtotal,"USD"))}}function Xi(i,e){if(i&1&&(_(0,"div",26)(1,"b"),c(2,"Establecimiento:"),r(),c(3),d(4,"br"),_(5,"b"),c(6,"Tipo:"),r(),c(7),d(8,"br"),_(9,"b"),c(10,"Marca:"),r(),c(11),d(12,"br"),_(13,"b"),c(14,"Observaci\xF3n:"),r(),c(15),d(16,"hr"),_(17,"table",31)(18,"thead")(19,"tr")(20,"th"),c(21,"Linea"),r(),_(22,"th"),c(23,"Marca"),r(),_(24,"th"),c(25,"Producto"),r(),_(26,"th"),c(27,"Cantidad (Und)"),r(),_(28,"th"),c(29,"Puntos"),r(),_(30,"th"),c(31,"Subtotal (USD)"),r()()(),_(32,"tbody"),b(33,Ki,14,9,"tr",null,v),r()()()),i&2){let t=e.$implicit,n=l(2).$index,o=l(2).$index,a=l(2);u("ngClass",M(6,R,!a.toggleVentas[o]||!a.toggleVentas[o][n],a.toggleVentas[o]&&a.toggleVentas[o][n])),s(3),E(" ",t.cliente," "),s(4),E(" ",t.tipo," "),s(4),E(" ",t.marca," "),s(4),E(" ",t.observacion," "),s(2),u("ngClass",M(9,R,!a.toggleVentas[o]||!a.toggleVentas[o][n],a.toggleVentas[o]&&a.toggleVentas[o][n])),s(16),S(t.productos)}}function Zi(i,e){if(i&1&&b(0,Xi,35,12,"div",26,v),i&2){let t=l().$implicit,n=l(2).$implicit,o=l(2);S(o.getReportesPorFecha(n.nombre,n.apellido,t))}}function it(i,e){if(i&1){let t=I();_(0,"div")(1,"div",19)(2,"header",20)(3,"p",21),c(4),p(5,gi,1,0)(6,Ji,2,0),r(),_(7,"button",23),D("click",function(){let o=T(t).$index,a=l(2).$index,f=l(2);return $(f.toggleVentaSection(a,o))}),_(8,"span",7),d(9,"i",25),r()()(),p(10,Zi,2,0),r()(),d(11,"br")}if(i&2){let t=e.$implicit,n=l(2).$implicit,o=l(2);s(4),E(" ",t," - "),s(),m(o.getReportesPorFecha(n.nombre,n.apellido,t)===void 0?5:6),s(5),m(o.getReportesPorFecha(n.nombre,n.apellido,t)?10:-1)}}function tt(i,e){if(i&1){let t=I();_(0,"div",19)(1,"header",20)(2,"p",21),p(3,xi,1,0,"span",22),c(4),F(5,"currency"),F(6,"number"),r(),_(7,"button",23),D("click",function(){T(t);let o=l().$index,a=l(2);return $(a.togglePromotoraSection(o))}),_(8,"span",24),d(9,"i",25),r()()(),_(10,"div",26)(11,"table",27)(12,"tr")(13,"th"),c(14,"Vendido"),r(),_(15,"th"),c(16,"Sueldo"),r(),_(17,"th"),c(18,"Incentivo"),r(),_(19,"th"),c(20,"Incidencia"),r()(),_(21,"tr")(22,"td"),c(23),F(24,"currency"),r(),_(25,"td"),c(26),F(27,"currency"),r(),_(28,"td"),c(29),F(30,"currency"),r()()(),b(31,it,12,3,null,null,v),r()()}if(i&2){let t=l(),n=t.$implicit,o=t.$index,a=l(2);s(3),u("ngIf",a.noHuboReporteAyer(n.nombre,n.apellido)),s(),O("\xA0 ",n.nombre," ",n.apellido," (",a.getPuntos(n.nombre,n.apellido)||0," puntos - ",P(5,11,a.obtenerIncentivo(n.nombre,n.apellido).totales,"USD")," Incentivo) - ",L(6,14,a.buscarDiasTrabajados(n.nombre,n.apellido))," dia(s) trabajado(s) "),s(4),u("ngClass",q(25,si,a.isRotated[o])),s(2),u("ngClass",M(27,R,!a.togglePromotora[o],a.togglePromotora[o])),s(13),x(P(24,16,a.getGastado(n.nombre,n.apellido)||0,"USD")),s(3),x(P(27,19,a.sueldodiario(n.sueldo,a.buscarDiasTrabajados(n.nombre,n.apellido)),"USD")),s(3),E("",P(30,22,a.obtenerIncentivo(n.nombre,n.apellido).totales,"USD")," "),s(2),S(a.getFechasDelRango())}}function nt(i,e){if(i&1&&p(0,ui,2,0)(1,tt,33,30,"div",19),i&2){let t=l(2);m(t.planificacionService.planificacion()[t.indexPlanificacion]?1:0)}}function et(i,e){if(i&1&&b(0,nt,2,1,null,null,v),i&2){let t=l();S(t.promotorasFiltered)}}var V=class i{ReportesServices=w(li);promotoras=w(ai);planificacionService=w(ri);active=!1;indexPlanificacion=0;promotorasFiltered=[];promotorasFilteredFunction(e){e.value==="fija"?this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!0):this.promotorasFiltered=this.promotoras.users().filter(t=>t.fija===!1)}reportesAgrupados=[];togglePromotora=[];toggleVentas={};isRotated=[];isRotated_={};constructor(){setTimeout(()=>{this.planificacionService.loading()||(this.indexPlanificacion=this.planificacionService.planificacion().length-1,this.promotorasFilteredFunction({value:"fija"}),this.ReportesServices.getReportesAgrupados(!0,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:e=>{this.reportesAgrupados=e,console.log(this.reportesAgrupados)},error:e=>{console.error("Error al cargar los reportes:",e)}}))},500)}cambiarPlanificacion(){setTimeout(()=>{this.planificacionService.loading()||(this.promotorasFilteredFunction({value:"fija"}),this.ReportesServices.getReportesAgrupados(!0,this.planificacionService.planificacion()[this.indexPlanificacion].inicio,this.planificacionService.planificacion()[this.indexPlanificacion].cierre).subscribe({next:e=>{this.reportesAgrupados=e,console.log(this.reportesAgrupados)},error:e=>{console.error("Error al cargar los reportes:",e)}}))},500)}simplificar(e){return e.split("T")[0]}togglePromotoraSection(e){this.togglePromotora[e]=!this.togglePromotora[e],this.isRotated[e]=!this.isRotated[e]}toggleVentaSection(e,t){this.toggleVentas[e]||(this.toggleVentas[e]=[]),this.toggleVentas[e][t]=!this.toggleVentas[e][t]}getPuntos(e,t){let n=this.reportesAgrupados.find(o=>o.promotora===`${e} ${t}`);return n?n.puntosAcumulados:0}buscarDiasTrabajados(e,t){let n=this.reportesAgrupados.find(o=>o.promotora===`${e} ${t}`);return n?new Set(n.reportes.map(a=>a.fecha)).size:0}sueldodiario(e,t){return Number(e)/t}getGastado(e,t){let n=this.reportesAgrupados.find(o=>o.promotora===`${e} ${t}`);return n?n.totalGastado:0}getReportes(e,t){let n=`${e} ${t}`,o=this.reportesAgrupados.find(a=>a.promotora===n);return o?o.reportes:[]}getFechasDelRango(){let e=new Date,t=new Date(e);t.setDate(e.getDate()+1);let n=t,o=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].inicio);new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre)<e&&(n=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre));let a=[];for(;o<=n;){let f=new Date(o);f.setDate(f.getDate()+1),a.push(this.formatFecha(f)),o.setDate(o.getDate()+1)}return a}formatFecha(e){let t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2),o=e.getFullYear();return`${t}/${n}/${o}`}getReportesPorFecha(e,t,n){let o=`${e} ${t}`,a=this.convertirFechaAISO(n),f=this.reportesAgrupados.find(C=>C.promotora===o);if(f){let C=f.reportes.filter(y=>y.fecha===a);return C.length>0?C:void 0}else return}convertirFechaAISO(e){let[t,n,o]=e.split("/");return`${o}-${n.padStart(2,"0")}-${t.padStart(2,"0")}`}calcularDiasHabiles(e,t){let n=new Date(e),o=new Date(t),a=0;if(n>o){let C=n;n=o,o=C}let f=new Date(n);for(;f<=o;){let C=f.getDay();C!==0&&C!==6&&a++,f.setDate(f.getDate()+1)}return a}puntos(e){return e||0}obtenerIncentivo(e,t){let n=this.reportesAgrupados.find(g=>g.promotora===`${e} ${t}`),o=0,a=0;n&&(o=n.puntosMystic,a=n.puntosQerametik);let f=0,C=0,y=0;if(o<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[0].de)C=0;else for(let g=0;g<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos.length;g++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos[g];o>=h.de&&o<=h.hasta&&(C=h.incentivo)}if(a<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[0].de)y=0;else for(let g=0;g<this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik.length;g++){let h=this.planificacionService.planificacion()[this.indexPlanificacion].incentivos_qerametik[g];a>=h.de&&a<=h.hasta&&(y=h.incentivo)}return{totales:C+y,mystic:C,qerametik:y}}noHuboReporteAyer(e,t){let n=new Date;n.setDate(n.getDate()-1);let o=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0"),C=`${String(n.getDate()).padStart(2,"0")}/${a}/${o}`;return!this.getReportesPorFecha(e,t,C)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=A({type:i,selectors:[["app-estadisticas"]],decls:33,vars:6,consts:[[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Estad\xEDsticas"],[1,"field","is-grouped"],[1,"control"],[1,"button","is-primary",3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-chart-pie"],[1,"header"],[1,"field"],["for","",1,"label"],[1,"select"],[3,"change"],["value","fija"],["value","por destajo"],[3,"ngModelChange","change","ngModel"],[3,"value"],["type","date","disabled","",1,"input",3,"value"],[1,"card"],[1,"card-header"],[1,"card-header-title"],["class","punto-rojo",4,"ngIf"],["aria-label","more options",1,"card-header-icon",3,"click"],[1,"icon",3,"ngClass"],["aria-hidden","true",1,"fas","fa-angle-down"],[1,"card-content",3,"ngClass"],[1,"table","is-fullwidth"],[1,"punto-rojo"],[1,"far","fa-thumbs-up",2,"color","rgb(129, 228, 129)"],[1,"far","fa-thumbs-down",2,"color","rgb(228, 129, 129)"],[1,"table","is-fullwidth","is-striped",3,"ngClass"]],template:function(t,n){t&1&&(_(0,"div",0)(1,"div",1),d(2,"app-title",2),r()(),d(3,"hr"),_(4,"div",3)(5,"div",4)(6,"button",5)(7,"span"),c(8,"Nueva planificaci\xF3n"),r()()(),_(9,"div",4)(10,"button",6)(11,"span",7),d(12,"i",8),r(),_(13,"span"),c(14,"Ver gr\xE1ficas"),r()()()(),d(15,"br")(16,"br"),_(17,"span",9),p(18,di,1,0,"app-loadings")(19,Ci,1,1),d(20,"br"),r(),_(21,"div",10)(22,"div",4)(23,"label",11),c(24,"Promotoras"),r(),_(25,"div",12)(26,"select",13),D("change",function(a){return n.promotorasFilteredFunction(a.target)}),_(27,"option",14),c(28,"Fijas"),r(),_(29,"option",15),c(30,"Por destajo"),r()()()()(),p(31,fi,1,0,"app-loadings")(32,et,2,0)),t&2&&(s(6),u("routerLink",k(4,_i)),s(4),u("routerLink",k(5,ci)),s(8),m(n.planificacionService.loading()?18:19),s(13),m(n.planificacionService.loading()?31:32))},dependencies:[ei,Y,H,G,Q,W,ni,ii,ti,Z,K,X,oi,J,z],styles:['@charset "UTF-8";.oculto[_ngcontent-%COMP%]{overflow:hidden;max-height:0px;padding:0;margin:0;transition:max-height .5s ease-out,padding .3s ease-out,margin .3s ease-out}.activo[_ngcontent-%COMP%]{transition:max-height .9s ease-out,padding .3s ease-out,margin .3s ease-out}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.icon.rotado[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:rotate(180deg)}.low[_ngcontent-%COMP%]{color:#e48181;font-weight:bolder}.hight[_ngcontent-%COMP%]{color:#81e481;font-weight:bolder}.punto-rojo[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;background-color:red;border-radius:50%;animation:_ngcontent-%COMP%_parpadeo 1s infinite;margin-left:5px}@keyframes _ngcontent-%COMP%_parpadeo{0%,to{opacity:1}50%{opacity:0}}']})};export{V as default};
