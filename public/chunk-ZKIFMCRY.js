import{a as _t}from"./chunk-P7RRBNRB.js";import{a as at}from"./chunk-FHNKFYOF.js";import{a as lt}from"./chunk-EC3ZKULI.js";import{a as ct}from"./chunk-2JR42MEI.js";import{a as rt}from"./chunk-TA66JFPR.js";import{f as Q,h as X}from"./chunk-AQIQSVC7.js";import{b as Z,c as tt,f as it,g as nt,h as et,i as ot}from"./chunk-FYONC7PZ.js";import"./chunk-HUNMWK37.js";import{$a as T,Ia as N,Na as p,Ub as W,Vb as Y,Wa as f,X as y,Xb as z,Ya as m,Yb as J,Za as P,Zb as K,_a as $,ab as c,bb as r,cb as s,da as R,db as A,ea as D,eb as w,fb as l,ib as _,jb as g,kb as v,lb as U,nb as j,ob as L,pb as G,qb as q,sb as M,tb as V,ub as I,vb as h,wb as H,xb as E,za as d}from"./chunk-5XISTBJQ.js";var dt=()=>["/dashboard/planificacion"],st=()=>["/dashboard/charts"],pt=t=>({rotado:t}),k=(t,o)=>({oculto:t,activo:o}),mt=t=>({low:t});function Ct(t,o){t&1&&s(0,"app-loadings")}function ut(t,o){if(t&1&&(c(0,"option",13),_(1),r()),t&2){let i=o.$implicit,e=o.$index;f("value",e),d(),g(i.mes)}}function xt(t,o){if(t&1){let i=A();c(0,"div",3)(1,"div",4)(2,"label",10),_(3,"Mes"),r(),c(4,"div",11)(5,"select",12),q("ngModelChange",function(a){R(i);let n=l(2);return G(n.indexPlanificacion,a)||(n.indexPlanificacion=a),D(a)}),$(6,ut,2,2,"option",13,P),r()()(),c(8,"div",4)(9,"label",10),_(10,"Inicio"),r(),s(11,"input",14),r(),c(12,"div",4)(13,"label",10),_(14,"Cierre"),r(),s(15,"input",14),r()()}if(t&2){let i=l(2);d(5),L("ngModel",i.indexPlanificacion),d(),T(i.planificacionService.planificacion()),d(5),f("value",i.planificacionService.planificacion()[i.indexPlanificacion].inicio),d(4),f("value",i.planificacionService.planificacion()[i.indexPlanificacion].cierre)}}function ft(t,o){if(t&1&&p(0,xt,16,3,"div",3),t&2){let i=l();m(i.indexPlanificacion?0:-1)}}function gt(t,o){t&1&&s(0,"app-loadings")}function ht(t,o){t&1&&s(0,"app-loadings")(1,"br")}function bt(t,o){t&1&&s(0,"span",25)}function Ft(t,o){t&1&&_(0," No hay reportes registrados ")}function vt(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function Et(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function St(t,o){if(t&1&&p(0,vt,2,0)(1,Et,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.mystic.impulso?0:1)}}function Pt(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function $t(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function Tt(t,o){if(t&1&&p(0,Pt,2,0)(1,$t,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.qerametik.impulso?0:1)}}function yt(t,o){if(t&1&&p(0,St,2,1)(1,Tt,2,1),t&2){let i,e=l(3).$implicit,a=l(3).$implicit,n=l(2);m(((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.marca)==="Mystic"?0:1)}}function Rt(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function Dt(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function At(t,o){if(t&1&&p(0,Rt,2,0)(1,Dt,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.mystic.evento?0:1)}}function It(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function wt(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function Mt(t,o){if(t&1&&p(0,It,2,0)(1,wt,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.tradicional.qerametik.evento?0:1)}}function Vt(t,o){if(t&1&&p(0,At,2,1)(1,Mt,2,1),t&2){let i,e=l(3).$implicit,a=l(3).$implicit,n=l(2);m(((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.marca)==="Mystic"?0:1)}}function kt(t,o){if(t&1&&p(0,yt,2,1)(1,Vt,2,1),t&2){let i,e=l(2).$implicit,a=l(3).$implicit,n=l(2);m(((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.tipo)==="Impulso"?0:1)}}function Ot(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function Bt(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function Nt(t,o){if(t&1&&p(0,Ot,2,0)(1,Bt,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.mystic.impulso?0:1)}}function Ut(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function jt(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function Lt(t,o){if(t&1&&p(0,Ut,2,0)(1,jt,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.qerametik.impulso?0:1)}}function Gt(t,o){if(t&1&&p(0,Nt,2,1)(1,Lt,2,1),t&2){let i,e=l(3).$implicit,a=l(3).$implicit,n=l(2);m(((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.marca)==="Mystic"?0:1)}}function qt(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function Ht(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function Wt(t,o){if(t&1&&p(0,qt,2,0)(1,Ht,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.mystic.evento?0:1)}}function Yt(t,o){t&1&&(_(0," \xA0"),s(1,"i",26))}function zt(t,o){t&1&&(_(0," \xA0"),s(1,"i",27))}function Jt(t,o){if(t&1&&p(0,Yt,2,0)(1,zt,2,0),t&2){let i,e=l(4).$implicit,a=l(3).$implicit,n=l(2);m(n.puntos((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos)>=n.planificacionService.planificacion()[n.indexPlanificacion].metas.rebranding.qerametik.evento?0:1)}}function Kt(t,o){if(t&1&&p(0,Wt,2,1)(1,Jt,2,1),t&2){let i,e=l(3).$implicit,a=l(3).$implicit,n=l(2);m(((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.marca)==="Mystic"?0:1)}}function Qt(t,o){if(t&1&&p(0,Gt,2,1)(1,Kt,2,1),t&2){let i,e=l(2).$implicit,a=l(3).$implicit,n=l(2);m(((i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.tipo)==="Impulso"?0:1)}}function Xt(t,o){if(t&1&&(_(0),h(1,"currency"),p(2,kt,2,1)(3,Qt,2,1)),t&2){let i,e=l().$implicit,a=l(3).$implicit,n=l(2);U(" ",E(1,3,(i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalSubtotal,"USD")," (",(i=n.getReportesPorFecha(a.nombre,a.apellido,e))==null?null:i.totalPuntos," Puntos) "),d(2),m(a.fija?2:3)}}function Zt(t,o){if(t&1&&(c(0,"tr")(1,"td"),_(2),r(),c(3,"td"),_(4),r(),c(5,"td"),_(6),r(),c(7,"td"),_(8),r(),c(9,"td"),_(10),r(),c(11,"td"),_(12),h(13,"currency"),r()()),t&2){let i=o.$implicit;d(2),g(i.linea),d(2),g(i.marca),d(2),g(i.producto),d(2),g(i.cantidad),d(2),g(i.puntosTotales),d(2),g(E(13,6,i.subtotal,"USD"))}}function ti(t,o){if(t&1&&(c(0,"div",22)(1,"b"),_(2,"Establecimiento:"),r(),_(3),s(4,"br"),c(5,"b"),_(6,"Tipo:"),r(),_(7),s(8,"br"),c(9,"b"),_(10,"Observaci\xF3n:"),r(),_(11),s(12,"hr"),c(13,"table",28)(14,"thead")(15,"tr")(16,"th"),_(17,"Linea"),r(),c(18,"th"),_(19,"Marca"),r(),c(20,"th"),_(21,"Producto"),r(),c(22,"th"),_(23,"Cantidad (Und)"),r(),c(24,"th"),_(25,"Puntos"),r(),c(26,"th"),_(27,"Subtotal (USD)"),r()()(),c(28,"tbody"),$(29,Zt,14,9,"tr",null,P),r()()()),t&2){let i,e,a,n,u=l(),C=u.$implicit,S=u.$index,B=l(3),b=B.$implicit,F=B.$index,x=l(2);f("ngClass",I(5,k,!x.toggleVentas[F]||!x.toggleVentas[F][S],x.toggleVentas[F]&&x.toggleVentas[F][S])),d(3),v(" ",(i=x.getReportesPorFecha(b.nombre,b.apellido,C))==null?null:i.cliente," "),d(4),v(" ",(e=x.getReportesPorFecha(b.nombre,b.apellido,C))==null?null:e.tipo," "),d(4),v(" ",(a=x.getReportesPorFecha(b.nombre,b.apellido,C))==null?null:a.observacion," "),d(2),f("ngClass",I(8,k,!x.toggleVentas[F]||!x.toggleVentas[F][S],x.toggleVentas[F]&&x.toggleVentas[F][S])),d(16),T((n=x.getReportesPorFecha(b.nombre,b.apellido,C))==null?null:n.productos)}}function ii(t,o){if(t&1){let i=A();c(0,"div")(1,"div",15)(2,"header",16)(3,"p",17),_(4),p(5,Ft,1,0)(6,Xt,4,6),r(),c(7,"button",19),w("click",function(){let a=R(i).$index,n=l(3).$index,u=l(2);return D(u.toggleVentaSection(n,a))}),c(8,"span",7),s(9,"i",21),r()()(),p(10,ti,31,11,"div",22),r()(),s(11,"br")}if(t&2){let i=o.$implicit,e=l(3).$implicit,a=l(2);d(4),v(" ",i," - "),d(),m(a.getReportesPorFecha(e.nombre,e.apellido,i)?6:5),d(5),m(a.getReportesPorFecha(e.nombre,e.apellido,i)?10:-1)}}function ni(t,o){if(t&1&&$(0,ii,12,3,null,null,P),t&2){let i=l(4);T(i.getFechasDelRango())}}function ei(t,o){if(t&1&&(_(0),s(1,"app-loadings")),t&2){let i=l(4);v(" ",i.indexPlanificacion," ")}}function oi(t,o){if(t&1){let i=A();c(0,"div",15)(1,"header",16)(2,"p",17),p(3,bt,1,0,"span",18),_(4),h(5,"currency"),h(6,"number"),r(),c(7,"button",19),w("click",function(){R(i);let a=l().$index,n=l(2);return D(n.togglePromotoraSection(a))}),c(8,"span",20),s(9,"i",21),r()()(),c(10,"div",22)(11,"table",23)(12,"tr")(13,"th"),_(14,"Vendido"),r(),c(15,"th"),_(16,"Sueldo"),r(),c(17,"th"),_(18,"Incentivo"),r(),c(19,"th"),_(20,"Incidencia"),r()(),c(21,"tr")(22,"td"),_(23),h(24,"currency"),r(),c(25,"td"),_(26),h(27,"currency"),r(),c(28,"td"),_(29),h(30,"currency"),r(),c(31,"td",24),_(32),h(33,"number"),r()()(),p(34,ni,2,0)(35,ei,2,1),r()()}if(t&2){let i=l(),e=i.$implicit,a=i.$index,n=l(2);d(3),f("ngIf",n.noHuboReporteAyer(e.nombre,e.apellido)),d(),j("\xA0 ",e.nombre," ",e.apellido," (",n.getPuntos(e.nombre,e.apellido)||0," puntos - ",E(5,14,n.obtenerIncentivo(n.puntos(n.getPuntos(e.nombre,e.apellido)),n.planificacionService.planificacion()[n.indexPlanificacion].incentivos),"USD")," Incentivo) - ",H(6,17,n.buscarDiasTrabajados(e.nombre,e.apellido))," dia(s) trabajado(s) "),d(4),f("ngClass",V(31,pt,n.isRotated[a])),d(2),f("ngClass",I(33,k,!n.togglePromotora[a],n.togglePromotora[a])),d(13),g(E(24,19,n.getGastado(e.nombre,e.apellido)||0,"USD")),d(3),g(E(27,22,n.sueldodiario(e.sueldo,n.buscarDiasTrabajados(e.nombre,e.apellido)),"USD")),d(3),v("",E(30,25,n.obtenerIncentivo(n.puntos(n.getPuntos(e.nombre,e.apellido)),n.planificacionService.planificacion()[n.indexPlanificacion].incentivos),"USD")," "),d(2),f("ngClass",V(36,mt,((n.puntos(e.sueldo)+n.obtenerIncentivo(n.puntos(n.getPuntos(e.nombre,e.apellido)),n.planificacionService.planificacion()[n.indexPlanificacion].incentivos))*100/n.getGastado(e.nombre,e.apellido)||0)>=40)),d(),v(" ",E(33,28,(n.puntos(e.sueldo)+n.obtenerIncentivo(n.puntos(n.getPuntos(e.nombre,e.apellido)),n.planificacionService.planificacion()[n.indexPlanificacion].incentivos))*100/n.getGastado(e.nombre,e.apellido)||0,"1.0-1"),"% "),d(2),m(n.indexPlanificacion===0?34:35)}}function ai(t,o){if(t&1&&p(0,ht,2,0)(1,oi,36,38,"div",15),t&2){let i=l(2);m(i.planificacionService.planificacion()[i.indexPlanificacion]?1:0)}}function li(t,o){if(t&1&&$(0,ai,2,1,null,null,P),t&2){let i=l();T(i.promotoras.users())}}var O=class t{ReportesServices=y(ct);promotoras=y(_t);planificacionService=y(rt);active=!1;indexPlanificacion=0;reportesAgrupados=[];togglePromotora=[];toggleVentas={};isRotated=[];isRotated_={};constructor(){this.ReportesServices.getReportesAgrupados().subscribe({next:o=>{this.reportesAgrupados=o,console.log(this.reportesAgrupados)},error:o=>{console.error("Error al cargar los reportes:",o)}}),setTimeout(()=>{this.planificacionService.loading()||(this.indexPlanificacion=this.planificacionService.planificacion().length-1)},1e3)}togglePromotoraSection(o){this.togglePromotora[o]=!this.togglePromotora[o],this.isRotated[o]=!this.isRotated[o]}toggleVentaSection(o,i){this.toggleVentas[o]||(this.toggleVentas[o]=[]),this.toggleVentas[o][i]=!this.toggleVentas[o][i]}getPuntos(o,i){let e=this.reportesAgrupados.find(a=>a.promotora===`${o} ${i}`);return e?e.puntosAcumulados:0}buscarDiasTrabajados(o,i){let e=this.reportesAgrupados.find(a=>a.promotora===`${o} ${i}`);return e?e.reportes.length:0}sueldodiario(o,i){return Number(o)/i}getGastado(o,i){let e=this.reportesAgrupados.find(a=>a.promotora===`${o} ${i}`);return e?e.totalGastado:0}getReportes(o,i){let e=`${o} ${i}`,a=this.reportesAgrupados.find(n=>n.promotora===e);return a?a.reportes:[]}getFechasDelRango(){let o=new Date,i=new Date(o);i.setDate(o.getDate()+1);let e=i,a=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].inicio);new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre)<=o&&(e=new Date(this.planificacionService.planificacion()[this.indexPlanificacion].cierre));let n=[];for(;a<=e;)n.push(this.formatFecha(a)),a.setDate(a.getDate()+1);return n}formatFecha(o){let i=("0"+o.getDate()).slice(-2),e=("0"+(o.getMonth()+1)).slice(-2),a=o.getFullYear();return`${i}/${e}/${a}`}getReportesPorFecha(o,i,e){let a=`${o} ${i}`,n=this.convertirFechaAISO(e),u=this.reportesAgrupados.find(C=>C.promotora===a);if(u){let C=u.reportes.find(S=>S.fecha===n);return C||void 0}else return}convertirFechaAISO(o){let[i,e,a]=o.split("/");return`${a}-${e.padStart(2,"0")}-${i.padStart(2,"0")}`}calcularDiasHabiles(o,i){let e=new Date(o),a=new Date(i),n=0;if(e>a){let C=e;e=a,a=C}let u=new Date(e);for(;u<=a;){let C=u.getDay();C!==0&&C!==6&&n++,u.setDate(u.getDate()+1)}return n}puntos(o){return o||0}obtenerIncentivo(o,i){if(o<i[0].de)return 0;for(let e=0;e<i.length;e++){let a=i[e];if(o>=a.de&&o<=a.hasta)return a.incentivo}return 0}noHuboReporteAyer(o,i){let e=new Date;e.setDate(e.getDate()-1);let a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),C=`${String(e.getDate()).padStart(2,"0")}/${n}/${a}`;return!this.getReportesPorFecha(o,i,C)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=N({type:t,selectors:[["app-estadisticas"]],decls:23,vars:6,consts:[[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Estad\xEDsticas"],[1,"field","is-grouped"],[1,"control"],[1,"button","is-primary",3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-chart-pie"],[1,"header"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","ngModel"],[3,"value"],["type","date","disabled","",1,"input",3,"value"],[1,"card"],[1,"card-header"],[1,"card-header-title"],["class","punto-rojo",4,"ngIf"],["aria-label","more options",1,"card-header-icon",3,"click"],[1,"icon",3,"ngClass"],["aria-hidden","true",1,"fas","fa-angle-down"],[1,"card-content",3,"ngClass"],[1,"table","is-fullwidth"],[3,"ngClass"],[1,"punto-rojo"],[1,"far","fa-thumbs-up",2,"color","rgb(129, 228, 129)"],[1,"far","fa-thumbs-down",2,"color","rgb(228, 129, 129)"],[1,"table","is-fullwidth","is-striped",3,"ngClass"]],template:function(i,e){i&1&&(c(0,"div",0)(1,"div",1),s(2,"app-title",2),r()(),s(3,"hr"),c(4,"div",3)(5,"div",4)(6,"button",5)(7,"span"),_(8,"Nueva planificaci\xF3n"),r()()(),c(9,"div",4)(10,"button",6)(11,"span",7),s(12,"i",8),r(),c(13,"span"),_(14,"Ver gr\xE1ficas"),r()()()(),s(15,"br")(16,"br"),c(17,"span",9),p(18,Ct,1,0,"app-loadings")(19,ft,1,1),s(20,"br"),r(),p(21,gt,1,0,"app-loadings")(22,li,2,0)),i&2&&(d(6),f("routerLink",M(4,dt)),d(4),f("routerLink",M(5,st)),d(8),m(e.planificacionService.loading()?18:19),d(3),m(e.planificacionService.loading()?21:22))},dependencies:[at,K,W,Y,z,J,ot,nt,et,it,Z,tt,lt,X,Q],styles:['@charset "UTF-8";.oculto[_ngcontent-%COMP%]{overflow:hidden;max-height:0px;padding:0;margin:0;transition:max-height .5s ease-out,padding .3s ease-out,margin .3s ease-out}.activo[_ngcontent-%COMP%]{transition:max-height .9s ease-out,padding .3s ease-out,margin .3s ease-out}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.icon.rotado[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:rotate(180deg)}.low[_ngcontent-%COMP%]{color:#e48181;font-weight:bolder}.hight[_ngcontent-%COMP%]{color:#81e481;font-weight:bolder}.punto-rojo[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;background-color:red;border-radius:50%;animation:_ngcontent-%COMP%_parpadeo 1s infinite;margin-left:5px}@keyframes _ngcontent-%COMP%_parpadeo{0%,to{opacity:1}50%{opacity:0}}']})};export{O as default};
