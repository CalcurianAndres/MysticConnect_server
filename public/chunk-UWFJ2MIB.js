import{a as rt}from"./chunk-S3IGYESN.js";import{a as lt,b as st}from"./chunk-4YLB6BMN.js";import{a as H}from"./chunk-H4O6IPU4.js";import{d as U,g as q,i as z}from"./chunk-2LV7HNH4.js";import{a as at}from"./chunk-4DQSAP2D.js";import{a as nt}from"./chunk-5A4UYOPG.js";import{c as J,d as K,g as X,h as Z,i as tt,j as et}from"./chunk-NNPNTJPV.js";import"./chunk-TZTC4YCF.js";import{a as it}from"./chunk-ZHWJNEKA.js";import{a as ot}from"./chunk-UGQNDCKZ.js";import{$a as M,Aa as w,Ia as L,Na as P,Ub as $,Wa as b,Wb as W,X as C,Ya as g,Za as S,Zb as G,_a as R,a as E,ab as o,b as k,bb as a,cb as f,da as T,db as Y,ea as Q,eb as A,fb as y,ib as l,jb as _,lb as v,mb as N,nb as B,ob as O,pb as D,sb as j,ub as F,wb as I,za as r}from"./chunk-BH4UYFV3.js";var ct=i=>["/dashboard/cliente",i];function dt(i,e){if(i&1&&(o(0,"option",7),l(1),a()),i&2){let t=e.$implicit,c=e.$index;b("value",c),r(),_(t.mes)}}function pt(i,e){if(i&1&&(o(0,"tr")(1,"td"),l(2),F(3,"date"),a(),o(4,"td"),l(5),a(),o(6,"td"),l(7),a()()),i&2){let t=e.$implicit;r(2),_(I(3,3,t.fecha,"dd/MM/YYYY")),r(3),_(t.puntuacionTotal),r(2),_(t.totalCantidad)}}function mt(i,e){if(i&1&&(o(0,"table",9)(1,"thead")(2,"th"),l(3,"Fecha"),a(),o(4,"th"),l(5,"Puntuacion obtenida"),a(),o(6,"th"),l(7,"Productos vendidos"),a()(),o(8,"tbody"),R(9,pt,8,6,"tr",null,S),a()()),i&2){let t=y(2);r(9),M(t.ReportesFiltradosMystic)}}function ut(i,e){i&1&&f(0,"app-loadings")}function ft(i,e){if(i&1&&(o(0,"tr")(1,"td"),l(2),F(3,"date"),a(),o(4,"td"),l(5),a(),o(6,"td"),l(7),a()()),i&2){let t=e.$implicit;r(2),_(I(3,3,t.fecha,"dd/MM/YYYY")),r(3),_(t.puntuacionTotal),r(2),_(t.totalCantidad)}}function _t(i,e){if(i&1&&(o(0,"table",9)(1,"thead")(2,"th"),l(3,"Fecha"),a(),o(4,"th"),l(5,"Puntuacion obtenida"),a(),o(6,"th"),l(7,"Productos vendidos"),a()(),o(8,"tbody"),R(9,ft,8,6,"tr",null,S),a()()),i&2){let t=y(2);r(9),M(t.ReportesFiltradosQerametik)}}function ht(i,e){i&1&&f(0,"app-loadings")}function Ct(i,e){if(i&1&&(o(0,"tr")(1,"th")(2,"a",11),l(3),a()(),o(4,"td"),l(5),a()()),i&2){let t=e.$implicit;r(2),b("routerLink",j(5,ct,t.nombre)),r(),_(t.nombre),r(2),N("",t.totalProductosVendidos," Productos - (",t.totalMystic," Mystic) (",t.totalQerametik," Qerametik)")}}function yt(i,e){if(i&1&&(o(0,"table",9)(1,"tbody"),P(2,Ct,6,7,"tr",10),a()()),i&2){let t=y(2);r(2),b("ngForOf",t.Separado_por_clientes)}}function Pt(i,e){if(i&1){let t=Y();o(0,"div",0)(1,"div",1),f(2,"app-title",2),l(3),a()(),o(4,"div",3)(5,"label",4),l(6,"Mes"),a(),o(7,"div",5)(8,"select",6),D("ngModelChange",function(s){T(t);let m=y();return O(m.indexPlanificacion,s)||(m.indexPlanificacion=s),Q(s)}),A("change",function(){T(t);let s=y();return Q(s.cambiar())}),R(9,dt,2,2,"option",7,S),a()()(),f(11,"hr"),o(12,"span",8),l(13),a(),f(14,"hr"),P(15,mt,11,0,"table",9)(16,ut,1,0,"app-loadings"),o(17,"span",8),l(18),a(),f(19,"hr"),P(20,_t,11,0,"table",9)(21,ht,1,0,"app-loadings"),o(22,"span",8),l(23,` Ventas por cliente
`),a(),f(24,"hr"),P(25,yt,3,1,"table",9),f(26,"br")}if(i&2){let t=y();r(3),v(" ",t.perfil.nombre," ",t.perfil.apellido," "),r(5),B("ngModel",t.indexPlanificacion),r(),M(t.planificacion.planificacion()),r(4),v(" Progreso Mystic (",t.totalCantidadMystic," Productos - ",t.totalPuntosMystic,` Puntos)
`),r(2),g(t.loading?15:16),r(3),v(" Progreso Qerametik (",t.totalCantidadQerametik," Productos - ",t.totalPuntosQerametik,` Puntos)
`),r(2),g(t.loading?20:21),r(5),g(t.loading_clientes?25:-1)}}function gt(i,e){i&1&&l(0,`
Cargando perfil...
`)}var V=class i{constructor(e){this.route=e;this.route.paramMap.subscribe(t=>{let c=t.get("id");setTimeout(()=>{this.indexPlanificacion=this.planificacion.planificacion().length-1,this.loading_perfil=!0,this.perfil=this.promotora.users().find(s=>s._id===c),this.RefreshPage()},1e3)})}login=C(H);reportes=C(st);planificacion=C(lt);clientes=C(nt);productoService=C(at);promotora=C(rt);ReportesFiltradosMystic=[];ReportesFiltradosQerametik=[];loading=!1;EditarReporte=!1;ReporteSeleccionado;MarcaSelected="Mystic";searchTerm="";filteredProductos=[];usarListaAntigua=!1;modalCliente=!1;filteredClientes=[];totalCantidadMystic=0;totalPuntosMystic=0;totalCantidadQerametik=0;totalPuntosQerametik=0;perfil;loading_perfil=!1;loading_clientes=!1;indexPlanificacion=0;Separado_por_clientes=[];BuscarCliente(e){e.value.trim()===""?this.filteredClientes=[]:this.filteredClientes=this.clientes.clientes().filter(t=>t.cliente.toLowerCase().includes(e.value.toLowerCase())&&t.marca===this.MarcaSelected)}addCliente(e){this.ReporteSeleccionado.cliente=e,this.modalCliente=!1}RefreshPage(){setTimeout(()=>{if(!this.planificacion.loading()){let e=this.planificacion.planificacion()[this.indexPlanificacion];this.reportes.cargarReportes_(e.inicio,e.cierre).subscribe(t=>{this.ReportesFiltradosMystic=t.filter(n=>n.promotora._id===this.perfil._id&&n.productos[0]?.producto?.marca==="Mystic"),this.ReportesFiltradosQerametik=t.filter(n=>n.promotora._id===this.perfil._id&&n.productos[0]?.producto?.marca==="Qerametik");let c=0,s=0,m=0,x=0;this.ReportesFiltradosMystic.forEach(n=>{let d=n.productos.reduce((h,u)=>h+u.cantidad,0),p=n.productos.reduce((h,u)=>h+u.producto.puntos*u.cantidad,0);n.totalCantidad=d,n.puntuacionTotal=p,c+=d,s+=p}),this.ReportesFiltradosQerametik.forEach(n=>{let d=n.productos.reduce((h,u)=>h+u.cantidad,0),p=n.productos.reduce((h,u)=>h+u.producto.puntos*u.cantidad,0);n.totalCantidad=d,n.puntuacionTotal=p,m+=d,x+=p}),this.totalCantidadMystic=c,this.totalPuntosMystic=s,this.totalCantidadQerametik=m,this.totalPuntosQerametik=x,this.loading=!0,console.log("Total Mystic:",{cantidad:this.totalCantidadMystic,puntos:this.totalPuntosMystic}),console.log("Total Qerametik:",{cantidad:this.totalCantidadQerametik,puntos:this.totalPuntosQerametik}),this.Separado_por_clientes=this.agruparYCalcularTotales(t.filter(n=>n.promotora._id===this.perfil._id)),this.Separado_por_clientes=Object.entries(this.Separado_por_clientes).map(([n,d])=>{if(typeof d=="object"&&d!==null){let p=d;return{nombre:n,cantidadReportes:p.cantidadReportes||0,totalMystic:p.totalMystic||0,totalProductosVendidos:p.totalProductosVendidos||0,totalQerametik:p.totalQerametik||0}}return{nombre:n,id:0,cantidadReportes:0,totalMystic:0,totalProductosVendidos:0,totalQerametik:0}}).sort((n,d)=>d.totalProductosVendidos-n.totalProductosVendidos),this.loading_clientes=!0})}},1e3)}EditarReporte_Mystic(e){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosMystic.find(t=>t._id===e),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca},500)}EditarReporte_Qera(e){setTimeout(()=>{this.EditarReporte=!this.EditarReporte,this.ReporteSeleccionado=this.ReportesFiltradosQerametik.find(t=>t._id===e),this.MarcaSelected=this.ReporteSeleccionado.productos[0].producto.marca},500)}filterProductos(){this.searchTerm.trim()===""?this.filteredProductos=[]:this.usarListaAntigua?this.filteredProductos=this.productoService.productos().filter(e=>e.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&e.marca===this.MarcaSelected&&e.linea==="Antigua"):this.filteredProductos=this.productoService.productos().filter(e=>e.producto.toLowerCase().includes(this.searchTerm.toLowerCase())&&e.marca===this.MarcaSelected&&e.linea!="Antigua")}AgregarProducto(e){this.ReporteSeleccionado.productos.find(t=>t.producto._id===e._id)||(this.ReporteSeleccionado.productos.push({producto:e,inicio:0,final:0,cantidad:0}),this.filterProductos())}EliminarProducto(e){this.ReporteSeleccionado.productos.splice(e,1)}cambiar(){this.loading=!1,this.RefreshPage()}GuardarReporte(){this.loading=!1,this.reportes.NuevoReporte(this.formatearReporte(this.ReporteSeleccionado)),this.RefreshPage(),this.EditarReporte=!1}formatearReporte(e){return k(E({},e),{cliente:e.cliente._id,promotora:e.promotora._id,productos:e.productos.map(t=>k(E({},t),{producto:t.producto._id}))})}agruparYCalcularTotales=e=>e.reduce((t,c)=>{let s=c.cliente.cliente;t[s]||(t[s]={cantidadReportes:0,totalProductosVendidos:0,totalMystic:0,totalQerametik:0}),t[s].cantidadReportes++;let m=c.productos.reduce((x,n)=>x+n.cantidad,0);return c.cliente.marca==="Mystic"?t[s].totalMystic+=m:c.cliente.marca==="Qerametik"&&(t[s].totalQerametik+=m),t[s].totalProductosVendidos+=m,t},{});static \u0275fac=function(t){return new(t||i)(w(U))};static \u0275cmp=L({type:i,selectors:[["app-promotoras"]],decls:2,vars:1,consts:[[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Progreso"],[1,"control"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","change","ngModel"],[3,"value"],[1,"title"],[1,"table","is-fullwidth","is-striped"],[4,"ngFor","ngForOf"],[3,"routerLink"]],template:function(t,c){t&1&&P(0,Pt,27,10)(1,gt,1,0),t&2&&g(c.loading_perfil?0:1)},dependencies:[G,$,W,it,ot,et,Z,tt,X,J,K,z,q],encapsulation:2})};export{V as default};
