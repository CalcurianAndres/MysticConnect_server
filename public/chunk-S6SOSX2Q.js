import{a as Z,b as ee}from"./chunk-A2RZKHZC.js";import{d as W,g as q,i as z}from"./chunk-2LV7HNH4.js";import{c as Q,d as G,g as J,h as K,i as U,j as X}from"./chunk-NNPNTJPV.js";import"./chunk-TZTC4YCF.js";import{a as Y}from"./chunk-ZHWJNEKA.js";import{$a as S,Aa as I,Ia as A,Na as v,Tb as L,Wa as C,Wb as j,X as P,Xb as H,Ya as y,Za as h,Zb as O,_a as g,ab as t,bb as i,cb as x,da as _,db as k,ea as u,eb as f,fb as d,ib as o,jb as p,kb as M,lb as B,nb as D,ob as N,pb as $,sb as b,ub as E,wb as F,za as l}from"./chunk-BH4UYFV3.js";var V=n=>({"is-active":n}),te=n=>["/dashboard/promotora",n],ie=n=>["/dashboard/detalle",n];function ne(n,a){if(n&1&&(t(0,"tr")(1,"td"),o(2),E(3,"date"),i(),t(4,"td"),o(5),i()()),n&2){let e=a.$implicit;l(2),p(F(3,2,e.fecha,"dd/MM/yyyy")),l(3),p(e.relleno)}}function oe(n,a){if(n&1&&(t(0,"option",12),o(1),i()),n&2){let e=a.$implicit,r=a.$index;C("value",r),l(),p(e.mes)}}function ae(n,a){if(n&1&&(t(0,"tr")(1,"td"),o(2),E(3,"date"),i(),t(4,"td")(5,"a",15),o(6),i()(),t(7,"td"),o(8),i(),t(9,"td"),o(10),i(),t(11,"td")(12,"button",16)(13,"span",17),x(14,"i",18),i(),t(15,"span"),o(16,"Ver"),i()()()()),n&2){let e=a.$implicit,r=d(3);l(2),p(F(3,7,e.fecha,"dd/MM/yyyy")),l(3),C("routerLink",b(10,te,e.promotora._id)),l(),B("",e.promotora.nombre," ",e.promotora.apellido,""),l(2),p(e.productos[0].producto.marca),l(2),p(r.sumarPorductos(e)),l(2),C("routerLink",b(12,ie,e._id))}}function re(n,a){if(n&1&&(t(0,"table",4)(1,"thead")(2,"tr")(3,"th"),o(4,"Fecha"),i(),t(5,"th"),o(6,"Promotora"),i(),t(7,"th"),o(8,"Marca"),i(),t(9,"th"),o(10,"Productos vendidos"),i(),t(11,"th"),o(12,"Ver"),i()()(),t(13,"tbody"),g(14,ae,17,14,"tr",null,h),i()()),n&2){let e=d(2);l(14),S(e._reportes)}}function le(n,a){n&1&&o(0," \xA0Vez ")}function ce(n,a){n&1&&o(0," \xA0Veces ")}function de(n,a){if(n&1){let e=k();t(0,"tr")(1,"td"),o(2),i(),t(3,"td"),o(4),E(5,"number"),i(),t(6,"td"),o(7),v(8,le,1,0)(9,ce,1,0),i(),t(10,"td")(11,"button",20),f("click",function(){let c=_(e).$implicit,m=d(3);return u(m.verDetalles(c.producto))}),t(12,"span",17),x(13,"i",18),i()()()()}if(n&2){let e=a.$implicit,r=d(3);l(2),p(e.producto),l(2),p(F(5,4,e.promedioFinal,"1.0-0")),l(3),M("",r.getReposiciones(e.producto).length," "),l(),y(r.getReposiciones(e.producto).length===1?8:9)}}function se(n,a){n&1&&o(0," \xA0Vez ")}function pe(n,a){n&1&&o(0," \xA0Veces ")}function me(n,a){if(n&1){let e=k();t(0,"tr")(1,"td"),o(2),i(),t(3,"td"),o(4),E(5,"number"),i(),t(6,"td"),o(7),v(8,se,1,0)(9,pe,1,0),i(),t(10,"td")(11,"button",20),f("click",function(){let c=_(e).$implicit,m=d(3);return u(m.verDetalles(c.producto))}),t(12,"span",17),x(13,"i",18),i()()()()}if(n&2){let e=a.$implicit,r=d(3);l(2),p(e.producto),l(2),p(F(5,4,e.promedioFinal,"1.0-0")),l(3),M("",r.getReposiciones(e.producto).length," "),l(),y(r.getReposiciones(e.producto).length===1?8:9)}}function _e(n,a){if(n&1&&(t(0,"div",19),o(1,"Mystic"),i(),t(2,"table",4)(3,"thead")(4,"tr")(5,"th"),o(6,"Producto"),i(),t(7,"th"),o(8,"Stock Promedio"),i(),t(9,"th"),o(10,"Reposici\xF3n de anaquel"),i(),t(11,"th"),o(12,"Detalles"),i()()(),t(13,"tbody"),g(14,de,14,7,"tr",null,h),i()(),x(16,"hr"),t(17,"div",19),o(18,"Qerametik"),i(),t(19,"table",4)(20,"thead")(21,"tr")(22,"th"),o(23,"Producto"),i(),t(24,"th"),o(25,"Stock Promedio"),i(),t(26,"th"),o(27,"Reposici\xF3n de anaquel"),i(),t(28,"th"),o(29,"Detalles"),i()()(),t(30,"tbody"),g(31,me,14,7,"tr",null,h),i()()),n&2){let e=d(2);l(14),S(e.FiltrarPorMarca("Mystic")),l(17),S(e.FiltrarPorMarca("Qerametik"))}}function ue(n,a){if(n&1){let e=k();t(0,"div",0)(1,"div",1),f("click",function(){_(e);let c=d();return u(c.detalles=!1)}),i(),t(2,"div",2)(3,"div",3)(4,"table",4)(5,"thead")(6,"tr")(7,"th"),o(8,"Fecha"),i(),t(9,"th"),o(10,"Reposici\xF3n"),i()()(),t(11,"tbody"),g(12,ne,6,5,"tr",null,h),i()()()()(),t(14,"div",5)(15,"div",6),x(16,"app-title",7),o(17," Resumen "),i()(),t(18,"div",8)(19,"label",9),o(20,"Mes"),i(),t(21,"div",10)(22,"select",11),$("ngModelChange",function(c){_(e);let m=d();return N(m.indexPlanificacion,c)||(m.indexPlanificacion=c),u(c)}),f("change",function(){_(e);let c=d();return u(c.cambiar())}),g(23,oe,2,2,"option",12,h),i()()(),x(25,"hr"),t(26,"div",13)(27,"ul")(28,"li",14),f("click",function(){_(e);let c=d();return u(c.almacen=!1)}),t(29,"a"),o(30,"Reportes"),i()(),t(31,"li",14),f("click",function(){_(e);let c=d();return u(c.almacen=!0)}),t(32,"a"),o(33,"Inventario"),i()()()(),v(34,re,16,0,"table",4)(35,_e,33,0)}if(n&2){let e=d();C("ngClass",b(6,V,e.detalles)),l(12),S(e.Historial),l(4),C("title",e.cliente),l(6),D("ngModel",e.indexPlanificacion),l(),S(e.planificacion.planificacion()),l(5),C("ngClass",b(8,V,!e.almacen)),l(3),C("ngClass",b(10,V,e.almacen)),l(3),y(e.almacen?35:34)}}function Ce(n,a){n&1&&o(0,`
Cargando cliente...
`)}var w=class n{constructor(a){this.route=a;this.route.paramMap.subscribe(e=>{this.cliente=e.get("id"),setTimeout(()=>{this.indexPlanificacion=this.planificacion.planificacion().length-1,this.RefreshPage()},1e3)})}planificacion=P(Z);reportes=P(ee);cliente="";_reportes=[];indexPlanificacion=0;loading=!0;promedios=[];registrosRelleno=[];almacen=!1;detalles=!1;Historial=[];cambiar(){this.RefreshPage()}RefreshPage(){setTimeout(()=>{if(!this.planificacion.loading()){let a=this.planificacion.planificacion()[this.indexPlanificacion];this.reportes.cargarReportes_(a.inicio,a.cierre).subscribe(e=>{this._reportes=e.filter(c=>c.cliente.cliente===this.cliente);let r={};this._reportes.forEach((c,m)=>{c.productos.forEach(s=>{if(r[s.producto.producto]||(r[s.producto.producto]={total:0,count:0,marca:""}),r[s.producto.producto].total+=s.final,r[s.producto.producto].count++,r[s.producto.producto].marca=s.producto.marca,m>0){let T=this._reportes[m-1].productos.find(R=>R.producto.producto===s.producto.producto);if(T&&s.inicio>T.final){let R=s.inicio-T.final;this.registrosRelleno.push({producto:s.producto.producto,fecha:c.fecha,relleno:R})}}})}),this.promedios=Object.keys(r).map(c=>({producto:c,marca:r[c].marca,promedioFinal:r[c].total/r[c].count})),this.loading=!1})}},500)}sumarPorductos(a){return a.productos.reduce((e,r)=>e+r.cantidad,0)}FiltrarPorMarca(a){return this.promedios.filter(e=>e.marca===a).sort((e,r)=>r.promedioFinal-e.promedioFinal)}getReposiciones(a){return this.registrosRelleno.filter(e=>e.producto===a)}verDetalles(a){this.detalles=!0,this.Historial=this.getReposiciones(a)}static \u0275fac=function(e){return new(e||n)(I(W))};static \u0275cmp=A({type:n,selectors:[["app-clientes"]],decls:2,vars:1,consts:[[1,"modal",3,"ngClass"],[1,"modal-background",3,"click"],[1,"modal-card"],[1,"modal-card-body"],[1,"table","is-fullwidth","is-striped"],[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],[3,"title"],[1,"control"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","change","ngModel"],[3,"value"],[1,"tabs"],[3,"click","ngClass"],[3,"routerLink"],[1,"button","is-success",3,"routerLink"],[1,"icon"],[1,"fas","fa-eye"],[1,"title"],[1,"button","is-success",3,"click"]],template:function(e,r){e&1&&v(0,ue,36,12)(1,Ce,1,0),e&2&&y(r.loading?1:0)},dependencies:[Y,X,K,U,J,Q,G,O,L,H,j,z,q],encapsulation:2})};export{w as default};
