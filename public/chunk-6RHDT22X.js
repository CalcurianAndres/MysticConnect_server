import{a as y}from"./chunk-HUYOMWR4.js";import{Fa as v,Gb as u,R as b,X as g,a as $,b as I,f as S,t as Q}from"./chunk-Q6JVZMQ3.js";var M=class p{http=g(y);#t=v({loading:!0,planificacion:[]});planificacion=u(()=>this.#t().planificacion);loading=u(()=>this.#t().loading);ruta="https://mysticconnectserver-production.up.railway.app/api";constructor(){this.cargarPlanificacion()}cargarPlanificacion(){this.http.get(`${this.ruta}/planificacion`).subscribe(n=>{this.#t.set({loading:!1,planificacion:n}),console.log(n)})}NuevaPlanificacion=n=>S(this,null,function*(){this.#t.set(I($({},this.#t()),{loading:!0})),this.http.post(`${this.ruta}/planificacion`,n).subscribe(e=>{console.log(n),this.#t.set(I($({},this.#t()),{loading:!1,planificacion:[...this.#t().planificacion,e]}))})});static \u0275fac=function(e){return new(e||p)};static \u0275prov=b({token:p,factory:p.\u0275fac,providedIn:"root"})};var j=class p{http=g(y);#t=v({loading:!0,reportes:[]});reportes=u(()=>this.#t().reportes);loading=u(()=>this.#t().loading);planificacionService=g(M);ruta="https://mysticconnectserver-production.up.railway.app/api";constructor(){}cargarReportes(){this.http.get(`${this.ruta}/reportes`).subscribe(n=>{this.#t.set({loading:!1,reportes:n})})}cargarReportes_(n,e){return this.http.get(`${this.ruta}/reportes?inicio=${n}&fin=${e}`)}BuscarPorID(n){return this.http.get(`${this.ruta}/reportes/${n}`)}getReportesAgrupados_(n,e,l){return this.http.get(`${this.ruta}/reportes?inicio=${e}&fin=${l}`).pipe(Q(m=>{let R=m.reduce((o,t)=>{let i=t.promotora?._id,f=t.cliente?.cliente;if(!i||t.promotora.fija!==n)return o;o[i]||(o[i]={promotora:`${t.promotora.nombre} ${t.promotora.apellido}`,marca:t.promotora.marca,sueldo:t.promotora.sueldo,region:t.promotora.region,porcentajeRebranding:0,puntosAcumulados:0,totalGastado:0,productosVendidos:0,conteoMetaUnidades:0,conteoMetaUnidadesQ:0,productosMystic:0,productosQerametik:0,puntosMystic:0,puntosQerametik:0,totalImpulsos:0,totalEventos:0,totalImpulsos_qerametik:0,totalEventos_qerametik:0,dias_impulto_mystic:0,dias_evento_mystic:0,dias_impulso_qerametik:0,dias_evento_qerametik:0,gastosPorMarca:{Mystic:0,Qerametik:0},clientes_atendidos:0,reportes:[],clientesRegistrados:new Set}),o[i].clientesRegistrados.has(f)||(o[i].clientes_atendidos+=1,o[i].clientesRegistrados.add(f)),t.productos.forEach(a=>{let r=a.producto.marca;o[i].gastosPorMarca[r]||(o[i].gastosPorMarca[r]=0),o[i].gastosPorMarca[r]+=a.producto.precio*a.cantidad});let s=t.productos.reduce((a,r)=>a+r.producto.puntos*r.cantidad,0),h=t.productos.reduce((a,r)=>a+r.producto.precio*r.cantidad,0),k=t.productos.reduce((a,r)=>a+r.cantidad,0),_=t.productos.reduce((a,r)=>a+(r.cantidad>=10?1:0),0),c=0,d=0;return t.productos.forEach(a=>{a.producto.marca==="Mystic"?(o[i].productosMystic+=a.cantidad,o[i].puntosMystic+=a.producto.puntos*a.cantidad,t.tipo==="Impulso"?o[i].totalImpulsos+=a.cantidad:t.tipo==="Evento"&&(o[i].totalEventos+=a.cantidad),a.producto.linea==="Rebranding"&&(o[i].porcentajeRebranding+=a.cantidad)):a.producto.marca==="Qerametik"&&(o[i].productosQerametik+=a.cantidad,o[i].puntosQerametik+=a.producto.puntos*a.cantidad,t.tipo==="Impulso"?o[i].totalImpulsos_qerametik+=a.cantidad:t.tipo==="Evento"&&(o[i].totalEventos_qerametik+=a.cantidad))}),t.productos[0]&&(t.promotora.fija===!0?t.tipo==="Impulso"?t.productos[0].producto.marca==="Mystic"?s>=this.planificacionService.planificacion()[1].metas.tradicional.mystic.impulso&&(o[i].conteoMetaUnidades+=1):s>=this.planificacionService.planificacion()[1].metas.tradicional.qerametik.impulso&&(o[i].conteoMetaUnidadesQ+=1):t.productos[0].producto.marca==="Mystic"?s>=this.planificacionService.planificacion()[1].metas.tradicional.mystic.evento&&(o[i].conteoMetaUnidades+=1):s>=this.planificacionService.planificacion()[1].metas.tradicional.qerametik.evento&&(o[i].conteoMetaUnidadesQ+=1):t.tipo==="Impulso"?t.productos[0].producto.marca==="Mystic"?s>=this.planificacionService.planificacion()[1].metas.rebranding.mystic.impulso&&(o[i].conteoMetaUnidades+=1):s>=this.planificacionService.planificacion()[1].metas.rebranding.qerametik.impulso&&(o[i].conteoMetaUnidadesQ+=1):t.productos[0].producto.marca==="Mystic"?s>=this.planificacionService.planificacion()[1].metas.rebranding.mystic.evento&&(o[i].conteoMetaUnidades+=1):s>=this.planificacionService.planificacion()[1].metas.rebranding.qerametik.evento&&(o[i].conteoMetaUnidadesQ+=1)),o[i].puntosAcumulados+=s,o[i].totalGastado+=h,o[i].productosVendidos+=k,o[i].reportes.push({cliente:t.cliente.cliente,marca:t.cliente.marca,tipo:t.tipo,observacion:t.observacion,productos:t.productos.map(a=>({producto:a.producto.producto,puntos:a.producto.puntos,linea:a.producto.linea,marca:a.producto.marca,cantidad:a.cantidad,inicio:a.inicio,final:a.final,subtotal:a.producto.precio*a.cantidad,puntosTotales:a.producto.puntos*a.cantidad})),fecha:t.fecha,totalPuntos:s,totalSubtotal:h}),o},{});return Object.values(R).sort((o,t)=>t.productosVendidos-o.productosVendidos)}))}getReportesAgrupados(n,e,l){return console.log(n),this.http.get(`${this.ruta}/reportes?inicio=${e}&fin=${l}`).pipe(Q(m=>{let R=m.reduce((o,t)=>{let i=t.promotora?._id;if(!i||t.promotora.fija!==n)return o;o[i]||(o[i]={promotora:`${t.promotora.nombre} ${t.promotora.apellido}`,marca:t.promotora.marca,sueldo:t.promotora.sueldo,region:t.promotora.region,porcentajeRebranding:0,puntosAcumulados:0,totalGastado:0,productosVendidos:0,conteoMetaUnidades:0,conteoMetaUnidadesQ:0,productosMystic:0,productosQerametik:0,puntosMystic:0,puntosQerametik:0,totalImpulsos:0,totalEventos:0,totalImpulsos_qerametik:0,totalEventos_qerametik:0,dias_impulto_mystic:0,dias_evento_mystic:0,dias_impulso_qerametik:0,dias_evento_qerametik:0,gastosPorMarca:{Mystic:0,Qerametik:0},clientes_atendidos:0,reportes:[]});let f=t.productos.reduce((c,d)=>c+d.producto.puntos*d.cantidad,0),s=t.productos.reduce((c,d)=>c+d.producto.precio*d.cantidad,0),h=t.productos.reduce((c,d)=>c+d.cantidad,0),k=0,_=0;return t.productos.forEach(c=>{c.producto.marca==="Mystic"?(o[i].productosMystic+=c.cantidad,o[i].puntosMystic+=c.producto.puntos*c.cantidad,c.producto.linea==="Tradicional"?k+=c.cantidad:c.producto.linea==="Rebranding"&&(_+=c.cantidad)):c.producto.marca==="Qerametik"&&(o[i].productosQerametik+=c.cantidad,o[i].puntosQerametik+=c.producto.puntos*c.cantidad)}),o[i].puntosAcumulados+=f,o[i].totalGastado+=s,o[i].productosVendidos+=h,o[i].porcentajeRebranding=_/o[i].productosMystic*100,o[i].reportes.push({cliente:t.cliente.cliente,marca:t.cliente.marca,tipo:t.tipo,observacion:t.observacion,productos:t.productos.map(c=>({producto:c.producto.producto,puntos:c.producto.puntos,linea:c.producto.linea,marca:c.producto.marca,cantidad:c.cantidad,inicio:c.inicio,final:c.final,subtotal:c.producto.precio*c.cantidad,puntosTotales:c.producto.puntos*c.cantidad})),fecha:t.fecha,totalPuntos:f,totalSubtotal:s}),o},{});return Object.values(R).sort((o,t)=>t.productosVendidos-o.productosVendidos)}))}NuevoReporte(n){this.http.post(`${this.ruta}/reportes`,n).subscribe(e=>{this.cargarReportes()})}formatFecha(n){let e=("0"+n.getDate()).slice(-2),l=("0"+(n.getMonth()+1)).slice(-2),m=n.getFullYear();return`${e}/${l}/${m}`}static \u0275fac=function(e){return new(e||p)};static \u0275prov=b({token:p,factory:p.\u0275fac,providedIn:"root"})};export{M as a,j as b};
