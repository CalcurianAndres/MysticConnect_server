import{a as _e}from"./chunk-PTCDLZEW.js";import{a as oe}from"./chunk-NCEXRZW4.js";import{a as re}from"./chunk-Q5UUACUJ.js";import{a as ge}from"./chunk-QBCWW73X.js";import{a as le,b as se,c as ce,d as de,f as me,g as pe,h as ue,i as N}from"./chunk-X7V57MHS.js";import{a as ae}from"./chunk-F2UG3DZ7.js";import{$a as W,Cb as J,Fa as Z,Ia as A,Na as M,Pb as B,R as K,Rb as ne,Sb as L,Wa as E,X as y,Ya as P,Za as k,_a as T,a as O,ab as i,b as U,bb as n,cb as m,da as p,db as w,ea as u,eb as v,f as Y,fb as d,hb as o,ib as I,ja as X,jb as V,kb as ee,lb as te,mb as g,nb as x,ob as f,qb as ie,rb as D,sb as $,tb as j,ub as z,za as c}from"./chunk-TPQHVVYC.js";var R=class s{http=y(ae);#e=Z({loading:!0,planificacion:[]});planificacion=J(()=>this.#e().planificacion);loading=J(()=>this.#e().loading);ruta="https://mysticconnectserver-production.up.railway.app/api";constructor(){this.cargarPlanificacion()}cargarPlanificacion(){this.http.get(`${this.ruta}/planificacion`).subscribe(r=>{this.#e.set({loading:!1,planificacion:r})})}NuevaPlanificacion=r=>Y(this,null,function*(){this.#e.set(U(O({},this.#e()),{loading:!0})),this.http.post(`${this.ruta}/planificacion`,r).subscribe(e=>{this.#e.set(U(O({},this.#e()),{loading:!1,planificacion:[...this.#e().planificacion,e]}))})});static \u0275fac=function(e){return new(e||s)};static \u0275prov=K({token:s,factory:s.\u0275fac,providedIn:"root"})};var ve=s=>({"is-active":s}),be=()=>[];function he(s,r){s&1&&m(0,"app-loadings")}function Se(s,r){if(s&1){let e=w();i(0,"div",11)(1,"label",12),o(2,"\xA0"),n(),i(3,"button",35),v("click",function(){p(e);let t=d(2).$index,l=d(2);return u(l.removeMeta(t))}),i(4,"span",33),m(5,"i",36),n()()()}}function ye(s,r){if(s&1){let e=w();i(0,"div",11)(1,"label",12),o(2,"\xA0"),n(),i(3,"button",8),v("click",function(){p(e);let t=d(3);return u(t.addMeta())}),i(4,"span",33),m(5,"i",34),n()()(),M(6,Se,6,0,"div",11)}if(s&2){let e=d().$index;c(6),P(e>0?6:-1)}}function Ee(s,r){if(s&1){let e=w();i(0,"div",10)(1,"div",11)(2,"label",12),o(3,"de (puntos)"),n(),i(4,"input",32),f("ngModelChange",function(t){let l=p(e).$index,_=d(2);return x(_.data.incentivos[l].de,t)||(_.data.incentivos[l].de=t),u(t)}),n()(),i(5,"div",11)(6,"label",12),o(7,"hasta (puntos)"),n(),i(8,"input",32),f("ngModelChange",function(t){let l=p(e).$index,_=d(2);return x(_.data.incentivos[l].hasta,t)||(_.data.incentivos[l].hasta=t),u(t)}),n()(),i(9,"div",11)(10,"label",12),o(11,"Incentivo (USD)"),n(),i(12,"input",32),f("ngModelChange",function(t){let l=p(e).$index,_=d(2);return x(_.data.incentivos[l].incentivo,t)||(_.data.incentivos[l].incentivo=t),u(t)}),n()(),M(13,ye,7,1),n()}if(s&2){let e=r.$index,a=d(2);c(4),g("ngModel",a.data.incentivos[e].de),c(4),g("ngModel",a.data.incentivos[e].hasta),c(4),g("ngModel",a.data.incentivos[e].incentivo),c(),P(e===a.metas-1?13:-1)}}function we(s,r){if(s&1){let e=w();i(0,"span",9),o(1,"Plan mensual"),n(),m(2,"hr"),i(3,"div",10)(4,"div",11)(5,"label",12),o(6,"Mes"),n(),i(7,"div",13)(8,"select",14),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.mes,t)||(l.data.mes=t),u(t)}),i(9,"option",15),o(10,"Enero"),n(),i(11,"option",16),o(12,"Febrero"),n(),i(13,"option",17),o(14,"Marzo"),n(),i(15,"option",18),o(16,"Abril"),n(),i(17,"option",19),o(18,"Mayo"),n(),i(19,"option",20),o(20,"Junio"),n(),i(21,"option",21),o(22,"Julio"),n(),i(23,"option",22),o(24,"Agosto"),n(),i(25,"option",23),o(26,"Septiembre"),n(),i(27,"option",24),o(28,"Octubre"),n(),i(29,"option",25),o(30,"Noviembre"),n(),i(31,"option",26),o(32,"Diciembre"),n()()()(),i(33,"div",11)(34,"label",12),o(35,"Inicio"),n(),i(36,"input",27),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.inicio,t)||(l.data.inicio=t),u(t)}),n()(),i(37,"div",11)(38,"label",12),o(39,"Cierre"),n(),i(40,"input",27),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.cierre,t)||(l.data.cierre=t),u(t)}),n()()(),m(41,"hr"),i(42,"span",28),o(43,"Metas"),n(),m(44,"br")(45,"br"),i(46,"div",29)(47,"div",30)(48,"span",31),o(49,"Mystic (Linea tradicional)"),n(),i(50,"div",10)(51,"div",11)(52,"label",12),o(53,"Impulso (Semanal)"),n(),i(54,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.tradicional.mystic.impulso,t)||(l.data.metas.tradicional.mystic.impulso=t),u(t)}),n()(),i(55,"div",11)(56,"label",12),o(57,"Evento"),n(),i(58,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.tradicional.mystic.evento,t)||(l.data.metas.tradicional.mystic.evento=t),u(t)}),n()()(),i(59,"span",31),o(60,"Qerametik (Linea tradicional)"),n(),i(61,"div",10)(62,"div",11)(63,"label",12),o(64,"Impulso (Semanal)"),n(),i(65,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.tradicional.qerametik.impulso,t)||(l.data.metas.tradicional.qerametik.impulso=t),u(t)}),n()(),i(66,"div",11)(67,"label",12),o(68,"Evento"),n(),i(69,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.tradicional.qerametik.evento,t)||(l.data.metas.tradicional.qerametik.evento=t),u(t)}),n()()()(),i(70,"div",30)(71,"span",31),o(72,"Mystic (Rebranding)"),n(),i(73,"div",10)(74,"div",11)(75,"label",12),o(76,"Impulso (Semanal)"),n(),i(77,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.rebranding.mystic.impulso,t)||(l.data.metas.rebranding.mystic.impulso=t),u(t)}),n()(),i(78,"div",11)(79,"label",12),o(80,"Evento"),n(),i(81,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.rebranding.mystic.evento,t)||(l.data.metas.rebranding.mystic.evento=t),u(t)}),n()()(),i(82,"span",31),o(83,"Qerametik (Rebranding)"),n(),i(84,"div",10)(85,"div",11)(86,"label",12),o(87,"Impulso (Semanal)"),n(),i(88,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.rebranding.qerametik.impulso,t)||(l.data.metas.rebranding.qerametik.impulso=t),u(t)}),n()(),i(89,"div",11)(90,"label",12),o(91,"Evento"),n(),i(92,"input",32),f("ngModelChange",function(t){p(e);let l=d();return x(l.data.metas.rebranding.qerametik.evento,t)||(l.data.metas.rebranding.qerametik.evento=t),u(t)}),n()()()()(),m(93,"hr"),i(94,"span",28),o(95," Incentivos por ventas "),n(),m(96,"br")(97,"br"),T(98,Ee,14,4,"div",10,k),m(100,"br")}if(s&2){let e=d();c(8),g("ngModel",e.data.mes),c(28),g("ngModel",e.data.inicio),c(4),g("ngModel",e.data.cierre),c(14),g("ngModel",e.data.metas.tradicional.mystic.impulso),c(4),g("ngModel",e.data.metas.tradicional.mystic.evento),c(7),g("ngModel",e.data.metas.tradicional.qerametik.impulso),c(4),g("ngModel",e.data.metas.tradicional.qerametik.evento),c(8),g("ngModel",e.data.metas.rebranding.mystic.impulso),c(4),g("ngModel",e.data.metas.rebranding.mystic.evento),c(7),g("ngModel",e.data.metas.rebranding.qerametik.impulso),c(4),g("ngModel",e.data.metas.rebranding.qerametik.evento),c(6),W(ie(11,be).constructor(e.metas))}}var q=class s{servicePlanificacion=y(R);active;onCloseModal=new X;metas=1;data={mes:"",inicio:"",cierre:"",metas:{tradicional:{mystic:{impulso:0,evento:0},qerametik:{impulso:0,evento:0}},rebranding:{mystic:{impulso:0,evento:0},qerametik:{impulso:0,evento:0}}},incentivos:[{de:0,hasta:0,incentivo:0}]};cerrar(){this.onCloseModal.emit()}addMeta(){this.metas++,this.data.incentivos.push({de:0,hasta:0,incentivo:0})}removeMeta(r){this.metas--,this.data.incentivos.length>1&&this.data.incentivos.splice(r,1)}sumarMetas(){this.metas++}crearPlanificacion(){this.servicePlanificacion.NuevaPlanificacion(this.data),this.metas=1,this.data={mes:"",inicio:"",cierre:"",metas:{tradicional:{mystic:{impulso:0,evento:0},qerametik:{impulso:0,evento:0}},rebranding:{mystic:{impulso:0,evento:0},qerametik:{impulso:0,evento:0}}},incentivos:[{de:0,hasta:0,incentivo:0}]},this.cerrar()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=A({type:s,selectors:[["app-planificacion"]],inputs:{active:"active"},outputs:{onCloseModal:"onCloseModal"},decls:15,vars:4,consts:[[1,"modal",3,"ngClass"],[1,"modal-background"],[1,"modal-card",2,"width","70%"],[1,"modal-card-head"],[1,"modal-card-title"],["aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"banner"],[1,"button","is-success",3,"click"],[2,"font-size","xx-large"],[1,"field","is-grouped"],[1,"control"],["for","",1,"label"],[1,"select"],[3,"ngModelChange","ngModel"],["value","Enero"],["value","Febrero"],["value","Marzo"],["value","Abril"],["value","Mayo"],["value","Junio"],["value","Julio"],["value","Agosto"],["value","Septiembre"],["value","Octubre"],["value","Noviembre"],["value","Diciembre"],["type","date","name","","id","",1,"input",3,"ngModelChange","ngModel"],[2,"font-size","x-large"],[1,"columns"],[1,"column"],[2,"font-weight","bolder"],["type","number","name","","id","",1,"input",3,"ngModelChange","ngModel"],[1,"icon"],[1,"fas","fa-plus"],[1,"button","is-danger",3,"click"],[1,"fas","fa-minus"]],template:function(e,a){e&1&&(i(0,"div",0),m(1,"div",1),i(2,"div",2)(3,"header",3)(4,"p",4),o(5,"Planificaci\xF3n"),n(),i(6,"button",5),v("click",function(){return a.cerrar()}),n()(),i(7,"div",6)(8,"div",7),M(9,he,1,0,"app-loadings")(10,we,101,12),i(11,"button",8),v("click",function(){return a.crearPlanificacion()}),i(12,"span"),o(13,"Crear Planificaci\xF3n"),n()(),m(14,"br"),n()()()()),e&2&&(E("ngClass",D(2,ve,a.active)),c(9),P(a.servicePlanificacion.loading()?9:10))},dependencies:[N,pe,ue,le,de,me,se,ce,L,B,re],encapsulation:2})};var Me=s=>({rotado:s}),G=(s,r)=>({oculto:s,activo:r});function Pe(s,r){s&1&&o(0," No hay reportes registrados ")}function Ve(s,r){if(s&1&&(o(0),j(1,"currency")),s&2){let e,a=d().$implicit,t=d().$implicit,l=d();ee(" ",z(1,2,(e=l.getReportesPorFecha(t.nombre,t.apellido,a))==null?null:e.totalSubtotal,"USD")," (",(e=l.getReportesPorFecha(t.nombre,t.apellido,a))==null?null:e.totalPuntos," Puntos) ")}}function Fe(s,r){if(s&1&&(i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),o(8),n(),i(9,"td"),o(10),n(),i(11,"td"),o(12),n()()),s&2){let e=r.$implicit;c(2),I(e.linea),c(2),I(e.marca),c(2),I(e.producto),c(2),I(e.cantidad),c(2),I(e.puntosTotales),c(2),V("",e.subtotal," $")}}function ke(s,r){if(s&1&&(i(0,"div",11)(1,"b"),o(2,"Establecimiento:"),n(),o(3),m(4,"br"),i(5,"b"),o(6,"Tipo:"),n(),o(7),m(8,"br"),i(9,"b"),o(10,"Observaci\xF3n:"),n(),o(11),m(12,"hr"),i(13,"table",13)(14,"thead")(15,"tr")(16,"th"),o(17,"Linea"),n(),i(18,"th"),o(19,"Marca"),n(),i(20,"th"),o(21,"Producto"),n(),i(22,"th"),o(23,"Cantidad (Und)"),n(),i(24,"th"),o(25,"Puntos"),n(),i(26,"th"),o(27,"Subtotal (USD)"),n()()(),i(28,"tbody"),T(29,Fe,13,6,"tr",null,k),n()()()),s&2){let e,a,t,l,_=d(),b=_.$implicit,F=_.$index,H=d(),h=H.$implicit,S=H.$index,C=d();E("ngClass",$(5,G,!C.toggleVentas[S]||!C.toggleVentas[S][F],C.toggleVentas[S]&&C.toggleVentas[S][F])),c(3),V(" ",(e=C.getReportesPorFecha(h.nombre,h.apellido,b))==null?null:e.cliente," "),c(4),V(" ",(a=C.getReportesPorFecha(h.nombre,h.apellido,b))==null?null:a.tipo," "),c(4),V(" ",(t=C.getReportesPorFecha(h.nombre,h.apellido,b))==null?null:t.observacion," "),c(2),E("ngClass",$(8,G,!C.toggleVentas[S]||!C.toggleVentas[S][F],C.toggleVentas[S]&&C.toggleVentas[S][F])),c(16),W((l=C.getReportesPorFecha(h.nombre,h.apellido,b))==null?null:l.productos)}}function Te(s,r){if(s&1){let e=w();i(0,"div")(1,"div",5)(2,"header",6)(3,"p",7),o(4),M(5,Pe,1,0)(6,Ve,2,5),n(),i(7,"button",8),v("click",function(){let t=p(e).$index,l=d().$index,_=d();return u(_.toggleVentaSection(l,t))}),i(8,"span",12),m(9,"i",10),n()()(),M(10,ke,31,11,"div",11),n()(),m(11,"br")}if(s&2){let e=r.$implicit,a=d().$implicit,t=d();c(4),V(" ",e," - "),c(),P(t.getReportesPorFecha(a.nombre,a.apellido,e)?6:5),c(5),P(t.getReportesPorFecha(a.nombre,a.apellido,e)?10:-1)}}function We(s,r){if(s&1){let e=w();i(0,"div",5)(1,"header",6)(2,"p",7),o(3),n(),i(4,"button",8),v("click",function(){let t=p(e).$index,l=d();return u(l.togglePromotoraSection(t))}),i(5,"span",9),m(6,"i",10),n()()(),i(7,"div",11)(8,"span")(9,"b"),o(10,"Total vendido:"),n(),o(11),j(12,"currency"),n(),m(13,"br")(14,"br"),T(15,Te,12,3,null,null,k),n()()}if(s&2){let e=r.$implicit,a=r.$index,t=d();c(3),te(" ",e.nombre," ",e.apellido," (",t.getPuntos(e.nombre,e.apellido)||0," puntos) "),c(2),E("ngClass",D(9,Me,t.isRotated[a])),c(2),E("ngClass",$(11,G,!t.togglePromotora[a],t.togglePromotora[a])),c(4),V(" ",z(12,6,t.getGastado(e.nombre,e.apellido)||0,"USD"),""),c(4),W(t.getFechasDelRango())}}var Q=class s{ReportesServices=y(ge);promotoras=y(_e);planificacionService=y(R);active=!1;reportesAgrupados=[];inicio="2024-12-03";cierre="2024-12-06";togglePromotora=[];toggleVentas={};isRotated=[];isRotated_={};constructor(){this.ReportesServices.getReportesAgrupados().subscribe({next:r=>{this.reportesAgrupados=r,console.log(this.reportesAgrupados)},error:r=>{console.error("Error al cargar los reportes:",r)}})}togglePromotoraSection(r){this.togglePromotora[r]=!this.togglePromotora[r],this.isRotated[r]=!this.isRotated[r]}toggleVentaSection(r,e){this.toggleVentas[r]||(this.toggleVentas[r]=[]),this.toggleVentas[r][e]=!this.toggleVentas[r][e]}getPuntos(r,e){let a=this.reportesAgrupados.find(t=>t.promotora===`${r} ${e}`);return a?a.puntosAcumulados:0}getGastado(r,e){let a=this.reportesAgrupados.find(t=>t.promotora===`${r} ${e}`);return a?a.totalGastado:0}getReportes(r,e){let a=`${r} ${e}`,t=this.reportesAgrupados.find(l=>l.promotora===a);return t?t.reportes:[]}getFechasDelRango(){let r=new Date(this.inicio),e=new Date(this.cierre),a=[];for(;r<=e;)a.push(this.formatFecha(r)),r.setDate(r.getDate()+1);return a}formatFecha(r){let e=("0"+r.getDate()).slice(-2),a=("0"+(r.getMonth()+1)).slice(-2),t=r.getFullYear();return`${e}/${a}/${t}`}getReportesPorFecha(r,e,a){let t=`${r} ${e}`,l=this.convertirFechaAISO(a),_=this.reportesAgrupados.find(b=>b.promotora===t);if(_){let b=_.reportes.find(F=>F.fecha===l);return b||void 0}else return}convertirFechaAISO(r){let[e,a,t]=r.split("/");return`${t}-${a.padStart(2,"0")}-${e.padStart(2,"0")}`}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=A({type:s,selectors:[["app-estadisticas"]],decls:12,vars:1,consts:[[3,"onCloseModal","active"],[1,"card",2,"background-color","#34495E","color","rgb(212, 212, 212)"],[1,"card-content"],["title","Estad\xEDsticas"],[1,"button","is-primary",3,"click"],[1,"card"],[1,"card-header"],[1,"card-header-title"],["aria-label","more options",1,"card-header-icon",3,"click"],[1,"icon",3,"ngClass"],["aria-hidden","true",1,"fas","fa-angle-down"],[1,"card-content",3,"ngClass"],[1,"icon"],[1,"table","is-fullwidth","is-striped",3,"ngClass"]],template:function(e,a){e&1&&(i(0,"app-planificacion",0),v("onCloseModal",function(){return a.active=!1}),n(),i(1,"div",1)(2,"div",2),m(3,"app-title",3),n()(),m(4,"hr"),i(5,"button",4),v("click",function(){return a.active=!0}),i(6,"span"),o(7,"Nueva planificaci\xF3n"),n()(),m(8,"br")(9,"br"),T(10,We,17,14,"div",5,k)),e&2&&(E("active",a.active),c(10),W(a.promotoras.users()))},dependencies:[oe,L,B,ne,N,q],styles:['@charset "UTF-8";.oculto[_ngcontent-%COMP%]{overflow:hidden;max-height:0px;padding:0;margin:0;transition:max-height .5s ease-out,padding .3s ease-out,margin .3s ease-out}.activo[_ngcontent-%COMP%]{transition:max-height .9s ease-out,padding .3s ease-out,margin .3s ease-out}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:transform .3s ease}.icon.rotado[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transform:rotate(180deg)}']})};export{Q as default};
